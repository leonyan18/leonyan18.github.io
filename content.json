{"posts":[{"title":"ç‰›å®¢æ¨¡æ‹Ÿç¼“å­˜","text":"BM100 è®¾è®¡LRUç¼“å­˜ç»“æ„é¢˜æ„é“¾æ¥ï¼šè®¾è®¡LRUç¼“å­˜ç»“æ„_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯linkedHashMapå¯ä»¥ç»´æŠ¤å…ƒç´ æ’å…¥é¡ºåºæˆ–è€…å…ƒç´ è®¿é—®é¡ºåºï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ å³ä¸ºæœ€è¿œæ²¡æœ‰è®¿é—®è¿‡çš„ï¼Œ setå’Œgetåœ¨é€šå¸¸æƒ…å†µæ˜¯O(1),æœ€åæƒ…å†µæ˜¯O(logn) ä½¿ç”¨LinkedHashMapè®¾ç½®ä¸ºè®¿é—®æ¬¡åº setçš„æ—¶å€™è¦æ³¨æ„å®¹é‡ï¼Œç§»é™¤æœ€ä¹…æœªä½¿ç”¨çš„key 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.yan.simulation;import com.yan.base.Solution;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.io.InputStream;import java.io.OutputStream;import java.util.LinkedHashMap;//@Servicepublic class LRUCacheSolution implements Solution { private LinkedHashMap&lt;Integer,Integer&gt; map; private int capacity; @Override public void solve(InputStream in, OutputStream outputStream) { System.out.println(&quot;test&quot;); LRUCacheSolution lruCacheSolution=new LRUCacheSolution(2); lruCacheSolution.set(1,1); lruCacheSolution.set(2,2); System.out.println(lruCacheSolution.get(1)); lruCacheSolution.set(3,3); System.out.println(lruCacheSolution.get(2)); lruCacheSolution.set(4,4); System.out.println(lruCacheSolution.get(1)); System.out.println(lruCacheSolution.get(3)); System.out.println(lruCacheSolution.get(4)); } public LRUCacheSolution() { } public LRUCacheSolution(int capacity) { this.capacity=capacity; // è®¾ç½®ä¸ºè®¿é—®é¡ºåº map= new LinkedHashMap&lt;&gt;(capacity,0.75f,true); // write code here } public int get(int key) { if (!map.containsKey(key)){ return -1; } int val=map.get(key); return val; } public void set(int key, int value) { // åªæœ‰å¤§å°ç­‰äºå®¹é‡å¹¶ä¸”æ’å…¥çš„æ—¶å€™keyä¸å­˜åœ¨çš„æ—¶å€™æ‰è¿›è¡Œåˆ é™¤ä¹‹å‰çš„ if(map.size()==capacity&amp;&amp;!map.containsKey(key)){ // åˆ é™¤æœ€è¿œæ²¡ç”¨è¿‡çš„ int temp= map.entrySet().iterator().next().getKey(); map.remove(temp); } map.put(key,value); }} BM101 è®¾è®¡LFUç¼“å­˜ç»“æ„é¢˜æ„ æ€è·¯ä¸ªäººæ€è·¯ï¼ˆéæœ€ä½³ï¼‰ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè®°å½•æŸ¥æ‰¾å’ŒæŸ¥è¯¢æ¬¡æ•°ä»¥åŠç›¸å¯¹ä½ç½®ï¼ŒæŒ‰ç…§æ¬¡æ•°æœ€å°‘æ’åºï¼Œä½¿ç”¨æ‡’åˆ é™¤çš„æ€æƒ³åœ¨å®¹é‡æ»¡çš„æ—¶å€™æ‰å¯¹å‰é¢çš„å…ƒç´ å»é™¤è„æ•°æ® ä½¿ç”¨æ•°æ®ç»“æ„ 12345678910 private HashMap&lt;Integer, Integer&gt; map;// key -value private HashMap&lt;Integer, Integer&gt; countMap;// key -æ¬¡æ•° private HashMap&lt;Integer, Integer&gt; opMap;// key -æ“ä½œæ•° private int capacity; // å®¹é‡ private int op;// æ“ä½œæ•°class Node { int key; int cnt; int pos; } æ’å…¥æ—¶ï¼š å®¹é‡ä¸ºæ»¡çš„çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢é˜Ÿé¦–å…ƒç´ æ˜¯å¦ä¸ºæ­£ç¡®èŠ‚ç‚¹æ­¥éª¤å¦‚ä¸‹ åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£ç¡®çš„æ“ä½œæ•° åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦å·²åˆ é™¤ ä¸æ­£ç¡®çš„è¯å°±å¼¹å‡ºèŠ‚ç‚¹ï¼Œå¹¶é‡å¤æ“ä½œï¼Œç›´è‡³æ­£ç¡®ã€‚countMapå’Œmapä¸­å›åˆ é™¤è¿™ä¸ªkeyï¼› æ’å…¥å’Œè·å–èŠ‚ç‚¹ï¼ŒcountMapï¼Œmapå’Œqueueæ›´æ–°æ•°æ®ï¼ŒåŒæ—¶opæ“ä½œæ•°++ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140package com.yan.simulation;import com.yan.base.Solution;import org.springframework.stereotype.Service;import java.io.InputStream;import java.io.OutputStream;import java.util.*;@Servicepublic class LFUCacheSolution implements Solution { private HashMap&lt;Integer, Integer&gt; map; private HashMap&lt;Integer, Integer&gt; countMap; private HashMap&lt;Integer, Integer&gt; opMap; private int capacity; private int op; private PriorityQueue&lt;Node&gt; queue; @Override public void solve(InputStream in, OutputStream outputStream) { LFUCacheSolution lfuCacheSolution = new LFUCacheSolution(3); lfuCacheSolution.set(2054879058, -121373736); lfuCacheSolution.set(2054879053, -121373736); lfuCacheSolution.set(2054879025, -121373736); lfuCacheSolution.set(2, 4); lfuCacheSolution.set(3, 5); System.out.println(lfuCacheSolution.get(2)); lfuCacheSolution.set(4, 4); System.out.println(lfuCacheSolution.get(1)); } public int[] LFU(int[][] operators, int k) { ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; operators.length; i++) { if (operators[i][0] == 1) { set(operators[i][1], operators[i][2]); } else { int temp = get(operators[i][1]); arrayList.add(temp); } } int[] d = new int[arrayList.size()]; for (int i = 0; i &lt; arrayList.size(); i++) { d[i] = arrayList.get(i); } return d; } public LFUCacheSolution() { } public LFUCacheSolution(int capacity) { this.capacity = capacity; map = new HashMap&lt;&gt;(capacity); countMap = new HashMap&lt;&gt;(capacity); opMap = new HashMap&lt;&gt;(capacity); queue = new PriorityQueue&lt;&gt;(capacity * 4, new Comparator&lt;Node&gt;() { @Override public int compare(Node o1, Node o2) { if (o1.cnt != o2.cnt) { return o1.cnt - o2.cnt; } else { return o1.pos - o2.pos; } } }); } public int get(int key) { if (!map.containsKey(key)) { return -1; } int val = map.get(key); int cnt = countMap.get(key); countMap.put(key, cnt + 1); opMap.put(key, op); queue.add(new Node(key, cnt + 1, op)); op++; return val; } public void set(int key, int value) { // åªæœ‰å¤§å°ç­‰äºå®¹é‡å¹¶ä¸”æ’å…¥çš„æ—¶å€™keyä¸å­˜åœ¨çš„æ—¶å€™æ‰è¿›è¡Œåˆ é™¤ä¹‹å‰çš„ if (map.size() == capacity &amp;&amp; !map.containsKey(key)) { // åˆ é™¤æœ€è¿œæ²¡ç”¨è¿‡çš„ Node temp = queue.peek(); while (!map.containsKey(temp.key) || (temp.pos != opMap.get(temp.key))) { queue.poll(); temp = queue.peek(); } temp=queue.poll(); map.remove(temp.key); countMap.remove(temp.key); } map.put(key, value); countMap.put(key, 1); opMap.put(key, op); queue.add(new Node(key, 1, op)); op++; } class Node { int key; int cnt; int pos; public Node() { } public Node(int key, int cnt, int pos) { this.key = key; this.cnt = cnt; this.pos = pos; } @Override public boolean equals(Object o) { if (this == o) return true; if (!(o instanceof Node)) return false; Node node = (Node) o; if (key != node.key) return false; if (cnt != node.cnt) return false; return pos == node.pos; } @Override public int hashCode() { int result = key; result = 31 * result + cnt; result = 31 * result + pos; return result; } }} é¢˜è§£æ€è·¯é¢˜è§£ | #è®¾è®¡LFUç¼“å­˜ç»“æ„#_ç‰›å®¢åšå®¢ (nowcoder.net) éœ€è¦åœ¨O(1)æ—¶é—´å†…å®ç°ä¸¤ä¸ªæ“ä½œï¼Œæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„è¿˜æ˜¯å“ˆå¸Œè¡¨ï¼Œåˆ©ç”¨å“ˆå¸Œè¡¨ä¿å­˜LFUçš„keyå€¼ï¼Œè€Œå“ˆå¸Œè¡¨çš„valueå€¼å¯¹åº”äº†å¦ä¸€è¾¹å­˜ç€æ¯ä¸ªç¼“å­˜éœ€è¦çš„ç±»çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å®ç°äº†ç›´æ¥è®¿é—®ã€‚ ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æ¯æ¬¡æœ€å¿«æ‰¾åˆ°æœ€ä¹…æœªä½¿ç”¨çš„é¢‘ç‡æœ€å°çš„èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè·Ÿè¸ªè®°å½•æœ€å°çš„é¢‘ç‡ï¼Œæœ‰äº†æœ€å°çš„é¢‘ç‡ï¼ˆå½“ä½ ä½¿ç”¨setæ–¹æ³•çš„æ—¶å€™æ¯æ¬¡è¿›æ¥çš„éƒ½æ˜¯æœ€å°é¢‘ç‡çš„ï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°çš„æ—¶å€™é€šå¸¸æ›´æ–°ä¸º1ï¼Œæˆ–è€…é¢‘ç‡ä¸ºæœ€å°é¢‘ç‡çš„æ²¡æœ‰äº†è¿›è¡Œ++æ“ä½œï¼‰ï¼Œæ€æ ·ç›´æ¥æ‰¾åˆ°è¿™ä¸ªé¢‘ç‡æœ€å°çš„èŠ‚ç‚¹ï¼Œè¿˜æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œkeyå€¼è®°å½•å„ä¸ªé¢‘ç‡ï¼Œè€Œvalueå€¼å°±æ˜¯åé¢æ¥äº†ä¸€ä¸²ç›¸åŒé¢‘ç‡çš„èŠ‚ç‚¹ã€‚å¦‚ä½•ä¿è¯æ¯æ¬¡éƒ½æ˜¯æœ€å°é¢‘ç‡çš„æœ€ä¹…ä¸ºä½¿ç”¨ï¼Œæˆ‘ä»¬ç”¨åŒå‘é“¾è¡¨å°†ç»Ÿä¸€é¢‘ç‡çš„èŠ‚ç‚¹è¿èµ·æ¥å°±å¥½äº†ï¼Œæ¯æ¬¡æ–°åŠ å…¥è¿™ä¸ªé¢‘ç‡çš„éƒ½åœ¨é“¾è¡¨å¤´ï¼Œè€Œéœ€è¦å»æ‰çš„éƒ½åœ¨é“¾è¡¨å°¾ã€‚ ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2022/12/26/NowcoderEmulateCache/"},{"title":"Hexoåšå®¢æ­å»ºä»¥åŠæ–‡ä»¶åŒæ­¥","text":"æ€»ä½“ç»“æ„ Hexo+ Icarusä¸»é¢˜ä½œä¸ºåšå®¢åŸºç¡€ï¼Œåœ¨æ­¤åŸºç¡€å¯¹æ­¤ä¸»é¢˜è¿›è¡Œå¸ƒå±€ä¿®æ”¹ ä¿®æ”¹å’Œå‘å¸ƒæ–‡ç« ï¼Œä¸€å¼€å§‹æ˜¯é‡‡ç”¨äº†hexo-adminçš„æ–¹å¼è¿›è¡Œä¿®æ”¹çš„ï¼Œåé¢æ„Ÿè§‰è¿˜æ˜¯éº»çƒ¦å’Œæœ¬åœ°typoraå·®è·ç”šå¤§ï¼Œäºæ˜¯ä½¿ç”¨äº†Alistå’ŒRaiDriveè¿›è¡Œæœ¬åœ°æŒ‚è½½è¿œç¨‹ç›®å½•çš„æ–¹å¼ï¼Œå¹¶ç»“åˆå›¾åºŠã€‚ åšå®¢æ­å»ºhexoæ–‡æ¡£ | Hexo å®‰è£… Hexo éœ€è¦å…ˆå®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºå³å¯ï¼š Node.js (Node.js ç‰ˆæœ¬éœ€ä¸ä½äº 10.13ï¼Œå»ºè®®ä½¿ç”¨ Node.js 12.0 åŠä»¥ä¸Šç‰ˆæœ¬) Git 1234#å…¨å±€å®‰è£…npm install -g hexo-cli#å±€éƒ¨å®‰è£…npm install hexo hexoä¸»é¢˜Icarusgithubåœ°å€ppoffice/hexo-theme-icarus: A simple, delicate, and modern theme for the static site generator Hexo. (github.com) æ–‡æ¡£åœ°å€Icaruså¿«é€Ÿä¸Šæ‰‹ - Icarus (ppoffice.github.io) ä¸è¿‡ä¸ªäººæ¨èå¯ä»¥å®‰è£…ä¹‹å‰çš„åº“å¦‚4.4ç‰ˆæœ¬çš„ï¼Œ5.0ä»¥ä¸Šç‰ˆæœ¬å¸ƒå±€éƒ½ä¸åœ¨themes/Icarus/layout/ä¸‹äº†,éƒ½åœ¨node_modulesé‡Œäº†ï¼Œåé¢ä¿®æ”¹åŸæ¥çš„å¸ƒå±€å°±ååˆ†éº»çƒ¦ 12npm install hexo-theme-icarushexo config theme icarus é…ç½®æ–‡ä»¶å¯ä»¥å‚è€ƒè‡ªåŠ¨ç”Ÿæˆçš„_config.icarus.yml.exampleï¼Œä»¥åŠå¯¹åº”çš„æ–‡æ¡£Tag: Icarusç”¨æˆ·æŒ‡å— - Icarus (ppoffice.github.io) å¸ƒå±€é—®é¢˜å‚è€ƒé“¾æ¥Hexoä¸»é¢˜Icarusçš„è‡ªå®šä¹‰ - Astroblog (astrobear.top) ç”±äºåŸæ¥çœ‹æ–‡ç« çš„æ—¶å€™å¤šæ å¸ƒå±€å¯¼è‡´æ–‡ç« å†…å®¹è¿‡äºçª„äº†æ‰€ä»¥ç¬¬ä¸€æ­¥éœ€è¦å…ˆæ”¹æˆåŒæ  è¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ–‡ç« çš„å•ç‹¬å¸ƒå±€_config.post.ymlä»£ç å¦‚ä¸‹ï¼Œå³æ‰€æœ‰widgetéƒ½åœ¨å·¦æˆ–è€…å³è¾¹ 12345678910111213141516171819202122sidebar: left: sticky: true right: sticky: falsewidgets: - position: left type: profile author: é¢œæ™¨æ›¦ author_title: ç ”ç©¶ç”Ÿ location: æµ™æ±Ÿ å°å· avatar: /img/avatar.png avatar_rounded: false gravatar: follow_link: https://github.com/leonyan18 - position: left type: toc index: true collapsed: true depth: 6 è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ–‡ç« å†…å®¹å®½åº¦è¿˜æ˜¯åçª„ï¼Œä¹‹å‰ç‰ˆæœ¬çš„ä¿®æ”¹æ–¹æ³•ç°åœ¨éƒ½è¦é‡Œé¢çš„æ–‡ä»¶å¯¹åº”åˆ°node_modules/hexo-theme-Icarusä¸­æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé‡æ–°è®¾ç½®ä¸»é¢˜ï¼Œå¹¶é‡å¯ã€‚ ä¹‹å‰æ–¹æ³•å‚è€ƒé“¾æ¥Hexoä¸»é¢˜Icarusçš„è‡ªå®šä¹‰ - Astroblog (astrobear.top)ï¼Œå°† Icarus5çš„ä¼˜é›…æ›¿ä»£æ–¹æ³•ä¸»è¦è¿˜æ˜¯å¼ºè¿«ç—‡ï¼Œæ€•ä»¥åå¤‡ä»½çš„æ—¶å€™å¿˜è®°node_modulesé‡Œçš„ä¸œè¥¿ï¼Œè¦é‡æ–°ä¿®æ”¹å¸ƒå±€ä¸€é å°†node_modules/hexo-theme-Icarusä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ€å¤–å±‚ä¸»é¢˜themes/icarus/ä¸­ï¼ˆæ²¡æœ‰å°±åˆ›å»ºï¼‰ï¼Œé‚£ä¹ˆå…¶å®ä½ å°±ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå’ŒIcarusä¸€æ¨¡ä¸€æ ·çš„ä¸»é¢˜ï¼Œå’Œä¹‹å‰Icarus4çš„åšæ³•ä¸€æ ·ï¼Œç›´æ¥åœ¨è¿™é‡Œé¢æ”¹åŠ¨å°±è¡Œã€‚ æ–‡ä»¶åŒæ­¥å‚è€ƒä¸€ä¸‹ä¹‹å‰çš„æ–‡ç« Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜=æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½ - blog (dawnchannel.tech) ä½¿ç”¨Alistæ·»åŠ æœ¬åœ°å­˜å‚¨(åšå®¢ç›®å½•/source/_posts/) RaiDriveå°±ä¼šæ˜ å°„åˆ°æœ¬åœ°ç›˜ä¸­ åšå®¢ç¼–å†™å®‰è£…typoraTypora â€” a markdown editor, markdown reader. ä½¿ç”¨picGoä½œä¸ºå›¾åºŠï¼Œæ·»åŠ ä½ æœ‰çš„å›¾åºŠï¼Œæˆ‘æ˜¯ç”¨çš„minioå›¾åºŠï¼Œéœ€è¦åœ¨é‡Œé¢ä¸‹è½½ä¸€ä¸ªæ’ä»¶å³å¯ ç„¶ååœ¨Typoraä¸­è¿›è¡Œé…ç½®ï¼Œé…ç½®å®Œæˆä¹‹åä½ çš„å¤åˆ¶çš„å›¾ç‰‡ç‚¹å‡»ä¸Šä¼ å°±èƒ½ä¸Šä¼ åˆ°å›¾åºŠä¹‹ä¸Š","link":"/2022/12/27/blog/"},{"title":"Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜&#x3D;æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½","text":"æ€»ä½“ç»“æ„ è¿œç¨‹å­˜å‚¨ç©ºé—´ä¸ºæœåŠ¡å™¨ä¸ŠæŒ‡å®šç›®å½•å’Œé˜¿é‡Œäº‘ç›˜æŒ‡å®šç›®å½• Alistä½œä¸ºæ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œå¹¶å‘RaiDrive æä¾› webDAVæ¥å£ Raiä½œä¸ºæœ¬åœ°æŒ‚è½½è¿œç¨‹å·¥å…·çš„è½¯ä»¶ï¼Œä½¿åŸæœ¬éœ€è¦è¯»å–è¿œç¨‹æ–‡ä»¶çš„æ“ä½œåƒæœ¬åœ°æ“ä½œä¸€æ ·ç®€å• Alistå®‰è£…ä»¥åŠä½¿ç”¨å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ä¸€é”®è„šæœ¬ | AListæ–‡æ¡£ (nn.ci) æœ¬äººä½¿ç”¨å®˜æ–¹æ¨èçš„è¿™ä¸ªè„šæœ¬å®‰è£… 123456#å®‰è£…curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s install#æ›´æ–°curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s update#å¸è½½curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s uninstall ä¸€é”®è„šæœ¬å®‰è£…ä¹‹åï¼Œé»˜è®¤å®‰è£…åœ¨/opt/alist åç»­è·å¾—ç®¡ç†å‘˜å¯†ç è¦ä»æ‰‹åŠ¨å®‰è£…çš„è¿è¡Œé‡Œé¢æ‰¾ï¼Œè¿™ä¸ªä¸€å¼€å§‹æˆ‘ä¹Ÿæ²¡æ‰¾åˆ° 123456# è¿›å…¥æ–‡ä»¶å¤¹cd /opt/alist# è¿è¡Œç¨‹åº./alist server# è·å¾—ç®¡ç†å‘˜ä¿¡æ¯./alist admin ç®¡ç†å‘˜ç™»å½• ç„¶åå°±æ˜¯åœ¨webé¡µé¢ä¸Šæ“ä½œäº†ï¼Œé»˜è®¤æ˜¯5244ç«¯å£ï¼ŒæœåŠ¡å™¨çš„è¯éœ€è¦å®‰å…¨ç»„å¼€ç«¯å£ ä¹‹åçœ‹æ–‡æ¡£è§£å†³ä¸€ä¸‹é€šç”¨é¡¹ | AListæ–‡æ¡£ (nn.ci) æ·»åŠ æœåŠ¡å™¨æœ¬åœ°å­˜å‚¨æœ¬åœ°å­˜å‚¨ | AListæ–‡æ¡£ (nn.ci)ï¼Œå¯ä»¥æ—¥åä½œä¸ºæœåŠ¡å™¨å’Œæœ¬åœ°å®æ—¶åŒæ­¥æ–‡ä»¶ï¼Œå¸¦å®½ä¸é«˜å°±è¦ç”¨æ¥çœ‹è§†é¢‘äº† æ·»åŠ é˜¿é‡Œäº‘ç›˜é˜¿é‡Œäº‘ç›˜ | AListæ–‡æ¡£ (nn.ci)ï¼Œå¯ä»¥å®ƒç”¨ä»–çœ‹è§†é¢‘å¬æ­Œï¼Œåˆ‡è®°åˆ‡è®°WebDAV ç­–ç•¥ä½¿ç”¨302é‡å®šå‘ï¼Œè¿™æ ·ç”¨çš„å°±ä¸æ˜¯ä½ æœåŠ¡å™¨çš„å¸¦å®½äº†ï¼Œè€Œæ˜¯é˜¿é‡Œäº‘ç›˜çš„ è¿™äº›æ–‡æ¡£éƒ½è®²çš„æ¯”è¾ƒæ¸…æ™°äº†ï¼Œå°±ä¸å†èµ˜è¿° Raiè½¯ä»¶å®‰è£…ä¸‹è½½é“¾æ¥ï¼šä¸‹è½½ (raidrive.com.cn) ç›´æ¥ç‚¹å‡»å®‰è£…å°±è¡Œï¼ŒæœŸé—´ä¼šæœ‰å®‰è£…å…¶ä»–è½¯ä»¶å’Œä¸€äº›è®¾å¤‡è½¯ä»¶ï¼Œå®‰è£…å°±è¡Œ ç„¶åç‚¹å‡»æ·»åŠ ï¼Œé€‰æ‹©NS webDAV ç„¶åå°±è¡Œäº†","link":"/2022/12/28/local_sync/"},{"title":"ä½¿ç”¨Github Actions åŠ¨æ€æ›´æ–°Githubä¸»é¡µ","text":"æ€»ä½“æ€è·¯å€Ÿé‰´æ€è·¯åœ°å€ä½¿ç”¨Github Actions åŠ¨æ€æ›´æ–°Githubä¸»é¡µ - æ–¹åœ†å°ç«™ (fangyuanxiaozhan.com) åŸæ–‡è®²çš„ä¸œè¥¿ä¸å¤Ÿå…¨ï¼Œæˆ‘è¿™ä¼šè¡¥å……ä¸€ç‚¹ é¡¹ç›®å‚è€ƒåœ°å€leonyan18/leonyan18 (github.com) pythonè„šæœ¬çˆ¬å–åšå®¢æ›´æ–°å†…å®¹ï¼Œå¹¶å†™å…¥æ›´æ–°åˆ°æŒ‡å®šä½ç½® github action æ¯å¤©å®šæ—¶å¯åŠ¨è¿™ä¸ªä»»åŠ¡ pythonè„šæœ¬ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©ä½ è¦æ’å…¥çš„ä½ç½®ï¼Œå¹¶ä¿®æ”¹è„šæœ¬12345678910111213è¿™æ˜¯æˆ‘çš„ReadME.md## Recent Blog Posts(update time:2022-12-29 10:15:20)[Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜&amp;#x3D;æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½](http://dawnchannel.tech/2022/12/28/local_sync/)[Hexoåšå®¢æ­å»ºä»¥åŠæ–‡ä»¶åŒæ­¥](http://dawnchannel.tech/2022/12/27/blog/)[ç‰›å®¢æ¨¡æ‹Ÿç¼“å­˜](http://dawnchannel.tech/2022/12/26/NowcoderEmulateCache/)&lt;br/&gt;## ğŸ’»:keyboard: Languages and Tools æˆ‘æ˜¯åœ¨## Recent Blog Postså’Œ## ğŸ’»:keyboard: Languages and Tools ä¹‹é—´è¿›è¡Œæ’å…¥çš„ï¼Œæ ¹æ®å®é™…æƒ…å†µæ›¿æ¢å€¼ï¼Œæˆ‘è¿™è¾¹æ˜¯å¤šäº†å‡ ä¸ªå›è½¦ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨æœ¬åœ°è°ƒè¯•é€šè¿‡ä¹‹ååœ¨è¿›è¡Œä¸Šä¼ ã€‚ åœ¨main.pyå¯¹åº”ä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ä¸¤ä¸ªinsert_info = çš„ä½ç½® ç¬¬äºŒæ­¥ æ ¹æ®å®é™…è¿”å›ä¿®æ”¹get_link_infoå‡½æ•°ç”±äºæœ¬äººæ˜¯é€šè¿‡hexo+icarusä¸»é¢˜å®ç°çš„ï¼Œåšå®¢å†…å®¹å¯ä»¥é€šè¿‡http://dawnchannel.tech/content.jsonç›´æ¥è·å¾—ï¼Œå¯ä»¥å°†å…¶æ›¿æ¢æˆè‡ªå·±çš„åœ°å€ã€‚ å…¶ä»–åœ°å€éœ€è¦ä¸ªäººè‡ªå®šä¹‰äº†ï¼Œè¿˜è¦æ³¨æ„ä¸€ç‚¹æˆ‘è¿™ä¸ªæ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºä¸‹æ¥çš„ï¼Œæ‰€ä»¥æˆ‘è¿˜è¿›è¡Œäº†ä¸€ä¸ªé€†åºæ“ä½œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041import timeimport osimport reimport pytzimport requestsimport jsonfrom datetime import datetimedef get_link_info(feed_url, num): result = &quot;&quot; response = requests.get(feed_url).text response=json.loads(response) feed_entries = response[&quot;posts&quot;] feed_entries.reverse() feed_entries_length = len(feed_entries) all_number = 0 if(num &gt; feed_entries_length): all_number = feed_entries_length else: all_number = num for entrie in feed_entries[0: all_number]: title = entrie[&quot;title&quot;] link = &quot;http://dawnchannel.tech&quot;+entrie[&quot;link&quot;] result = result + &quot;\\n&quot; + &quot;[&quot; + title + &quot;](&quot; + link + &quot;)&quot; + &quot;\\n&quot; return resultdef main(): insert_info = get_link_info(&quot;http://dawnchannel.tech/content.json&quot;, 6) # æ›¿æ¢ ---start--- åˆ° ---end--- ä¹‹é—´çš„å†…å®¹ # pytz.timezone('Asia/Shanghai')).strftime('%Yå¹´%mæœˆ%dæ—¥%Hæ—¶Måˆ†') fmt = '%Y-%m-%d %H:%M:%S %Z%z' insert_info = &quot;## Recent Blog Posts(&quot; + &quot;update time:&quot;+ datetime.fromtimestamp(int(time.time()),pytz.timezone('Asia/Shanghai')).strftime('%Y-%m-%d %H:%M:%S') +&quot;)\\n&quot; + insert_info + &quot;\\n\\n&lt;br/&gt;\\n\\n## ğŸ’»:keyboard: Languages and Tools &quot; # è·å–README.mdå†…å®¹ print(insert_info) with open (os.path.join(os.getcwd(), &quot;README.md&quot;), 'r', encoding='utf-8') as f: readme_md_content = f.read() new_readme_md_content = re.sub(r'## Recent Blog Posts(.|\\n)*## ğŸ’»:keyboard: Languages and Tools ', insert_info, readme_md_content) with open (os.path.join(os.getcwd(), &quot;README.md&quot;), 'w', encoding='utf-8') as f: f.write(new_readme_md_content)main() ç¬¬ä¸‰æ­¥ æœ¬åœ°è°ƒè¯•ä¸»è¦æµ‹è¯•ä¸€ä¸‹ï¼Œæœ¬åœ°çš„ReadMEæ–‡ä»¶æ˜¯å¦æ­£å¸¸ï¼Œåœ¨æ²¡æœ‰æœ€è¿‘åšå®¢çš„æ—¶å€™å’Œæœ‰æœ€è¿‘åšå®¢çš„æ—¶å€™éƒ½æµ‹è¯•ä¸€ä¸‹ã€‚ github actionså‰æœŸå‡†å¤‡å…ˆè§£é‡Šä¸‹actionçš„æµç¨‹ åˆ›å»ºæ‰€éœ€è¦çš„ç¯å¢ƒ å®‰è£…å¯¹åº”ä¾èµ– gitæ“ä½œ ç„¶åçœ‹ä¸‹æˆ‘ä»¬çš„ç›®å½•ç»“æ„ä»¥åŠæ‰€éœ€è¦çš„ä¸œè¥¿ï¼Œç¼ºä¸€æ ·éƒ½ä¸å¯ä»¥ ReadMe.md ï¼Œä¸»è¦éœ€è¦ä¿®æ”¹çš„å¯¹è±¡ main.pyï¼Œpythonè„šæœ¬ç”¨äºä¿®æ”¹å†…å®¹ Pipfileï¼Œåˆ›å»ºç¯å¢ƒå®‰è£…å¯¹åº”ä¾èµ– .gitignoreï¼Œå¿½ç•¥ç”Ÿæˆçš„å…¶ä»–æ— å…³æ–‡ä»¶ .gitignoreå’ŒPipfileæ–‡ä»¶ç›´æ¥ä½¿ç”¨å‚è€ƒä»“åº“é‡Œï¼Œå¦‚æœç”¨åˆ°å…¶ä»–åº“æˆ–è€…æ–°å¢å…¶ä»–æ–‡ä»¶äº†ï¼Œè¯·è‡ªè¡Œæ·»åŠ ã€‚ å¯åŠ¨actionsç‚¹å‡»ä»“åº“ä¸‹é¢çš„actionsæŒ‰é’®ï¼Œåˆ›å»ºå¯¹åº”main.yml 1234567891011121314151617181920212223242526272829303132name: 'leonyan18'on: push: schedule: - cron: '0 1 * * *'jobs: stale: runs-on: ubuntu-latest strategy: matrix: # in this example, there is a newer version already installed, 3.7.7, so the older version will be downloaded python-version: ['3.7.4'] steps: - uses: actions/checkout@v2 # Checking out the repo - name: Install dependecies uses: VaultVulp/action-pipenv@v2.0.1 with: command: install -d # Install all dependencies, including development ones - name: Build uses: VaultVulp/action-pipenv@v2.0.1 with: command: run build - name: Commit and push if changed # æ›´æ–°README.md run: | git diff git config --global user.email &quot;1183503933@qq.com&quot; git config --global user.name &quot;leonyan&quot; git add README.md git commit -m &quot;Github Action Auto Updated&quot; git push æäº¤ä¹‹åï¼Œå»Enableè¿™ä¸ªjobå°±å¯ä»¥æ¯å¤©æ›´æ–°äº†ã€‚ æ³¨æ„å½“ä½ é‡æ–°å¯åŠ¨å¤±è´¥çš„jobçš„æ—¶å€™ï¼Œä¸€å®šè¦æ‰‹åŠ¨è§¦å‘ï¼Œé‡æ–°è¿è¡Œä¹‹å‰çš„å·²ç»ä¸è¡Œäº†ï¼Œå› ä¸ºreadmeå·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œå¯ä»¥é€šè¿‡é‡æ–°gitæäº¤ä¼šè‡ªåŠ¨è§¦å‘ æˆ–è€…æ”¹ä¸ºæ‰‹åŠ¨è§¦å‘ 123on: # æ‰‹åŠ¨è§¦å‘äº‹ä»¶ workflow_dispatch:","link":"/2022/12/29/GetRecentBlog/"},{"title":"BM95 åˆ†ç³–æœé—®é¢˜","text":"é¢˜æ„é“¾æ¥ï¼šåˆ†ç³–æœé—®é¢˜_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯é¢˜æ„å¯å¾— æå°å€¼ç‚¹åªç»™ä¸€é¢—ç³–ã€‚ å¦‚æœå·¦è¾¹éƒ½æ¯”å³è¾¹å°é‚£ä¹ˆæ˜¯ä¸ªå•è°ƒé€’å¢åºåˆ—ï¼Œä¸”å·®å€¼ä¸º1ã€‚å¦‚æœå·¦è¾¹éƒ½æ¯”å³è¾¹å¤§å°±å¯åŒç†å¾—ã€‚ å¦‚æœç›¸ç­‰çš„è¯ï¼Œåªè€ƒè™‘ä¸ç›¸ç­‰ä¸€è¾¹çš„æƒ…å†µï¼Œå¦‚æœéƒ½ç›¸ç­‰åˆ™ä¸º1ã€‚ å°†æ•°ç»„æ‹†åˆ†ä¸€æ®µåˆä¸€æ®µçš„å•è°ƒåºåˆ—è¯ï¼Œå°±å‰©ä¸‹ä¸€ä¸ªæå¤§å€¼ç‚¹éœ€è¦è®¨è®º å¦‚æœæ¯”å·¦å³ä¸¤è¾¹éƒ½å¤§ï¼Œè¦åŒæ—¶æ»¡è¶³å·¦å³ä¸¤è¾¹çš„è¿™ç‚¹çš„ç³–æœæ•°å°±å–å†³äºå·¦å³ä¸¤è¾¹è°éœ€æ±‚çš„ç³–æœæ•°å¤§äº†ã€‚ ä¸€å¼€å§‹æˆ‘çš„æ€è·¯ï¼Œæ‰¾å•è°ƒé€’å¢å’Œé€’å‡çš„é•¿åº¦ï¼Œç®—ä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œæ‰“ç®—æ‰«ä¸€éç®—å‡ºæ¥ï¼Œä½†æ˜¯åæ¥æƒ³æƒ³å¥½åƒæƒ…å†µæœ‰ç‚¹å¤æ‚ï¼Œæ€»å…±æœ‰å››ç§æƒ…å†µï¼Œæ¯”ä¸¤è¾¹éƒ½å¤§çš„ç‚¹ï¼Œå³æå¤§å€¼ç‚¹è¿˜è¦å»éå†å³è¾¹æ‰èƒ½çŸ¥é“ä»–çš„å€¼ï¼Œè¿™æ ·çš„è¯å°±æ˜¯O(n^2),æ˜¾ç„¶ä¸è¡Œ ä¼˜åŒ–æ–¹æ³•å°±æ˜¯ä»å·¦å¾€å³å’Œä»å·¦å¾€å³éƒ½æ‰«ä¸€éï¼Œæ¯æ¬¡åªç®—ä¸€è¾¹çš„æƒ…å†µï¼Œç„¶åå–æå¤§å€¼ã€‚ å…·ä½“æ­¥éª¤ ä»å·¦è¾¹å¼€å§‹æ‰«ï¼Œå¦‚æœå·¦è¾¹æ¯”ä»–å¤§ï¼Œé‚£ä¹ˆç³–æœæ•°=å·¦è¾¹ç³–æœæ•°+1ï¼Œåä¹‹ä¸º1ã€‚ç³–æœæ•°ç»„è®°ä¸ºcandyL ä»å³è¾¹å¼€å§‹æ‰«ï¼Œå¦‚æœå³è¾¹æ¯”ä»–å¤§ï¼Œé‚£ä¹ˆç³–æœæ•°=å³è¾¹ç³–æœæ•°+1ï¼Œåä¹‹ä¸º1ã€‚ç³–æœæ•°ç»„è®°ä¸ºcandyR ä»å·¦è¾¹å¼€å§‹ç´¯åŠ max(candyL[i],candyR[i]),æœ€åè¾“å‡º ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930public int candy(int[] arr) { // write code here int ans = 0; int[] candyl=new int[arr.length+5]; int[] candyr=new int[arr.length+5]; int pre=arr[0]; candyl[0]=1; candyr[arr.length-1]=1; for (int i = 1; i &lt; arr.length; i++) { if(arr[i]&gt;pre){ candyl[i]=candyl[i-1]+1; }else { candyl[i]=1; } pre=arr[i]; } pre=arr[arr.length-1]; for (int i = arr.length-2; i &gt;= 0; i--) { if(arr[i]&gt;pre){ candyr[i]=candyr[i+1]+1; }else { candyr[i]=1; } pre=arr[i]; } for (int i=0;i&lt;arr.length;i++){ ans+=Math.max(candyl[i],candyr[i]); } return ans; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2022/12/30/BM95/"},{"title":"æ•°ç»„ä¸­çš„é€†åºå¯¹","text":"æ•°ç»„ä¸­çš„é€†åºå¯¹_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) é¢˜æ„ æ€è·¯å°è¯•ï¼šæ¯æ¬¡çœ‹åˆ°è¿™ä¸ªé¢˜ï¼Œæˆ‘éƒ½è€æ˜¯æƒ³è®°å½•åŸæ¥ä½ç½®ç„¶åå†æ’ä¸ªåºçœ‹çœ‹å’ŒåŸæ¥çš„å·®å€¼ï¼Œå³æ˜¯ç­”æ¡ˆã€‚åé¢æƒ³æƒ³å¿«é€Ÿæ’åºè¯•è¯•ï¼Œç§»åˆ°å‰é¢çš„+ä¸Šå·®å€¼ï¼Œç§»åˆ°åé¢çš„å‡å»å·®å€¼ï¼Œä¸­é—´è¿‡ç¨‹ä¸ä¸€å®šå°±æ˜¯å·®å€¼ã€‚ â€‹ ä½¿ç”¨å½’å¹¶æ’åºï¼Œæ’åºè¿‡ç¨‹ä¸­ï¼Œé€†åºå¯¹ä¼šéšç€å…ƒç´ æ…¢æ…¢ç§»åˆ°æ­£ç¡®çš„ä½ç½®è€Œå‡å°‘ï¼Œè€Œä¸”æ¯æ¬¡å‡å°‘çš„é€†åºå¯¹æ˜¯å¯ä»¥ç»Ÿè®¡çš„ã€‚å°†ä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œåˆå¹¶çš„æ—¶å€™ï¼Œå½“å³æ•°ç»„çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦æ•°ç»„çš„åŸæ¥ä½ç½®çš„æ—¶å€™ï¼Œå‡å°‘çš„é€†åºå¯¹æ•°ä¸ºç§»åŠ¨è·ç¦»ï¼Œè®°å½•è¯¥å€¼å³å¯ã€‚ â€‹ è‡³äºå–ä½™çš„é—®é¢˜æ¯æ¬¡éƒ½è¿›è¡Œcnt=(cnt+mod)%modå°±å¯ä»¥äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public long cnt = 0; public long mod = 1000000007; public void Merge(int[] array, int[] temp, int l, int r) { if(l&gt;=r) return; int mid=(l+r)/2; int pos=l,lpos=l,rpos=mid+1; while (lpos&lt;=mid&amp;&amp;rpos&lt;=r) { if (array[lpos]&lt;=array[rpos]){ temp[pos]=array[lpos]; lpos++; }else { temp[pos]=array[rpos]; cnt+=rpos-pos; cnt=(cnt+mod)%mod; rpos++; } pos++; } while(lpos&lt;=mid){ temp[pos]=array[lpos]; lpos++; pos++; } while(rpos&lt;=r){ temp[pos]=array[rpos]; rpos++; pos++; } for (int i = l; i &lt;= r; i++) { array[i]=temp[i]; } } public void MergeSort(int[] array, int[] temp, int l, int r) { int cnt; if (l &gt;= r) return; int mid = (l + r) / 2; MergeSort(array, temp, l, mid); MergeSort(array, temp, mid + 1, r); Merge(array,temp, l, r); } public int InversePairs(int[] array) { cnt = 0; int[] temp = new int[array.length]; MergeSort(array, temp, 0, array.length - 1); return (int) cnt; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2023/01/01/BM20/"},{"title":"BM75 ç¼–è¾‘è·ç¦»(ä¸€)","text":"é¢˜æ„ç¼–è¾‘è·ç¦»(ä¸€)_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯ä¸»è¦éš¾ç‚¹æ˜¯å¦‚ä½•å»ºç«‹dpæ•°ç»„ï¼Œæˆ‘å½“æ—¶æƒ³çš„æ˜¯ï¼ˆiï¼Œjï¼‰è¡¨ç¤ºçš„æ˜¯iå’Œjçš„åŒºé—´å·²ç»å®Œæˆæ“ä½œï¼Œä½†æ˜¯é€’æ¨æ–¹ç¨‹éœ€è¦å·¦è¾¹å’Œå³è¾¹éƒ½æœ‰ï¼Œæ‰€ä»¥ä¸è¡Œåç»­çš„jè¡¨ç¤ºé•¿åº¦çš„è¯ä¹Ÿä¸è¡Œã€‚å¿˜å¾—å¤ªå¿«äº†ã€‚ã€‚ã€‚ã€‚ é¢˜è§£ | #ç¼–è¾‘è·ç¦»(ä¸€)#_ç‰›å®¢åšå®¢ (nowcoder.net) æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå°†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²æœ€å°‘æ“ä½œä¸‹å˜æˆç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œè¿™å°±æ¶‰åŠäº†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å¢åŠ é•¿åº¦ï¼ŒçŠ¶æ€è½¬ç§»ï¼Œé‚£å¯ä»¥è€ƒè™‘åŠ¨æ€è§„åˆ’ã€‚ç”¨dp[i][j]è¡¨ç¤ºä»ä¸¤ä¸ªå­—ç¬¦ä¸²é¦–éƒ¨å„è‡ªåˆ°str1[i]å’Œstr2[j]ä¸ºæ­¢çš„å­ä¸²éœ€è¦çš„ç¼–è¾‘è·ç¦»ï¼Œé‚£å¾ˆæ˜æ˜¾dp[str1.length][str2.length]å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ç¼–è¾‘è·ç¦»ã€‚ï¼ˆä¸‹æ ‡ä»1å¼€å§‹ï¼‰ å…·ä½“åšæ³•ï¼š step 1ï¼šåˆå§‹æ¡ä»¶ï¼š å‡è®¾ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé‚£å¾ˆæ˜æ˜¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å­ä¸²æ¯å¢åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œç¼–è¾‘è·ç¦»å°±åŠ 1ï¼Œè¿™æ­¥æ“ä½œæ˜¯åˆ é™¤ï¼›åŒç†ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé‚£ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ¯å¢åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œç¼–è¾‘è·ç¦»å°±åŠ 1ï¼Œè¿™æ­¥æ“ä½œæ˜¯æ·»åŠ ã€‚ step 2ï¼šçŠ¶æ€è½¬ç§»ï¼š çŠ¶æ€è½¬ç§»è‚¯å®šæ˜¯å°†dpçŸ©é˜µå¡«æ»¡ï¼Œé‚£å°±éå†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªé•¿åº¦ï¼Œå¯¹åº”ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªé•¿åº¦ã€‚å¦‚æœéå†åˆ°str1[i]å’Œ str2[j]çš„ä½ç½®ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦ç›¸åŒï¼Œè¿™å¤šå‡ºæ¥çš„å­—ç¬¦å°±ä¸ç”¨æ“ä½œï¼Œæ“ä½œæ¬¡æ•°ä¸ä¸¤ä¸ªå­ä¸²çš„å‰ä¸€ä¸ªç›¸åŒï¼Œå› æ­¤æœ‰dp[i][j]=dp[i-1][j-1]ï¼›å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦éœ€è¦ç¼–è¾‘ï¼Œä½†æ˜¯æ­¤æ—¶çš„æœ€çŸ­çš„è·ç¦»ä¸ä¸€å®šæ˜¯ä¿®æ”¹è¿™æœ€åä¸€ä½ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ é™¤æŸä¸ªå­—ç¬¦æˆ–è€…å¢åŠ æŸä¸ªå­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬é€‰å–è¿™ä¸‰ç§æƒ…å†µçš„æœ€å°å€¼å¢åŠ ä¸€ä¸ªç¼–è¾‘è·ç¦»ï¼Œå³dp[i][j]=min(dp[i-1][j-1],dp[i][j-1],dp[i][j])+1ã€‚ 123456789101112131415161718192021222324public int editDistance(String str1, String str2) { // write code here int len1 = str1.length(); int len2 = str2.length(); int[][] dp = new int[len1 + 5][len2 + 5]; for (int i = 0; i &lt;= len1; i++) { dp[i][0] = i; } for (int i = 0; i &lt;= len2; i++) { dp[0][i] = i; } for (int i = 1; i &lt;= len1; i++) { for (int j = 1; j &lt;= len2; j++) { if (str1.charAt(i - 1) == str2.charAt(j - 1)) { dp[i][j] = dp[i - 1][j - 1]; } else { dp[i][j] = dp[i - 1][j - 1] + 1; dp[i][j] = Math.min(dp[i - 1][j] + 1, dp[i][j]); dp[i][j] = Math.min(dp[i][j - 1] + 1, dp[i][j]); } } } return dp[len1][len2]; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2023/01/06/BM75/"},{"title":"Javaé—®é¢˜æ”¶é›†","text":"ç†è§£åŸç ã€åç ã€è¡¥ç ã€ç§»ç  ç¬¦å·ä½ï¼š0ä½æ­£æ•°ï¼Œ1ä¸ºè´Ÿæ•° åŸç ä¸èƒ½è¿›è¡Œè¿ç®— æ­£æ•°çš„åŸç å’Œåç ä¸€æ ·ï¼Œè´Ÿæ•°çš„åç æ˜¯åœ¨åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å–å æ­£æ•°çš„è¡¥ç å’Œåç ä¸€æ ·ï¼Œè´Ÿæ•°çš„è¡¥ç æ˜¯åœ¨åç çš„åŸºç¡€ä¸Šè¿›è¡Œï¼‹1æ“ä½œ ç§»ç æ˜¯åœ¨è¡¥ç çš„åŸºç¡€ä¸Šï¼ŒæŠŠç¬¦å·ä½å–å 1 -1 1+ï¼ˆ-1ï¼‰ ç»“æœ åŸç  0000 0001 1000 0001 1000 0010 -2 åç  0000 0001 1111 1110 1111 1111 -0 è¡¥ç  0000 0001 1111 1111 0000 0000 +0 ç§»ç  1000 0001 0111 1111 1000 0000 0 å–å€¼èŒƒå›´ æ•´æ•° n=8 åŸç  -(2^(n-1)-1)~2^(n-1)-1 -127~127 åç  -(2^(n-1)-1)~2^(n-1)-1 -127~127 è¡¥ç  -2^(n-1)~2^(n-1)-1 -128~127 StringJava 9 ä¸ºä½•è¦å°† String çš„åº•å±‚å®ç°ç”± char[] æ”¹æˆäº† byte[] ?JEP 254ï¼š ç´§å‡‘å­—ç¬¦ä¸² (openjdk.org) æˆ‘ä»¬å»ºè®®æ›´æ”¹ç±»çš„å†…éƒ¨è¡¨ç¤º ä» UTF-16 æ•°ç»„åˆ°æ•°ç»„åŠ ä¸Šç¼–ç æ ‡å¿—å­—æ®µã€‚ æ–°ç±»å°†å­˜å‚¨ç¼–ç ä¸º ISO-8859-1/Latin-1ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œæˆ– UTF-16ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚ï¼‰ å­—ç¬¦ï¼‰ å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?å¯ä»¥ä»å­—èŠ‚ç é‡Œçœ‹å‡º å­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ ã€‚ ä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼šç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª StringBuilder ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„ StringBuilder å¯¹è±¡ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/java-basic-questions-02.html Javaä»£ç†åå°„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ ï¼š å¯ä»¥è®©å’±ä»¬çš„ä»£ç æ›´åŠ çµæ´»ã€ä¸ºå„ç§æ¡†æ¶æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½æä¾›äº†ä¾¿åˆ© ç¼ºç‚¹ ï¼šè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶æœ‰äº†åˆ†ææ“ä½œç±»çš„èƒ½åŠ›ï¼Œè¿™åŒæ ·ä¹Ÿå¢åŠ äº†å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚å¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼‰ã€‚å¦å¤–ï¼Œåå°„çš„æ€§èƒ½ä¹Ÿè¦ç¨å·®ç‚¹ï¼Œä¸è¿‡ï¼Œå¯¹äºæ¡†æ¶æ¥è¯´å®é™…æ˜¯å½±å“ä¸å¤§çš„ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/reflection.html åå°„ä¸ºä»€ä¹ˆæ…¢Reflection is slow for a few obvious reasons: The compiler can do no optimization whatsoever as it can have no real idea about what you are doing. This probably goes for the JIT as well Everything being invoked/created has to be discovered (i.e. classes looked up by name, methods looked at for matches etc) Arguments need to be dressed up via boxing/unboxing, packing into arrays, Exceptions wrapped in InvocationTargetExceptions and re-thrown etc. All the processing that Jon Skeet mentions here. performance - Java Reflection: Why is it so slow? - Stack Overflow é™æ€ä»£ç†éœ€è¦æ‰‹åŠ¨å®ç°ä¸€ä¸ªä»£ç†ç±»ï¼Œå®é™…åº”ç”¨ä¸­è¾ƒå°‘ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å¯¹æ¯” JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚ å¦å¤–ï¼Œ CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä»£ç†å£°æ˜ä¸º final ç±»å‹çš„ç±»å’Œæ–¹æ³•ã€‚ å°±äºŒè€…çš„æ•ˆç‡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ JDK åŠ¨æ€ä»£ç†æ›´ä¼˜ç§€ï¼Œéšç€ JDK ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™ä¸ªä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/proxy.html é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯” çµæ´»æ€§ ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼ JVM å±‚é¢ ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/proxy.html BigDecimalæµ®ç‚¹æ•°ä¹‹é—´çš„ç­‰å€¼åˆ¤æ–­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸èƒ½ç”¨ == æ¥æ¯”è¾ƒï¼ŒåŒ…è£…æ•°æ®ç±»å‹ä¸èƒ½ç”¨ equals æ¥åˆ¤æ–­ã€‚ æˆ‘ä»¬åœ¨ä½¿ç”¨ BigDecimal æ—¶ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦ä¸¢å¤±ï¼Œæ¨èä½¿ç”¨å®ƒçš„BigDecimal(String val)æ„é€ æ–¹æ³•æˆ–è€… BigDecimal.valueOf(double val) é™æ€æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ å¤§å°æ¯”è¾ƒä½¿ç”¨ a.compareTo(b)ï¼Œ equals() æ–¹æ³•ä¸ä»…ä»…ä¼šæ¯”è¾ƒå€¼çš„å¤§å°ï¼ˆvalueï¼‰è¿˜ä¼šæ¯”è¾ƒç²¾åº¦ï¼ˆscaleï¼‰ï¼Œè€Œ compareTo() æ–¹æ³•æ¯”è¾ƒçš„æ—¶å€™ä¼šå¿½ç•¥ç²¾åº¦ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/bigdecimal.html","link":"/2023/02/20/JavaProblem/"},{"title":"Javaé›†åˆ","text":"å‚è€ƒhttps://javaguide.cn/ ArrayListæ„é€ å‡½æ•° æ ¡éªŒåˆå§‹å®¹é‡ å¦‚æœæ˜¯æ— å‚æ„é€ ï¼Œé‚£ä¹ˆè¿˜æ˜¯èµ‹å€¼ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™ä¼šè¾¨åˆ«;åä¹‹åˆ™æ„é€ ä¸€ä¸ªç©ºçš„æ•°ç»„DEFAULTCAPACITY_EMPTY_ELEMENTDATAï¼Œä½†æ˜¯ä¸‹æ¬¡æ‰©å®¹ä¼šå–æœ€å°æ‰©å®¹é‡ä¸é»˜è®¤åˆå§‹åŒ–é•¿åº¦ï¼ˆä¸€èˆ¬ä¸º10ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚ æ‰©å®¹è¿‡ç¨‹addå‡½æ•°æ ¡éªŒå¤§å°è·å–æœ€å°‘éœ€è¦é•¿åº¦é€šå¸¸æ˜¯æ’å…¥æ•°é‡+å½“å‰é•¿åº¦ï¼Œ growå‡½æ•°å¦‚æœä¸å¤Ÿå°±è¿›è¡Œæ‰©å®¹ï¼Œå¹¶ç¡®å®šæ‰©å®¹å¤§å°ï¼Œæ¯æ¬¡æ‰©å®¹å˜æˆåŸæ¥çš„1.5å€ï¼Œ0.5å€ç”±æ— ç¬¦å·å³ç§»ä¸€ä½å¾—åˆ°ï¼Œæ–°é•¿åº¦æœ‰æœ€å°‘éœ€è¦é•¿åº¦ä¸åŸæ¥é•¿åº¦çš„1.5å€çš„æœ€å¤§å€¼å¾—åˆ°ï¼Œä½†æ˜¯ä¸è¶…è¿‡SOFT_MAX_ARRAY_LENGTHï¼Œè¯¥å€¼ä¸ºIntçš„æœ€å¤§å€¼-8ï¼Œæ˜¯ç”±äºéƒ¨åˆ†javaè™šæ‹Ÿæœºéœ€è¦å­˜æ”¾object headerä¼šå¯¼è‡´å †æ ˆæº¢å‡ºï¼ŒJavaä¸­çš„å¯¹è±¡å¤´ä¿¡æ¯ï¼ˆæ•°ç»„é•¿åº¦ï¼‰éœ€è¦å ç”¨8ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œæ‰€ä»¥é€‰æ‹©äº†ä¸ªç•¥å°äºæœ€å¤§å€¼çš„å€¼ã€‚ Arrays.copyOf(elementData, newCapacity);å°†å…ƒç´ èµ‹å€¼åˆ°æ–°åœ°æ–¹ HashMapTableSizeFor()é€šè¿‡-1æ— ç¬¦å·å³ç§»ç»™å®šå®¹é‡çš„å‰å¯¼é›¶é•¿åº¦+1å¾—åˆ°æœ€æ¥è¿‘çš„2å¹‚æ¬¡-1ï¼ŒåŒæ—¶ä¸æœ€å¤§å®¹é‡è¿›è¡Œæ¯”è¾ƒ 12int n = -1 &gt;&gt;&gt; Integer.numberOfLeadingZeros(cap - 1);return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; æ„é€ å‡½æ•°ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚ å‚æ•°å¸¦å®¹é‡æˆ–è€…è´Ÿè½½å› å­é‚£å°±éœ€è¦TableSizeFor()å‡½æ•°ç¡®å®štableå¤§å° å“ˆå¸Œæ–¹æ³•12345//JDK1.7h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);//JDK1.8return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); å®šä½æ–¹æ³•(n - 1) &amp; hash nä¸ºå“ˆå¸Œè¡¨é•¿åº¦ put æ–¹æ³•é¦–å…ˆåˆ¤æ–­æ•°ç»„æ˜¯å¦ç»è¿‡åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦è¿›è¡Œåˆå§‹åŒ– å®šä½æ•°ç»„ä½ç½®ï¼Œå¦‚æœæ— èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥æ’å…¥,å¹¶æ£€éªŒå®¹é‡æ˜¯å¦è¾¾åˆ°ä¸Šé™ å¦‚æœå­˜åœ¨ç›¸åŒçš„keyï¼Œåˆ™ç›´æ¥è¦†ç›–å¹¶è¿”å›ï¼Œå› ä¸ºæ²¡æœ‰èŠ‚ç‚¹å¢åŠ  å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥ å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯æ™®é€šé“¾è¡¨èŠ‚ç‚¹ï¼Œæ’å…¥èŠ‚ç‚¹å…ˆåˆ¤æ–­æ’å…¥åï¼ˆé“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰å¹¶ä¸” HashMap æ•°ç»„é•¿åº¦è¶…è¿‡ 64 çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ“ä½œï¼Œå¦åˆ™å°±åªæ˜¯å¯¹æ•°ç»„æ‰©å®¹ï¼‰ resize()æ–¹æ³•å®¹é‡å‚æ•°è®¾ç½®é¦–å…ˆåˆ¤æ–­åŸæ¥çš„tableæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰æŒ‡å®šloadFactorå’Œthresholdåˆ™ä½¿ç”¨é»˜è®¤çš„ï¼Œ å¦‚æœä¸ä¸ºç©ºï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„ä¸¤å€ã€‚ åŒæ—¶æ›´æ–°thresholdå‚æ•°ï¼Œå¹¶å¼€è¾Ÿæ–°çš„nodeæ•°ç»„ç©ºé—´ è¿›è¡Œè¿ç§»å¦‚æœtableä¸ºç©ºï¼Œç›´æ¥è·³è¿‡ã€‚ éå†nodeæ•°ç»„{ â€‹ å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™newTab[e.hash &amp; (newCap - 1)] = e; â€‹ å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œä¼šéå†çº¢é»‘æ ‘ï¼Œæ ¹æ®e.hash &amp; oldCapçš„å€¼åŒºåˆ†ä¸åŒçš„ä½ç½®(åœ¨åŸæ¥ä½ç½®jï¼Œè¿˜æ˜¯j+oldcap)ï¼Œä¸”å½“æ‹†åˆ†å¼€çš„çº¢é»‘æ ‘çš„èŠ‚ç‚¹æ•°å°äº6çš„æ—¶å€™ä¼šå˜æˆé“¾è¡¨æ’å…¥åˆ°nodeæ•°ç»„ä¸­ â€‹ é“¾è¡¨åŒç†ï¼Œéå†é“¾è¡¨æ ¹æ®e.hash &amp; oldCapçš„å€¼åŒºåˆ†ä¸åŒçš„ä½ç½®(åœ¨åŸæ¥ä½ç½®jï¼Œè¿˜æ˜¯j+oldcap) } ConcurrentHashMapç¿»äº†ConcurrentHashMap1.7 å’Œ1.8çš„æºç ï¼Œæˆ‘æ€»ç»“äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ã€‚ - æ˜é‡‘ (juejin.cn) 1.7 segment+hashentry +é“¾è¡¨çš„å½¢å¼ ConcurrnetHashMap ç”±å¾ˆå¤šä¸ª Segment ç»„åˆï¼Œè€Œæ¯ä¸€ä¸ª Segment æ˜¯ä¸€ä¸ªç±»ä¼¼äº HashMap çš„ç»“æ„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª HashMap çš„å†…éƒ¨å¯ä»¥è¿›è¡Œæ‰©å®¹ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ï¼Œé»˜è®¤ Segment çš„ä¸ªæ•°æ˜¯ 16 ä¸ªï¼Œä½ ä¹Ÿå¯ä»¥è®¤ä¸º ConcurrentHashMap é»˜è®¤æ”¯æŒæœ€å¤š 16 ä¸ªçº¿ç¨‹å¹¶å‘ é»˜è®¤åˆå§‹åŒ–å®¹é‡16;é»˜è®¤è´Ÿè½½å› å­ 0.75f;é»˜è®¤å¹¶å‘çº§åˆ«16; 1.8(38æ¡æ¶ˆæ¯) ConcurrentHashMapåº•å±‚è¯¦è§£(å›¾è§£æ‰©å®¹)ï¼ˆJDK1.8ï¼‰_concurrenthashmapæ‰©å®¹_ç¼–ç¨‹èŠå£«çš„åšå®¢-CSDNåšå®¢ 1234static final int MOVED = -1; // hash for forwarding nodesstatic final int TREEBIN = -2; // hash for roots of treesstatic final int RESERVED = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hash å˜é‡sizeCtl -1 è¯´æ˜æ­£åœ¨åˆå§‹åŒ–ï¼Œå¦‚æœå‘ç°æ­£åœ¨åˆå§‹åŒ–Thread.yield(); -N è¯´æ˜æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹ 0 è¡¨ç¤º table åˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœ table æ²¡æœ‰åˆå§‹åŒ– &gt;0 è¡¨ç¤º table æ‰©å®¹çš„é˜ˆå€¼ï¼Œå¦‚æœ table å·²ç»åˆå§‹åŒ–ã€‚ åˆå§‹åŒ–è¡¨1234567891011121314151617181920212223242526private final Node&lt;K,V&gt;[] initTable() { Node&lt;K,V&gt;[] tab; int sc; // ç±»ä¼¼CASæ–¹æ³• å¾ªç¯åˆå§‹åŒ–è¡¨ while ((tab = table) == null || tab.length == 0) { if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin // CAS else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) { try { // æ£€æŸ¥è¡¨æ˜¯å¦åˆå§‹åŒ– if ((tab = table) == null || tab.length == 0) { int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; // 0.75 sc = n - (n &gt;&gt;&gt; 2); } } finally { sizeCtl = sc; } break; } } return tab;} put()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768final V putVal(K key, V value, boolean onlyIfAbsent) { if (key == null || value == null) throw new NullPointerException(); int hash = spread(key.hashCode()); int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) { Node&lt;K,V&gt; f; int n, i, fh; K fk; V fv; if (tab == null || (n = tab.length) == 0) tab = initTable(); else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value))) break; // no lock when adding to empty bin } else if ((fh = f.hash) == MOVED) tab = helpTransfer(tab, f); else if (onlyIfAbsent // check first node without acquiring lock &amp;&amp; fh == hash &amp;&amp; ((fk = f.key) == key || (fk != null &amp;&amp; key.equals(fk))) &amp;&amp; (fv = f.val) != null) return fv; else { V oldVal = null; synchronized (f) { if (tabAt(tab, i) == f) { if (fh &gt;= 0) { binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) { K ek; if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) { oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; } Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) { pred.next = new Node&lt;K,V&gt;(hash, key, value); break; } } } else if (f instanceof TreeBin) { Node&lt;K,V&gt; p; binCount = 2; if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) { oldVal = p.val; if (!onlyIfAbsent) p.val = value; } } else if (f instanceof ReservationNode) throw new IllegalStateException(&quot;Recursive update&quot;); } } if (binCount != 0) { if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; } } } addCount(1L, binCount); return null;} æ ¹æ® key è®¡ç®—å‡º hashcodeï¼Œkeyå’Œvalueå‡ä¸èƒ½ä¸ºnull ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ– å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™å¸®åŠ©æ‰©å®¹ã€‚ å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”ä½è¿™ä¸ªæ¡¶,æ‰¾åˆ°å¯¹åº”keyæ›¿æ¢å€¼ï¼Œæˆ–è€…æ’å…¥åˆ°æœ«å°¾ å¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦æ‰§è¡Œæ ‘åŒ–æ–¹æ³•ï¼Œåœ¨ treeifyBin ä¸­ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰æ•°ç»„é•¿åº¦â‰¥64æ—¶æ‰ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¸é“¾è¡¨ä¸åŒçš„æ˜¯è¿™ä¸ªæ—¶å€™å“ˆå¸Œæ¡¶é‡Œé¢å­˜æ”¾çš„æ˜¯TreeBinç±»ï¼Œè¯¥ç±»ä¸­æœ‰å„ç§çº¢é»‘æ ‘çš„æ–¹æ³• get()12345678910111213141516171819public V get(Object key) { Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) { if ((eh = e.hash) == h) { if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; } else if (eh &lt; 0) return (p = e.find(h, key)) != null ? p.val : null; while ((e = e.next) != null) { if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; } } return null;} æ ¹æ® hash å€¼è®¡ç®—ä½ç½®ã€‚ æŸ¥æ‰¾åˆ°æŒ‡å®šä½ç½®ï¼Œå¦‚æœå¤´èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„ï¼Œç›´æ¥è¿”å›å®ƒçš„ value. å¦‚æœå¤´èŠ‚ç‚¹ hash å€¼å°äº 0 ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾ä¹‹ã€‚ 123static final int MOVED = -1; // hash for forwarding nodesstatic final int TREEBIN = -2; // hash for roots of treesstatic final int RESERVED = -3; // hash for transient reservations å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾ä¹‹ã€‚ addCount()1234567891011121314151617181920212223242526272829303132333435private final void addCount(long x, int check) { CounterCell[] cs; long b, s; if ((cs = counterCells) != null || !U.compareAndSetLong(this, BASECOUNT, b = baseCount, s = b + x)) { CounterCell c; long v; int m; boolean uncontended = true; if (cs == null || (m = cs.length - 1) &lt; 0 || (c = cs[ThreadLocalRandom.getProbe() &amp; m]) == null || !(uncontended = U.compareAndSetLong(c, CELLVALUE, v = c.value, v + x))) { fullAddCount(x, uncontended); return; } if (check &lt;= 1) return; s = sumCount(); } if (check &gt;= 0) { Node&lt;K,V&gt;[] tab, nt; int n, sc; while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) { int rs = resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT; if (sc &lt; 0) { if (sc == rs + MAX_RESIZERS || sc == rs + 1 || (nt = nextTable) == null || transferIndex &lt;= 0) break; if (U.compareAndSetInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); } else if (U.compareAndSetInt(this, SIZECTL, sc, rs + 2)) transfer(tab, null); s = sumCount(); } }} ä½¿ç”¨äº†countercellæ•°ç»„çš„æ–¹æ³•æ¥è®¡æ•°ï¼Œå•ä¸ªæˆå‘˜å˜é‡è¿›è¡Œä¿®æ”¹çš„æ—¶å€™å†²çªè¾ƒå¤§ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†ç‰‡çš„æ–¹æ³•è¿›è¡Œè®¡æ•°ï¼Œæ–¹æ³•ç±»ä¼¼äºLongAdderè®¡æ•° å¦‚æœcountercellsæ•°ç»„ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥casè®¾ç½®baseCountå˜é‡ï¼Œå¤±è´¥äº†æ‰è¿›å…¥ifé‡Œé¢ï¼Œåˆå§‹åŒ–counterCellsï¼Œä½¿ç”¨fullCountåˆå§‹åŒ–å’Œé‡æ–°è®¡æ•°counterCellsï¼Œä½¿ç”¨sumCountæ–¹æ³•éå†counterCells è·å–æœ€åå®¹é‡ å¦‚æœcheckå¤§äº0ï¼Œå¦‚æœæ£€æŸ¥æ·»åŠ çš„å…ƒç´ é‡æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœå½“å‰éœ€è¦æ‰©å®¹ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰©å®¹æœ‰å°±æ›´æ–°sizeCTL+1ï¼ˆçº¿ç¨‹æ•°+1ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å°±æ›´æ–°sizeCTl rs+2ï¼ˆå¦‚æœæ²¡æœ‰å› ä¸º-1ä¸ºåˆå§‹åŒ–ï¼‰é‡æ–°è®¡æ•°ï¼Œå¹¶ä¸”ä¹Ÿè¦å°äºæœ€å¤§æ‰©å®¹çº¿ç¨‹æ•° Transfer()123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) { int n = tab.length, stride; if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range if (nextTab == null) { // initiating try { @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; } catch (Throwable ex) { // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; } nextTable = nextTab; transferIndex = n; } int nextn = nextTab.length; ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); boolean advance = true; boolean finishing = false; // to ensure sweep before committing nextTab for (int i = 0, bound = 0;;) { Node&lt;K,V&gt; f; int fh; while (advance) { int nextIndex, nextBound; if (--i &gt;= bound || finishing) advance = false; else if ((nextIndex = transferIndex) &lt;= 0) { i = -1; advance = false; } else if (U.compareAndSetInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) { bound = nextBound; i = nextIndex - 1; advance = false; } } if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) { int sc; if (finishing) { nextTable = null; table = nextTab; sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; } if (U.compareAndSetInt(this, SIZECTL, sc = sizeCtl, sc - 1)) { if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; finishing = advance = true; i = n; // recheck before commit } } else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); else if ((fh = f.hash) == MOVED) advance = true; // already processed else { synchronized (f) { if (tabAt(tab, i) == f) { Node&lt;K,V&gt; ln, hn; if (fh &gt;= 0) { int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) { int b = p.hash &amp; n; if (b != runBit) { runBit = b; lastRun = p; } } if (runBit == 0) { ln = lastRun; hn = null; } else { hn = lastRun; ln = null; } for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) { int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); } setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; } else if (f instanceof TreeBin) { TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) { int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) { if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; } else { if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; } } ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; } else if (f instanceof ReservationNode) throw new IllegalStateException(&quot;Recursive update&quot;); } } } }} é¦–å…ˆå…ˆåˆ’åˆ†æ¯ä¸ªçº¿ç¨‹çš„æ­¥é•¿ ä¸º(n &gt;&gt;&gt; 3) / NCPUï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªcpué‚£ä¹ˆæ­¥é•¿ä¸ºæ•´ä¸ªè¡¨ï¼ŒåŒæ—¶è¿˜ä¼šåœ¨æ ¡éªŒä¸€æ¬¡æ­¥é•¿ï¼Œå°äº16åˆ™è®¾ç½®ä¸º16 å¦‚æœnextTabä¸ºç©ºåˆ™ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç”³è¯·åŸæœ‰æ•°é‡ä¸¤å€çš„æ•°ç»„ï¼Œå¦‚æœoomäº†åˆ™sizeCtlè®¾ä¸ºintæœ€å¤§å€¼ ç„¶åå°±å¼€å§‹åˆ’åˆ†æ•°ç»„ï¼Œå¦‚æœnodeæ•°ç»„ä½ç½®ä¸ºç©ºåˆ™ç›´æ¥è®¾ç½®fwdèŠ‚ç‚¹è¡¨ç¤ºå·²ç»å®Œæˆï¼Œmovedæ ‡å¿—è¡¨ç¤ºè¯¥ä½ç½®å·²ç»å®Œæˆè¿ç§»æ— éœ€æ“ä½œï¼Œå¦åˆ™æ‰ä¼šè¿›å…¥åˆ°é“¾è¡¨å’Œçº¢é»‘æ ‘çš„è¿ç§»è¿‡ç¨‹ï¼Œç±»ä¼¼äºHashMapå°±ä¸åœ¨èµ˜è¿°ï¼Œæœ€åä¸€æ­¥åŒæ ·ä¹Ÿä¼šè®¾ç½®fwdèŠ‚ç‚¹è¡¨ç¤ºå·²ç»å®Œæˆ å®Œæˆç‰¹å®šæ­¥é•¿åï¼ŒsizeCtl-1è®¾ç½®ç»“æŸæ ‡å¿—é€€å‡ºï¼Œå½“æœ€åä¸€ä¸ªçº¿ç¨‹å®Œæˆåï¼Œä»–è¿˜ä¼šå¯¹å…¨éƒ¨æ•°ç»„è¿›è¡Œä¸ªéå†ç¡®è®¤æ˜¯å¦æœ‰é—æ¼ã€‚","link":"/2023/03/30/JavaCollection/"},{"title":"java å¹¶å‘","text":"å‚è€ƒé“¾æ¥ï¼šhttps://javaguide.cn/java/concurrent/java-concurrent-questions-02.html å‚è€ƒä¹¦ç±ï¼šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆ Java å¯¹è±¡å¤´ Mark Word æŒ‡å‘ç±»çš„æŒ‡é’ˆ æ•°ç»„é•¿åº¦ï¼ˆåªæœ‰æ•°ç»„å¯¹è±¡æ‰æœ‰ï¼‰ 32ä½å¤§å°å‡ä¸º4ä¸ªå­—èŠ‚ javaå¯¹è±¡é‡‡å–8å­—èŠ‚å¯¹é½ é«˜ç«¯é¢è¯•å¿…å¤‡ï¼šä¸€ä¸ªJavaå¯¹è±¡å ç”¨å¤šå¤§å†…å­˜ - rickiyang - åšå®¢å›­ (cnblogs.com) synchronizedä¸»è¦è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ å†ç¨‹åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronized å±äº é‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ã€‚è¿™æ˜¯å› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚ åœ¨ Java 6 ä¹‹åï¼Œ synchronized å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–å¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚ ä½¿ç”¨æ–¹æ³•synchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class) ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ï¼› synchronized å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ï¼› å°½é‡ä¸è¦ä½¿ç”¨ synchronized(String a) å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ã€‚ synchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚ synchronized ä¿®é¥°çš„æ–¹æ³•æ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚JVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å®ä¾‹å¯¹è±¡çš„é”ã€‚å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å½“å‰ class çš„é”ã€‚ é”åˆ†ç±»çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼š æ— é”çŠ¶æ€ åå‘é”çŠ¶æ€ è½»é‡çº§é”çŠ¶æ€ é‡é‡çº§é”çŠ¶æ€ é”å¯ä»¥å‡çº§ï¼Œä½†ä¸èƒ½é™çº§ã€‚å³ï¼šæ— é” -&gt; åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”æ˜¯å•å‘çš„ã€‚ é”çš„å‡çº§å‚è€ƒ æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºçä¼˜åŒ–éƒ¨åˆ† è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹åœ¨JDK 6ä¸­å¯¹è‡ªæ—‹é”çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†æ˜¯å›ºå®šçš„äº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚ å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ï¼Œæ¯”å¦‚æŒç»­100æ¬¡å¿™å¾ªç¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡é”ï¼Œé‚£åœ¨ä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†æœ‰å¯èƒ½ç›´æ¥çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ é”æ¶ˆé™¤é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯ã€‚ å½“ç¼–è¯‘å™¨ç¡®å®šä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œå®ƒä¾¿ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚ å‡½æ•°é‡Œå¤šä¸ªåŒæ­¥æ–¹æ³•ï¼Œä¸”æ‰€æœ‰å¼•ç”¨æ²¡æ³•é€ƒé€¸å‡ºå‡½æ•°çš„ä½¿ç”¨èŒƒå›´ï¼Œå°±å¯ä»¥å»é™¤åŒæ­¥æ–¹æ³•ã€‚ é¢å¤–æ ‡é‡æ›¿æ¢ é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼ŒåŸºç¡€ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºæ ‡é‡ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡ã€‚ å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åšæ ‡é‡æ›¿æ¢ã€‚ è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚ æ ‡é‡æ›¿æ¢åœ¨ JDK1.8 ä¸­ä¹Ÿæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿè¦å»ºç«‹åœ¨å·²å¼€å¯é€ƒé€¸åˆ†æçš„åŸºç¡€ä¹‹ä¸Šã€‚ æ ˆå†…å­˜åˆ†é… æ ˆå†…å­˜åˆ†é…å¾ˆå¥½ç†è§£ï¼Œåœ¨ä¸Šæ–‡ä¸­æè¿‡ï¼Œå°±æ˜¯å°†åŸæœ¬åˆ†é…åœ¨å †å†…å­˜ä¸Šçš„å¯¹è±¡è½¬è€Œåˆ†é…åœ¨æ ˆå†…å­˜ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å †å†…å­˜çš„å ç”¨ï¼Œä»è€Œå‡å°‘ GC çš„é¢‘æ¬¡ã€‚ é”ç²—åŒ–å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°æœ‰è¿™æ ·ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ è½»é‡çº§é”åŠ é”è¿‡ç¨‹ï¼Œä¼šå…ˆåœ¨æ ˆå¸§å¼€è¾Ÿä¸€ä¸ªé”è®°å½•çš„ç©ºé—´ï¼Œè®°å½•åŸæ¥markwordä¸­çš„å€¼ï¼Œ è™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•æŠŠå¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆ è§£é”è¿‡ç¨‹ä¹ŸåŒæ ·æ˜¯é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œå¦‚æœå¯¹è±¡çš„Mark Wordä»ç„¶æŒ‡å‘çº¿ç¨‹çš„é”è®°å½•ï¼Œé‚£å°±ç”¨CASæ“ä½œæŠŠå¯¹è±¡å½“å‰çš„Mark Wordå’Œçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordæ›¿æ¢å›æ¥ã€‚å‡å¦‚èƒ½å¤ŸæˆåŠŸæ›¿æ¢ï¼Œé‚£æ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±é¡ºåˆ©å®Œæˆäº†ï¼›å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼Œå°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ åå‘é”Java6åŠä»¥ä¸Šç‰ˆæœ¬å¯¹synchronizedçš„ä¼˜åŒ– - èœ—ç‰›å¤§å¸ˆ - åšå®¢å›­ (cnblogs.com) å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å–çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†ä¼šæŠŠå¯¹è±¡å¤´ä¸­çš„æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ01â€ã€æŠŠåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºè¿›å…¥åå‘æ¨¡å¼ã€‚åŒæ—¶ä½¿ç”¨CASæ“ä½œæŠŠè·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹çš„IDè®°å½•åœ¨å¯¹è±¡çš„Mark Wordä¹‹ä¸­ã€‚å¦‚æœCASæ“ä½œæˆåŠŸï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ä¸å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼ˆä¾‹å¦‚åŠ é”ã€è§£é”åŠå¯¹Mark Wordçš„æ›´æ–°æ“ä½œç­‰ï¼‰ã€‚ ä¸€æ—¦å‡ºç°å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”çš„æƒ…å†µï¼Œåå‘æ¨¡å¼å°±é©¬ä¸Šå®£å‘Šç»“æŸã€‚æ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦å¤„äºè¢«é”å®šçš„çŠ¶æ€å†³å®šæ˜¯å¦æ’¤é”€åå‘ï¼ˆåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ0â€ï¼‰ï¼Œæ’¤é”€åæ ‡å¿—ä½æ¢å¤åˆ°æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ï¼Œåç»­çš„åŒæ­¥æ“ä½œå°±æŒ‰ç…§ä¸Šé¢ä»‹ç»çš„è½»é‡çº§é”é‚£æ ·å»æ‰§è¡Œã€‚åå‘é”ã€è½»é‡çº§é”çš„çŠ¶æ€è½¬åŒ–åŠå¯¹è±¡Mark Wordçš„å…³ç³»å¦‚å›¾æ‰€ç¤ºã€‚ å½“ä¸€ä¸ªå¯¹è±¡å·²ç»è®¡ç®—è¿‡ä¸€è‡´æ€§å“ˆå¸Œç åï¼Œå®ƒå°±å†ä¹Ÿæ— æ³•è¿›å…¥åå‘é”çŠ¶æ€äº†ï¼›è€Œå½“ä¸€ä¸ªå¯¹è±¡å½“å‰æ­£å¤„äºåå‘é”çŠ¶æ€ï¼Œåˆæ”¶åˆ°éœ€è¦è®¡ç®—å…¶ä¸€è‡´æ€§å“ˆå¸Œç è¯·æ±‚[1]æ—¶ï¼Œå®ƒçš„åå‘çŠ¶æ€ä¼šè¢«ç«‹å³æ’¤é”€ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚(è¿™é‡Œè¯´çš„è®¡ç®—è¯·æ±‚åº”æ¥è‡ªäºå¯¹Object::hashCode()æˆ–è€…System::identityHashCode(Object)æ–¹æ³•çš„è°ƒç”¨ï¼Œå¦‚æœé‡å†™äº†å¯¹è±¡çš„hashCode()æ–¹æ³•ï¼Œè®¡ç®—å“ˆå¸Œç æ—¶å¹¶ä¸ä¼šäº§ç”Ÿè¿™é‡Œæ‰€è¯´çš„è¯·æ±‚) Javaå†…å­˜æ¨¡å‹ è¿™é‡Œæ‰€è®²çš„ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸ç¬¬2ç« æ‰€è®²çš„Javaå†…å­˜åŒºåŸŸä¸­çš„Javaå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å¯¹å†…å­˜çš„åˆ’åˆ†ï¼Œè¿™ä¸¤è€…åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚å¦‚æœä¸¤è€…ä¸€å®šè¦å‹‰å¼ºå¯¹åº”èµ·æ¥ï¼Œé‚£ä¹ˆä»å˜é‡ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜çš„å®šä¹‰æ¥çœ‹ï¼Œä¸»å†…å­˜ä¸»è¦å¯¹åº”äºJavaå †ä¸­çš„å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†[4]ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯¹åº”äºè™šæ‹Ÿæœºæ ˆä¸­çš„éƒ¨åˆ†åŒºåŸŸã€‚ UnsafeUnsafe æ˜¯ä½äº sun.misc åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œè¿™äº›æ–¹æ³•åœ¨æå‡ Java è¿è¡Œæ•ˆç‡ã€å¢å¼º Java è¯­è¨€åº•å±‚èµ„æºæ“ä½œèƒ½åŠ›æ–¹é¢èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ ä¸»è¦åŠŸèƒ½åˆ†ç±» å†…å­˜æ“ä½œ å†…å­˜å±éšœ 123456//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰public native void loadFence();//å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰public native void storeFence();//å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åºpublic native void fullFence(); å¯¹è±¡æ“ä½œ æ•°æ®æ“ä½œ CAS æ“ä½œ çº¿ç¨‹è°ƒåº¦ Class æ“ä½œ ç³»ç»Ÿä¿¡æ¯ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/unsafe.html ä¸ºå•¥è¦ä½¿ç”¨å †å¤–å†…å­˜ã€‚é€šå¸¸å› ä¸ºï¼š åœ¨è¿›ç¨‹é—´å¯ä»¥å…±äº«ï¼Œå‡å°‘è™šæ‹Ÿæœºé—´çš„å¤åˆ¶ å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ï¼šå¦‚æœåº”ç”¨æŸäº›é•¿æœŸå­˜æ´»å¹¶å¤§é‡å­˜åœ¨çš„å¯¹è±¡ï¼Œç»å¸¸ä¼šå‡ºå‘YGCæˆ–è€…FullGCï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™äº›å¯¹è±¡æ”¾åˆ°å †å¤–ã€‚è¿‡å¤§çš„å †ä¼šå½±å“Javaåº”ç”¨çš„æ€§èƒ½ã€‚å¦‚æœä½¿ç”¨å †å¤–å†…å­˜çš„è¯ï¼Œå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†( è€Œä¸æ˜¯è™šæ‹Ÿæœº )ã€‚è¿™æ ·åšçš„ç»“æœå°±æ˜¯èƒ½ä¿æŒä¸€ä¸ªè¾ƒå°çš„å †å†…å†…å­˜ï¼Œä»¥å‡å°‘åƒåœ¾æ”¶é›†å¯¹åº”ç”¨çš„å½±å“ã€‚ åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥æå‡ç¨‹åºI/Oæ“çºµçš„æ€§èƒ½ã€‚å°‘å»äº†å°†æ•°æ®ä»å †å†…å†…å­˜æ‹·è´åˆ°å †å¤–å†…å­˜çš„æ­¥éª¤ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹Java çº¿ç¨‹çŠ¶æ€å˜è¿å›¾ çº¿ç¨‹åˆå§‹çŠ¶æ€ï¼šNEW çº¿ç¨‹è¿è¡ŒçŠ¶æ€ï¼šRUNNABLE çº¿ç¨‹é˜»å¡çŠ¶æ€ï¼šBLOCKED çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼šWAITING è¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼šTIMED_WAITING çº¿ç¨‹ç»ˆæ­¢çŠ¶æ€ï¼šTERMINATED volatile å…³é”®å­—æ¯æ¬¡éƒ½è¦å¼ºåˆ¶ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ï¼Œå¦‚åŒç›´æ¥åœ¨ä¸»å†…å­˜ä¸­è¯»å†™è®¿é—® 123456789101112131415161718192021public class Singleton { private volatile static Singleton uniqueInstance; private Singleton() { } public static Singleton getUniqueInstance() { //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç  if (uniqueInstance == null) { //ç±»å¯¹è±¡åŠ é” synchronized (Singleton.class) { if (uniqueInstance == null) { uniqueInstance = new Singleton(); } } } return uniqueInstance; }} uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ uniqueInstance = new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´ åˆå§‹åŒ– uniqueInstance å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-&gt;3-&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getUniqueInstance() åå‘ç° uniqueInstance ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› uniqueInstanceï¼Œä½†æ­¤æ—¶ uniqueInstance è¿˜æœªè¢«åˆå§‹åŒ–ã€‚ å…·ä½“å®ç°Â·lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ Â·unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ Â·readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ Â·loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚ Â·useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ Â·assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ Â·storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨ã€‚ Â·writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ åé¢æœ€æ–°çš„JSR-133æ–‡æ¡£ä¸­ï¼Œå·²ç»æ”¾å¼ƒäº†é‡‡ç”¨è¿™8ç§æ“ä½œå»å®šä¹‰Javaå†…å­˜æ¨¡å‹çš„è®¿é—®åè®®ï¼Œç¼©å‡ä¸º4ç§readã€writeã€lockå’Œunlock å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜æ‹·è´åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦æŒ‰é¡ºåºæ‰§è¡Œreadå’Œloadæ“ä½œï¼Œå¦‚æœè¦æŠŠå˜é‡ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ï¼Œå°±è¦æŒ‰é¡ºåºæ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚æ³¨æ„ï¼ŒJavaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°ä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä½†ä¸è¦æ±‚æ˜¯è¿ç»­æ‰§è¡Œï¼Œä¸­é—´å¯ä»¥æ’å…¥å…¶ä»–æ“ä½œã€‚ volatile ä½œç”¨æ˜¯åœ¨ useä¹‹å‰å¿…é¡»æ˜¯loadã€loadä¹‹å‰å¿…é¡»use ä¿è¯äº†æ¯æ¬¡ä½¿ç”¨éƒ½æ˜¯æœ€æ–°å€¼ï¼Œassignå’Œstoreä¹Ÿä¸€æ ·ï¼Œä¿è¯äº†æ¯æ¬¡èµ‹å€¼éƒ½ä¼šå†™å›åˆ°ä¸»å†…å­˜ ReentrantLockReentrantLock å®ç°äº† Lock æ¥å£ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼çš„é”ï¼Œå’Œ synchronized å…³é”®å­—ç±»ä¼¼ã€‚ä¸è¿‡ï¼ŒReentrantLock æ›´çµæ´»ã€æ›´å¼ºå¤§ï¼Œå¢åŠ äº†è½®è¯¢ã€è¶…æ—¶ã€ä¸­æ–­ã€å…¬å¹³é”å’Œéå…¬å¹³é”ç­‰é«˜çº§åŠŸèƒ½ã€‚","link":"/2023/04/18/javaConcurrent/"},{"title":"è®¡ç®—æœºç½‘ç»œ","text":"https://xiaolincoding.com/network/3_tcp/tcp_interview.html TCPä¸‰æ¬¡æ¡æ‰‹ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–ï¼ˆä¸»è¦åŸå› ï¼‰ä¸»è¦æ˜¯å› ä¸ºåœ¨ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰ä¸­é—´çŠ¶æ€ç»™å®¢æˆ·ç«¯æ¥é˜»æ­¢å†å²è¿æ¥ï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯èƒ½å»ºç«‹ä¸€ä¸ªå†å²è¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åŒæ­¥åŒæ–¹çš„åˆå§‹åºåˆ—å·ï¼Œä¸¤æ¬¡æ¡æ‰‹æ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°è‡ªå·±çš„åˆå§‹åºåˆ—å· ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é¿å…èµ„æºæµªè´¹ï¼Œä¸¤æ¬¡æ¡æ‰‹æœåŠ¡ç«¯æ¯æ¬¡æ¥å—åˆ°synæŠ¥æ–‡å°±ä¼šå»ºç«‹ä¸€ä¸ªè¿æ¥ å››æ¬¡æŒ¥æ‰‹ TCPä¸UDP TCP UDP æ˜¯å¦é¢å‘è¿æ¥ æ˜¯ å¦ æ˜¯å¦å¯é  æ˜¯ å¦ æ˜¯å¦æœ‰çŠ¶æ€ æ˜¯ å¦ ä¼ è¾“æ•ˆç‡ è¾ƒæ…¢ è¾ƒå¿« ä¼ è¾“å½¢å¼ å­—èŠ‚æµ æ•°æ®æŠ¥æ–‡æ®µ é¦–éƒ¨å¼€é”€ 20 ï½ 60 bytes 8 bytes æ˜¯å¦æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ å¦ æ˜¯ QUICè¿æ¥1-RTTæ¨¡å¼ 0-RTTæ¨¡å¼ å¯¹æ¯” ä¿æŒè¿æ¥id å¤šè·¯å¤ç”¨ æ‹¥å¡æ§åˆ¶","link":"/2023/05/27/network/"}],"tags":[{"name":"Algorithm","slug":"Algorithm","link":"/tags/Algorithm/"},{"name":"HashMap","slug":"HashMap","link":"/tags/HashMap/"},{"name":"Blog","slug":"Blog","link":"/tags/Blog/"},{"name":"Greedy","slug":"Greedy","link":"/tags/Greedy/"},{"name":"MergeSort","slug":"MergeSort","link":"/tags/MergeSort/"},{"name":"DynamicProgramming","slug":"DynamicProgramming","link":"/tags/DynamicProgramming/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"javaï¼Œconcurrent","slug":"javaï¼Œconcurrent","link":"/tags/java%EF%BC%8Cconcurrent/"},{"name":"network","slug":"network","link":"/tags/network/"}],"categories":[{"name":"Algorithm","slug":"Algorithm","link":"/categories/Algorithm/"},{"name":"Blog","slug":"Blog","link":"/categories/Blog/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"concurrent","slug":"concurrent","link":"/categories/concurrent/"},{"name":"network","slug":"network","link":"/categories/network/"}],"pages":[]}