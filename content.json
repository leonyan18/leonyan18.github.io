{"posts":[{"title":"ç‰›å®¢æ¨¡æ‹Ÿç¼“å­˜","text":"BM100 è®¾è®¡LRUç¼“å­˜ç»“æ„é¢˜æ„é“¾æ¥ï¼šè®¾è®¡LRUç¼“å­˜ç»“æ„_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯linkedHashMapå¯ä»¥ç»´æŠ¤å…ƒç´ æ’å…¥é¡ºåºæˆ–è€…å…ƒç´ è®¿é—®é¡ºåºï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ å³ä¸ºæœ€è¿œæ²¡æœ‰è®¿é—®è¿‡çš„ï¼Œ setå’Œgetåœ¨é€šå¸¸æƒ…å†µæ˜¯O(1),æœ€åæƒ…å†µæ˜¯O(logn) ä½¿ç”¨LinkedHashMapè®¾ç½®ä¸ºè®¿é—®æ¬¡åº setçš„æ—¶å€™è¦æ³¨æ„å®¹é‡ï¼Œç§»é™¤æœ€ä¹…æœªä½¿ç”¨çš„key 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.yan.simulation;import com.yan.base.Solution;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.io.InputStream;import java.io.OutputStream;import java.util.LinkedHashMap;//@Servicepublic class LRUCacheSolution implements Solution { private LinkedHashMap&lt;Integer,Integer&gt; map; private int capacity; @Override public void solve(InputStream in, OutputStream outputStream) { System.out.println(&quot;test&quot;); LRUCacheSolution lruCacheSolution=new LRUCacheSolution(2); lruCacheSolution.set(1,1); lruCacheSolution.set(2,2); System.out.println(lruCacheSolution.get(1)); lruCacheSolution.set(3,3); System.out.println(lruCacheSolution.get(2)); lruCacheSolution.set(4,4); System.out.println(lruCacheSolution.get(1)); System.out.println(lruCacheSolution.get(3)); System.out.println(lruCacheSolution.get(4)); } public LRUCacheSolution() { } public LRUCacheSolution(int capacity) { this.capacity=capacity; // è®¾ç½®ä¸ºè®¿é—®é¡ºåº map= new LinkedHashMap&lt;&gt;(capacity,0.75f,true); // write code here } public int get(int key) { if (!map.containsKey(key)){ return -1; } int val=map.get(key); return val; } public void set(int key, int value) { // åªæœ‰å¤§å°ç­‰äºå®¹é‡å¹¶ä¸”æ’å…¥çš„æ—¶å€™keyä¸å­˜åœ¨çš„æ—¶å€™æ‰è¿›è¡Œåˆ é™¤ä¹‹å‰çš„ if(map.size()==capacity&amp;&amp;!map.containsKey(key)){ // åˆ é™¤æœ€è¿œæ²¡ç”¨è¿‡çš„ int temp= map.entrySet().iterator().next().getKey(); map.remove(temp); } map.put(key,value); }} BM101 è®¾è®¡LFUç¼“å­˜ç»“æ„é¢˜æ„ æ€è·¯ä¸ªäººæ€è·¯ï¼ˆéæœ€ä½³ï¼‰ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè®°å½•æŸ¥æ‰¾å’ŒæŸ¥è¯¢æ¬¡æ•°ä»¥åŠç›¸å¯¹ä½ç½®ï¼ŒæŒ‰ç…§æ¬¡æ•°æœ€å°‘æ’åºï¼Œä½¿ç”¨æ‡’åˆ é™¤çš„æ€æƒ³åœ¨å®¹é‡æ»¡çš„æ—¶å€™æ‰å¯¹å‰é¢çš„å…ƒç´ å»é™¤è„æ•°æ® ä½¿ç”¨æ•°æ®ç»“æ„ 12345678910 private HashMap&lt;Integer, Integer&gt; map;// key -value private HashMap&lt;Integer, Integer&gt; countMap;// key -æ¬¡æ•° private HashMap&lt;Integer, Integer&gt; opMap;// key -æ“ä½œæ•° private int capacity; // å®¹é‡ private int op;// æ“ä½œæ•°class Node { int key; int cnt; int pos; } æ’å…¥æ—¶ï¼š å®¹é‡ä¸ºæ»¡çš„çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥è¯¢é˜Ÿé¦–å…ƒç´ æ˜¯å¦ä¸ºæ­£ç¡®èŠ‚ç‚¹æ­¥éª¤å¦‚ä¸‹ åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£ç¡®çš„æ“ä½œæ•° åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦å·²åˆ é™¤ ä¸æ­£ç¡®çš„è¯å°±å¼¹å‡ºèŠ‚ç‚¹ï¼Œå¹¶é‡å¤æ“ä½œï¼Œç›´è‡³æ­£ç¡®ã€‚countMapå’Œmapä¸­å›åˆ é™¤è¿™ä¸ªkeyï¼› æ’å…¥å’Œè·å–èŠ‚ç‚¹ï¼ŒcountMapï¼Œmapå’Œqueueæ›´æ–°æ•°æ®ï¼ŒåŒæ—¶opæ“ä½œæ•°++ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140package com.yan.simulation;import com.yan.base.Solution;import org.springframework.stereotype.Service;import java.io.InputStream;import java.io.OutputStream;import java.util.*;@Servicepublic class LFUCacheSolution implements Solution { private HashMap&lt;Integer, Integer&gt; map; private HashMap&lt;Integer, Integer&gt; countMap; private HashMap&lt;Integer, Integer&gt; opMap; private int capacity; private int op; private PriorityQueue&lt;Node&gt; queue; @Override public void solve(InputStream in, OutputStream outputStream) { LFUCacheSolution lfuCacheSolution = new LFUCacheSolution(3); lfuCacheSolution.set(2054879058, -121373736); lfuCacheSolution.set(2054879053, -121373736); lfuCacheSolution.set(2054879025, -121373736); lfuCacheSolution.set(2, 4); lfuCacheSolution.set(3, 5); System.out.println(lfuCacheSolution.get(2)); lfuCacheSolution.set(4, 4); System.out.println(lfuCacheSolution.get(1)); } public int[] LFU(int[][] operators, int k) { ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; operators.length; i++) { if (operators[i][0] == 1) { set(operators[i][1], operators[i][2]); } else { int temp = get(operators[i][1]); arrayList.add(temp); } } int[] d = new int[arrayList.size()]; for (int i = 0; i &lt; arrayList.size(); i++) { d[i] = arrayList.get(i); } return d; } public LFUCacheSolution() { } public LFUCacheSolution(int capacity) { this.capacity = capacity; map = new HashMap&lt;&gt;(capacity); countMap = new HashMap&lt;&gt;(capacity); opMap = new HashMap&lt;&gt;(capacity); queue = new PriorityQueue&lt;&gt;(capacity * 4, new Comparator&lt;Node&gt;() { @Override public int compare(Node o1, Node o2) { if (o1.cnt != o2.cnt) { return o1.cnt - o2.cnt; } else { return o1.pos - o2.pos; } } }); } public int get(int key) { if (!map.containsKey(key)) { return -1; } int val = map.get(key); int cnt = countMap.get(key); countMap.put(key, cnt + 1); opMap.put(key, op); queue.add(new Node(key, cnt + 1, op)); op++; return val; } public void set(int key, int value) { // åªæœ‰å¤§å°ç­‰äºå®¹é‡å¹¶ä¸”æ’å…¥çš„æ—¶å€™keyä¸å­˜åœ¨çš„æ—¶å€™æ‰è¿›è¡Œåˆ é™¤ä¹‹å‰çš„ if (map.size() == capacity &amp;&amp; !map.containsKey(key)) { // åˆ é™¤æœ€è¿œæ²¡ç”¨è¿‡çš„ Node temp = queue.peek(); while (!map.containsKey(temp.key) || (temp.pos != opMap.get(temp.key))) { queue.poll(); temp = queue.peek(); } temp=queue.poll(); map.remove(temp.key); countMap.remove(temp.key); } map.put(key, value); countMap.put(key, 1); opMap.put(key, op); queue.add(new Node(key, 1, op)); op++; } class Node { int key; int cnt; int pos; public Node() { } public Node(int key, int cnt, int pos) { this.key = key; this.cnt = cnt; this.pos = pos; } @Override public boolean equals(Object o) { if (this == o) return true; if (!(o instanceof Node)) return false; Node node = (Node) o; if (key != node.key) return false; if (cnt != node.cnt) return false; return pos == node.pos; } @Override public int hashCode() { int result = key; result = 31 * result + cnt; result = 31 * result + pos; return result; } }} é¢˜è§£æ€è·¯é¢˜è§£ | #è®¾è®¡LFUç¼“å­˜ç»“æ„#_ç‰›å®¢åšå®¢ (nowcoder.net) éœ€è¦åœ¨O(1)æ—¶é—´å†…å®ç°ä¸¤ä¸ªæ“ä½œï¼Œæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„è¿˜æ˜¯å“ˆå¸Œè¡¨ï¼Œåˆ©ç”¨å“ˆå¸Œè¡¨ä¿å­˜LFUçš„keyå€¼ï¼Œè€Œå“ˆå¸Œè¡¨çš„valueå€¼å¯¹åº”äº†å¦ä¸€è¾¹å­˜ç€æ¯ä¸ªç¼“å­˜éœ€è¦çš„ç±»çš„èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å®ç°äº†ç›´æ¥è®¿é—®ã€‚ ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æ¯æ¬¡æœ€å¿«æ‰¾åˆ°æœ€ä¹…æœªä½¿ç”¨çš„é¢‘ç‡æœ€å°çš„èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè·Ÿè¸ªè®°å½•æœ€å°çš„é¢‘ç‡ï¼Œæœ‰äº†æœ€å°çš„é¢‘ç‡ï¼ˆå½“ä½ ä½¿ç”¨setæ–¹æ³•çš„æ—¶å€™æ¯æ¬¡è¿›æ¥çš„éƒ½æ˜¯æœ€å°é¢‘ç‡çš„ï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°çš„æ—¶å€™é€šå¸¸æ›´æ–°ä¸º1ï¼Œæˆ–è€…é¢‘ç‡ä¸ºæœ€å°é¢‘ç‡çš„æ²¡æœ‰äº†è¿›è¡Œ++æ“ä½œï¼‰ï¼Œæ€æ ·ç›´æ¥æ‰¾åˆ°è¿™ä¸ªé¢‘ç‡æœ€å°çš„èŠ‚ç‚¹ï¼Œè¿˜æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œkeyå€¼è®°å½•å„ä¸ªé¢‘ç‡ï¼Œè€Œvalueå€¼å°±æ˜¯åé¢æ¥äº†ä¸€ä¸²ç›¸åŒé¢‘ç‡çš„èŠ‚ç‚¹ã€‚å¦‚ä½•ä¿è¯æ¯æ¬¡éƒ½æ˜¯æœ€å°é¢‘ç‡çš„æœ€ä¹…ä¸ºä½¿ç”¨ï¼Œæˆ‘ä»¬ç”¨åŒå‘é“¾è¡¨å°†ç»Ÿä¸€é¢‘ç‡çš„èŠ‚ç‚¹è¿èµ·æ¥å°±å¥½äº†ï¼Œæ¯æ¬¡æ–°åŠ å…¥è¿™ä¸ªé¢‘ç‡çš„éƒ½åœ¨é“¾è¡¨å¤´ï¼Œè€Œéœ€è¦å»æ‰çš„éƒ½åœ¨é“¾è¡¨å°¾ã€‚ ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2022/12/26/NowcoderEmulateCache/"},{"title":"Hexoåšå®¢æ­å»ºä»¥åŠæ–‡ä»¶åŒæ­¥","text":"æ€»ä½“ç»“æ„ Hexo+ Icarusä¸»é¢˜ä½œä¸ºåšå®¢åŸºç¡€ï¼Œåœ¨æ­¤åŸºç¡€å¯¹æ­¤ä¸»é¢˜è¿›è¡Œå¸ƒå±€ä¿®æ”¹ ä¿®æ”¹å’Œå‘å¸ƒæ–‡ç« ï¼Œä¸€å¼€å§‹æ˜¯é‡‡ç”¨äº†hexo-adminçš„æ–¹å¼è¿›è¡Œä¿®æ”¹çš„ï¼Œåé¢æ„Ÿè§‰è¿˜æ˜¯éº»çƒ¦å’Œæœ¬åœ°typoraå·®è·ç”šå¤§ï¼Œäºæ˜¯ä½¿ç”¨äº†Alistå’ŒRaiDriveè¿›è¡Œæœ¬åœ°æŒ‚è½½è¿œç¨‹ç›®å½•çš„æ–¹å¼ï¼Œå¹¶ç»“åˆå›¾åºŠã€‚ åšå®¢æ­å»ºhexoæ–‡æ¡£ | Hexo å®‰è£… Hexo éœ€è¦å…ˆå®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºå³å¯ï¼š Node.js (Node.js ç‰ˆæœ¬éœ€ä¸ä½äº 10.13ï¼Œå»ºè®®ä½¿ç”¨ Node.js 12.0 åŠä»¥ä¸Šç‰ˆæœ¬) Git 1234#å…¨å±€å®‰è£…npm install -g hexo-cli#å±€éƒ¨å®‰è£…npm install hexo hexoä¸»é¢˜Icarusgithubåœ°å€ppoffice/hexo-theme-icarus: A simple, delicate, and modern theme for the static site generator Hexo. (github.com) æ–‡æ¡£åœ°å€Icaruså¿«é€Ÿä¸Šæ‰‹ - Icarus (ppoffice.github.io) ä¸è¿‡ä¸ªäººæ¨èå¯ä»¥å®‰è£…ä¹‹å‰çš„åº“å¦‚4.4ç‰ˆæœ¬çš„ï¼Œ5.0ä»¥ä¸Šç‰ˆæœ¬å¸ƒå±€éƒ½ä¸åœ¨themes/Icarus/layout/ä¸‹äº†,éƒ½åœ¨node_modulesé‡Œäº†ï¼Œåé¢ä¿®æ”¹åŸæ¥çš„å¸ƒå±€å°±ååˆ†éº»çƒ¦ 12npm install hexo-theme-icarushexo config theme icarus é…ç½®æ–‡ä»¶å¯ä»¥å‚è€ƒè‡ªåŠ¨ç”Ÿæˆçš„_config.icarus.yml.exampleï¼Œä»¥åŠå¯¹åº”çš„æ–‡æ¡£Tag: Icarusç”¨æˆ·æŒ‡å— - Icarus (ppoffice.github.io) å¸ƒå±€é—®é¢˜å‚è€ƒé“¾æ¥Hexoä¸»é¢˜Icarusçš„è‡ªå®šä¹‰ - Astroblog (astrobear.top) ç”±äºåŸæ¥çœ‹æ–‡ç« çš„æ—¶å€™å¤šæ å¸ƒå±€å¯¼è‡´æ–‡ç« å†…å®¹è¿‡äºçª„äº†æ‰€ä»¥ç¬¬ä¸€æ­¥éœ€è¦å…ˆæ”¹æˆåŒæ  è¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ–‡ç« çš„å•ç‹¬å¸ƒå±€_config.post.ymlä»£ç å¦‚ä¸‹ï¼Œå³æ‰€æœ‰widgetéƒ½åœ¨å·¦æˆ–è€…å³è¾¹ 12345678910111213141516171819202122sidebar: left: sticky: true right: sticky: falsewidgets: - position: left type: profile author: é¢œæ™¨æ›¦ author_title: ç ”ç©¶ç”Ÿ location: æµ™æ±Ÿ å°å· avatar: /img/avatar.png avatar_rounded: false gravatar: follow_link: https://github.com/leonyan18 - position: left type: toc index: true collapsed: true depth: 6 è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ–‡ç« å†…å®¹å®½åº¦è¿˜æ˜¯åçª„ï¼Œä¹‹å‰ç‰ˆæœ¬çš„ä¿®æ”¹æ–¹æ³•ç°åœ¨éƒ½è¦é‡Œé¢çš„æ–‡ä»¶å¯¹åº”åˆ°node_modules/hexo-theme-Icarusä¸­æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œç„¶åé‡æ–°è®¾ç½®ä¸»é¢˜ï¼Œå¹¶é‡å¯ã€‚ ä¹‹å‰æ–¹æ³•å‚è€ƒé“¾æ¥Hexoä¸»é¢˜Icarusçš„è‡ªå®šä¹‰ - Astroblog (astrobear.top)ï¼Œå°† Icarus5çš„ä¼˜é›…æ›¿ä»£æ–¹æ³•ä¸»è¦è¿˜æ˜¯å¼ºè¿«ç—‡ï¼Œæ€•ä»¥åå¤‡ä»½çš„æ—¶å€™å¿˜è®°node_modulesé‡Œçš„ä¸œè¥¿ï¼Œè¦é‡æ–°ä¿®æ”¹å¸ƒå±€ä¸€é å°†node_modules/hexo-theme-Icarusä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ€å¤–å±‚ä¸»é¢˜themes/icarus/ä¸­ï¼ˆæ²¡æœ‰å°±åˆ›å»ºï¼‰ï¼Œé‚£ä¹ˆå…¶å®ä½ å°±ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå’ŒIcarusä¸€æ¨¡ä¸€æ ·çš„ä¸»é¢˜ï¼Œå’Œä¹‹å‰Icarus4çš„åšæ³•ä¸€æ ·ï¼Œç›´æ¥åœ¨è¿™é‡Œé¢æ”¹åŠ¨å°±è¡Œã€‚ æ–‡ä»¶åŒæ­¥å‚è€ƒä¸€ä¸‹ä¹‹å‰çš„æ–‡ç« Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜=æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½ - blog (dawnchannel.tech) ä½¿ç”¨Alistæ·»åŠ æœ¬åœ°å­˜å‚¨(åšå®¢ç›®å½•/source/_posts/) RaiDriveå°±ä¼šæ˜ å°„åˆ°æœ¬åœ°ç›˜ä¸­ åšå®¢ç¼–å†™å®‰è£…typoraTypora â€” a markdown editor, markdown reader. ä½¿ç”¨picGoä½œä¸ºå›¾åºŠï¼Œæ·»åŠ ä½ æœ‰çš„å›¾åºŠï¼Œæˆ‘æ˜¯ç”¨çš„minioå›¾åºŠï¼Œéœ€è¦åœ¨é‡Œé¢ä¸‹è½½ä¸€ä¸ªæ’ä»¶å³å¯ ç„¶ååœ¨Typoraä¸­è¿›è¡Œé…ç½®ï¼Œé…ç½®å®Œæˆä¹‹åä½ çš„å¤åˆ¶çš„å›¾ç‰‡ç‚¹å‡»ä¸Šä¼ å°±èƒ½ä¸Šä¼ åˆ°å›¾åºŠä¹‹ä¸Š","link":"/2022/12/27/blog/"},{"title":"Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜&#x3D;æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½","text":"æ€»ä½“ç»“æ„ è¿œç¨‹å­˜å‚¨ç©ºé—´ä¸ºæœåŠ¡å™¨ä¸ŠæŒ‡å®šç›®å½•å’Œé˜¿é‡Œäº‘ç›˜æŒ‡å®šç›®å½• Alistä½œä¸ºæ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œå¹¶å‘RaiDrive æä¾› webDAVæ¥å£ Raiä½œä¸ºæœ¬åœ°æŒ‚è½½è¿œç¨‹å·¥å…·çš„è½¯ä»¶ï¼Œä½¿åŸæœ¬éœ€è¦è¯»å–è¿œç¨‹æ–‡ä»¶çš„æ“ä½œåƒæœ¬åœ°æ“ä½œä¸€æ ·ç®€å• Alistå®‰è£…ä»¥åŠä½¿ç”¨å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ä¸€é”®è„šæœ¬ | AListæ–‡æ¡£ (nn.ci) æœ¬äººä½¿ç”¨å®˜æ–¹æ¨èçš„è¿™ä¸ªè„šæœ¬å®‰è£… 123456#å®‰è£…curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s install#æ›´æ–°curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s update#å¸è½½curl -fsSL &quot;https://alist.nn.ci/v3.sh&quot; | bash -s uninstall ä¸€é”®è„šæœ¬å®‰è£…ä¹‹åï¼Œé»˜è®¤å®‰è£…åœ¨/opt/alist åç»­è·å¾—ç®¡ç†å‘˜å¯†ç è¦ä»æ‰‹åŠ¨å®‰è£…çš„è¿è¡Œé‡Œé¢æ‰¾ï¼Œè¿™ä¸ªä¸€å¼€å§‹æˆ‘ä¹Ÿæ²¡æ‰¾åˆ° 123456# è¿›å…¥æ–‡ä»¶å¤¹cd /opt/alist# è¿è¡Œç¨‹åº./alist server# è·å¾—ç®¡ç†å‘˜ä¿¡æ¯./alist admin ç®¡ç†å‘˜ç™»å½• ç„¶åå°±æ˜¯åœ¨webé¡µé¢ä¸Šæ“ä½œäº†ï¼Œé»˜è®¤æ˜¯5244ç«¯å£ï¼ŒæœåŠ¡å™¨çš„è¯éœ€è¦å®‰å…¨ç»„å¼€ç«¯å£ ä¹‹åçœ‹æ–‡æ¡£è§£å†³ä¸€ä¸‹é€šç”¨é¡¹ | AListæ–‡æ¡£ (nn.ci) æ·»åŠ æœåŠ¡å™¨æœ¬åœ°å­˜å‚¨æœ¬åœ°å­˜å‚¨ | AListæ–‡æ¡£ (nn.ci)ï¼Œå¯ä»¥æ—¥åä½œä¸ºæœåŠ¡å™¨å’Œæœ¬åœ°å®æ—¶åŒæ­¥æ–‡ä»¶ï¼Œå¸¦å®½ä¸é«˜å°±è¦ç”¨æ¥çœ‹è§†é¢‘äº† æ·»åŠ é˜¿é‡Œäº‘ç›˜é˜¿é‡Œäº‘ç›˜ | AListæ–‡æ¡£ (nn.ci)ï¼Œå¯ä»¥å®ƒç”¨ä»–çœ‹è§†é¢‘å¬æ­Œï¼Œåˆ‡è®°åˆ‡è®°WebDAV ç­–ç•¥ä½¿ç”¨302é‡å®šå‘ï¼Œè¿™æ ·ç”¨çš„å°±ä¸æ˜¯ä½ æœåŠ¡å™¨çš„å¸¦å®½äº†ï¼Œè€Œæ˜¯é˜¿é‡Œäº‘ç›˜çš„ è¿™äº›æ–‡æ¡£éƒ½è®²çš„æ¯”è¾ƒæ¸…æ™°äº†ï¼Œå°±ä¸å†èµ˜è¿° Raiè½¯ä»¶å®‰è£…ä¸‹è½½é“¾æ¥ï¼šä¸‹è½½ (raidrive.com.cn) ç›´æ¥ç‚¹å‡»å®‰è£…å°±è¡Œï¼ŒæœŸé—´ä¼šæœ‰å®‰è£…å…¶ä»–è½¯ä»¶å’Œä¸€äº›è®¾å¤‡è½¯ä»¶ï¼Œå®‰è£…å°±è¡Œ ç„¶åç‚¹å‡»æ·»åŠ ï¼Œé€‰æ‹©NS webDAV ç„¶åå°±è¡Œäº†","link":"/2022/12/28/local_sync/"},{"title":"ä½¿ç”¨Github Actions åŠ¨æ€æ›´æ–°Githubä¸»é¡µ","text":"æ€»ä½“æ€è·¯å€Ÿé‰´æ€è·¯åœ°å€ä½¿ç”¨Github Actions åŠ¨æ€æ›´æ–°Githubä¸»é¡µ - æ–¹åœ†å°ç«™ (fangyuanxiaozhan.com) åŸæ–‡è®²çš„ä¸œè¥¿ä¸å¤Ÿå…¨ï¼Œæˆ‘è¿™ä¼šè¡¥å……ä¸€ç‚¹ é¡¹ç›®å‚è€ƒåœ°å€leonyan18/leonyan18 (github.com) pythonè„šæœ¬çˆ¬å–åšå®¢æ›´æ–°å†…å®¹ï¼Œå¹¶å†™å…¥æ›´æ–°åˆ°æŒ‡å®šä½ç½® github action æ¯å¤©å®šæ—¶å¯åŠ¨è¿™ä¸ªä»»åŠ¡ pythonè„šæœ¬ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©ä½ è¦æ’å…¥çš„ä½ç½®ï¼Œå¹¶ä¿®æ”¹è„šæœ¬12345678910111213è¿™æ˜¯æˆ‘çš„ReadME.md## Recent Blog Posts(update time:2022-12-29 10:15:20)[Alist+RaiDrive+é˜¿é‡Œäº‘ç›˜&amp;#x3D;æœ¬åœ°ç½‘ç›˜+æ–‡ä»¶å®æ—¶åŒæ­¥+å¤‡ä»½](http://dawnchannel.tech/2022/12/28/local_sync/)[Hexoåšå®¢æ­å»ºä»¥åŠæ–‡ä»¶åŒæ­¥](http://dawnchannel.tech/2022/12/27/blog/)[ç‰›å®¢æ¨¡æ‹Ÿç¼“å­˜](http://dawnchannel.tech/2022/12/26/NowcoderEmulateCache/)&lt;br/&gt;## ğŸ’»:keyboard: Languages and Tools æˆ‘æ˜¯åœ¨## Recent Blog Postså’Œ## ğŸ’»:keyboard: Languages and Tools ä¹‹é—´è¿›è¡Œæ’å…¥çš„ï¼Œæ ¹æ®å®é™…æƒ…å†µæ›¿æ¢å€¼ï¼Œæˆ‘è¿™è¾¹æ˜¯å¤šäº†å‡ ä¸ªå›è½¦ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨æœ¬åœ°è°ƒè¯•é€šè¿‡ä¹‹ååœ¨è¿›è¡Œä¸Šä¼ ã€‚ åœ¨main.pyå¯¹åº”ä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ä¸¤ä¸ªinsert_info = çš„ä½ç½® ç¬¬äºŒæ­¥ æ ¹æ®å®é™…è¿”å›ä¿®æ”¹get_link_infoå‡½æ•°ç”±äºæœ¬äººæ˜¯é€šè¿‡hexo+icarusä¸»é¢˜å®ç°çš„ï¼Œåšå®¢å†…å®¹å¯ä»¥é€šè¿‡http://dawnchannel.tech/content.jsonç›´æ¥è·å¾—ï¼Œå¯ä»¥å°†å…¶æ›¿æ¢æˆè‡ªå·±çš„åœ°å€ã€‚ å…¶ä»–åœ°å€éœ€è¦ä¸ªäººè‡ªå®šä¹‰äº†ï¼Œè¿˜è¦æ³¨æ„ä¸€ç‚¹æˆ‘è¿™ä¸ªæ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºä¸‹æ¥çš„ï¼Œæ‰€ä»¥æˆ‘è¿˜è¿›è¡Œäº†ä¸€ä¸ªé€†åºæ“ä½œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041import timeimport osimport reimport pytzimport requestsimport jsonfrom datetime import datetimedef get_link_info(feed_url, num): result = &quot;&quot; response = requests.get(feed_url).text response=json.loads(response) feed_entries = response[&quot;posts&quot;] feed_entries.reverse() feed_entries_length = len(feed_entries) all_number = 0 if(num &gt; feed_entries_length): all_number = feed_entries_length else: all_number = num for entrie in feed_entries[0: all_number]: title = entrie[&quot;title&quot;] link = &quot;http://dawnchannel.tech&quot;+entrie[&quot;link&quot;] result = result + &quot;\\n&quot; + &quot;[&quot; + title + &quot;](&quot; + link + &quot;)&quot; + &quot;\\n&quot; return resultdef main(): insert_info = get_link_info(&quot;http://dawnchannel.tech/content.json&quot;, 6) # æ›¿æ¢ ---start--- åˆ° ---end--- ä¹‹é—´çš„å†…å®¹ # pytz.timezone('Asia/Shanghai')).strftime('%Yå¹´%mæœˆ%dæ—¥%Hæ—¶Måˆ†') fmt = '%Y-%m-%d %H:%M:%S %Z%z' insert_info = &quot;## Recent Blog Posts(&quot; + &quot;update time:&quot;+ datetime.fromtimestamp(int(time.time()),pytz.timezone('Asia/Shanghai')).strftime('%Y-%m-%d %H:%M:%S') +&quot;)\\n&quot; + insert_info + &quot;\\n\\n&lt;br/&gt;\\n\\n## ğŸ’»:keyboard: Languages and Tools &quot; # è·å–README.mdå†…å®¹ print(insert_info) with open (os.path.join(os.getcwd(), &quot;README.md&quot;), 'r', encoding='utf-8') as f: readme_md_content = f.read() new_readme_md_content = re.sub(r'## Recent Blog Posts(.|\\n)*## ğŸ’»:keyboard: Languages and Tools ', insert_info, readme_md_content) with open (os.path.join(os.getcwd(), &quot;README.md&quot;), 'w', encoding='utf-8') as f: f.write(new_readme_md_content)main() ç¬¬ä¸‰æ­¥ æœ¬åœ°è°ƒè¯•ä¸»è¦æµ‹è¯•ä¸€ä¸‹ï¼Œæœ¬åœ°çš„ReadMEæ–‡ä»¶æ˜¯å¦æ­£å¸¸ï¼Œåœ¨æ²¡æœ‰æœ€è¿‘åšå®¢çš„æ—¶å€™å’Œæœ‰æœ€è¿‘åšå®¢çš„æ—¶å€™éƒ½æµ‹è¯•ä¸€ä¸‹ã€‚ github actionså‰æœŸå‡†å¤‡å…ˆè§£é‡Šä¸‹actionçš„æµç¨‹ åˆ›å»ºæ‰€éœ€è¦çš„ç¯å¢ƒ å®‰è£…å¯¹åº”ä¾èµ– gitæ“ä½œ ç„¶åçœ‹ä¸‹æˆ‘ä»¬çš„ç›®å½•ç»“æ„ä»¥åŠæ‰€éœ€è¦çš„ä¸œè¥¿ï¼Œç¼ºä¸€æ ·éƒ½ä¸å¯ä»¥ ReadMe.md ï¼Œä¸»è¦éœ€è¦ä¿®æ”¹çš„å¯¹è±¡ main.pyï¼Œpythonè„šæœ¬ç”¨äºä¿®æ”¹å†…å®¹ Pipfileï¼Œåˆ›å»ºç¯å¢ƒå®‰è£…å¯¹åº”ä¾èµ– .gitignoreï¼Œå¿½ç•¥ç”Ÿæˆçš„å…¶ä»–æ— å…³æ–‡ä»¶ .gitignoreå’ŒPipfileæ–‡ä»¶ç›´æ¥ä½¿ç”¨å‚è€ƒä»“åº“é‡Œï¼Œå¦‚æœç”¨åˆ°å…¶ä»–åº“æˆ–è€…æ–°å¢å…¶ä»–æ–‡ä»¶äº†ï¼Œè¯·è‡ªè¡Œæ·»åŠ ã€‚ å¯åŠ¨actionsç‚¹å‡»ä»“åº“ä¸‹é¢çš„actionsæŒ‰é’®ï¼Œåˆ›å»ºå¯¹åº”main.yml 1234567891011121314151617181920212223242526272829303132name: 'leonyan18'on: push: schedule: - cron: '0 1 * * *'jobs: stale: runs-on: ubuntu-latest strategy: matrix: # in this example, there is a newer version already installed, 3.7.7, so the older version will be downloaded python-version: ['3.7.4'] steps: - uses: actions/checkout@v2 # Checking out the repo - name: Install dependecies uses: VaultVulp/action-pipenv@v2.0.1 with: command: install -d # Install all dependencies, including development ones - name: Build uses: VaultVulp/action-pipenv@v2.0.1 with: command: run build - name: Commit and push if changed # æ›´æ–°README.md run: | git diff git config --global user.email &quot;1183503933@qq.com&quot; git config --global user.name &quot;leonyan&quot; git add README.md git commit -m &quot;Github Action Auto Updated&quot; git push æäº¤ä¹‹åï¼Œå»Enableè¿™ä¸ªjobå°±å¯ä»¥æ¯å¤©æ›´æ–°äº†ã€‚ æ³¨æ„å½“ä½ é‡æ–°å¯åŠ¨å¤±è´¥çš„jobçš„æ—¶å€™ï¼Œä¸€å®šè¦æ‰‹åŠ¨è§¦å‘ï¼Œé‡æ–°è¿è¡Œä¹‹å‰çš„å·²ç»ä¸è¡Œäº†ï¼Œå› ä¸ºreadmeå·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œå¯ä»¥é€šè¿‡é‡æ–°gitæäº¤ä¼šè‡ªåŠ¨è§¦å‘ æˆ–è€…æ”¹ä¸ºæ‰‹åŠ¨è§¦å‘ 123on: # æ‰‹åŠ¨è§¦å‘äº‹ä»¶ workflow_dispatch:","link":"/2022/12/29/GetRecentBlog/"},{"title":"BM95 åˆ†ç³–æœé—®é¢˜","text":"é¢˜æ„é“¾æ¥ï¼šåˆ†ç³–æœé—®é¢˜_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯é¢˜æ„å¯å¾— æå°å€¼ç‚¹åªç»™ä¸€é¢—ç³–ã€‚ å¦‚æœå·¦è¾¹éƒ½æ¯”å³è¾¹å°é‚£ä¹ˆæ˜¯ä¸ªå•è°ƒé€’å¢åºåˆ—ï¼Œä¸”å·®å€¼ä¸º1ã€‚å¦‚æœå·¦è¾¹éƒ½æ¯”å³è¾¹å¤§å°±å¯åŒç†å¾—ã€‚ å¦‚æœç›¸ç­‰çš„è¯ï¼Œåªè€ƒè™‘ä¸ç›¸ç­‰ä¸€è¾¹çš„æƒ…å†µï¼Œå¦‚æœéƒ½ç›¸ç­‰åˆ™ä¸º1ã€‚ å°†æ•°ç»„æ‹†åˆ†ä¸€æ®µåˆä¸€æ®µçš„å•è°ƒåºåˆ—è¯ï¼Œå°±å‰©ä¸‹ä¸€ä¸ªæå¤§å€¼ç‚¹éœ€è¦è®¨è®º å¦‚æœæ¯”å·¦å³ä¸¤è¾¹éƒ½å¤§ï¼Œè¦åŒæ—¶æ»¡è¶³å·¦å³ä¸¤è¾¹çš„è¿™ç‚¹çš„ç³–æœæ•°å°±å–å†³äºå·¦å³ä¸¤è¾¹è°éœ€æ±‚çš„ç³–æœæ•°å¤§äº†ã€‚ ä¸€å¼€å§‹æˆ‘çš„æ€è·¯ï¼Œæ‰¾å•è°ƒé€’å¢å’Œé€’å‡çš„é•¿åº¦ï¼Œç®—ä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œæ‰“ç®—æ‰«ä¸€éç®—å‡ºæ¥ï¼Œä½†æ˜¯åæ¥æƒ³æƒ³å¥½åƒæƒ…å†µæœ‰ç‚¹å¤æ‚ï¼Œæ€»å…±æœ‰å››ç§æƒ…å†µï¼Œæ¯”ä¸¤è¾¹éƒ½å¤§çš„ç‚¹ï¼Œå³æå¤§å€¼ç‚¹è¿˜è¦å»éå†å³è¾¹æ‰èƒ½çŸ¥é“ä»–çš„å€¼ï¼Œè¿™æ ·çš„è¯å°±æ˜¯O(n^2),æ˜¾ç„¶ä¸è¡Œ ä¼˜åŒ–æ–¹æ³•å°±æ˜¯ä»å·¦å¾€å³å’Œä»å·¦å¾€å³éƒ½æ‰«ä¸€éï¼Œæ¯æ¬¡åªç®—ä¸€è¾¹çš„æƒ…å†µï¼Œç„¶åå–æå¤§å€¼ã€‚ å…·ä½“æ­¥éª¤ ä»å·¦è¾¹å¼€å§‹æ‰«ï¼Œå¦‚æœå·¦è¾¹æ¯”ä»–å¤§ï¼Œé‚£ä¹ˆç³–æœæ•°=å·¦è¾¹ç³–æœæ•°+1ï¼Œåä¹‹ä¸º1ã€‚ç³–æœæ•°ç»„è®°ä¸ºcandyL ä»å³è¾¹å¼€å§‹æ‰«ï¼Œå¦‚æœå³è¾¹æ¯”ä»–å¤§ï¼Œé‚£ä¹ˆç³–æœæ•°=å³è¾¹ç³–æœæ•°+1ï¼Œåä¹‹ä¸º1ã€‚ç³–æœæ•°ç»„è®°ä¸ºcandyR ä»å·¦è¾¹å¼€å§‹ç´¯åŠ max(candyL[i],candyR[i]),æœ€åè¾“å‡º ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930public int candy(int[] arr) { // write code here int ans = 0; int[] candyl=new int[arr.length+5]; int[] candyr=new int[arr.length+5]; int pre=arr[0]; candyl[0]=1; candyr[arr.length-1]=1; for (int i = 1; i &lt; arr.length; i++) { if(arr[i]&gt;pre){ candyl[i]=candyl[i-1]+1; }else { candyl[i]=1; } pre=arr[i]; } pre=arr[arr.length-1]; for (int i = arr.length-2; i &gt;= 0; i--) { if(arr[i]&gt;pre){ candyr[i]=candyr[i+1]+1; }else { candyr[i]=1; } pre=arr[i]; } for (int i=0;i&lt;arr.length;i++){ ans+=Math.max(candyl[i],candyr[i]); } return ans; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2022/12/30/BM95/"},{"title":"æ•°ç»„ä¸­çš„é€†åºå¯¹","text":"æ•°ç»„ä¸­çš„é€†åºå¯¹_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) é¢˜æ„ æ€è·¯å°è¯•ï¼šæ¯æ¬¡çœ‹åˆ°è¿™ä¸ªé¢˜ï¼Œæˆ‘éƒ½è€æ˜¯æƒ³è®°å½•åŸæ¥ä½ç½®ç„¶åå†æ’ä¸ªåºçœ‹çœ‹å’ŒåŸæ¥çš„å·®å€¼ï¼Œå³æ˜¯ç­”æ¡ˆã€‚åé¢æƒ³æƒ³å¿«é€Ÿæ’åºè¯•è¯•ï¼Œç§»åˆ°å‰é¢çš„+ä¸Šå·®å€¼ï¼Œç§»åˆ°åé¢çš„å‡å»å·®å€¼ï¼Œä¸­é—´è¿‡ç¨‹ä¸ä¸€å®šå°±æ˜¯å·®å€¼ã€‚ â€‹ ä½¿ç”¨å½’å¹¶æ’åºï¼Œæ’åºè¿‡ç¨‹ä¸­ï¼Œé€†åºå¯¹ä¼šéšç€å…ƒç´ æ…¢æ…¢ç§»åˆ°æ­£ç¡®çš„ä½ç½®è€Œå‡å°‘ï¼Œè€Œä¸”æ¯æ¬¡å‡å°‘çš„é€†åºå¯¹æ˜¯å¯ä»¥ç»Ÿè®¡çš„ã€‚å°†ä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œåˆå¹¶çš„æ—¶å€™ï¼Œå½“å³æ•°ç»„çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦æ•°ç»„çš„åŸæ¥ä½ç½®çš„æ—¶å€™ï¼Œå‡å°‘çš„é€†åºå¯¹æ•°ä¸ºç§»åŠ¨è·ç¦»ï¼Œè®°å½•è¯¥å€¼å³å¯ã€‚ â€‹ è‡³äºå–ä½™çš„é—®é¢˜æ¯æ¬¡éƒ½è¿›è¡Œcnt=(cnt+mod)%modå°±å¯ä»¥äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public long cnt = 0; public long mod = 1000000007; public void Merge(int[] array, int[] temp, int l, int r) { if(l&gt;=r) return; int mid=(l+r)/2; int pos=l,lpos=l,rpos=mid+1; while (lpos&lt;=mid&amp;&amp;rpos&lt;=r) { if (array[lpos]&lt;=array[rpos]){ temp[pos]=array[lpos]; lpos++; }else { temp[pos]=array[rpos]; cnt+=rpos-pos; cnt=(cnt+mod)%mod; rpos++; } pos++; } while(lpos&lt;=mid){ temp[pos]=array[lpos]; lpos++; pos++; } while(rpos&lt;=r){ temp[pos]=array[rpos]; rpos++; pos++; } for (int i = l; i &lt;= r; i++) { array[i]=temp[i]; } } public void MergeSort(int[] array, int[] temp, int l, int r) { int cnt; if (l &gt;= r) return; int mid = (l + r) / 2; MergeSort(array, temp, l, mid); MergeSort(array, temp, mid + 1, r); Merge(array,temp, l, r); } public int InversePairs(int[] array) { cnt = 0; int[] temp = new int[array.length]; MergeSort(array, temp, 0, array.length - 1); return (int) cnt; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2023/01/01/BM20/"},{"title":"BM75 ç¼–è¾‘è·ç¦»(ä¸€)","text":"é¢˜æ„ç¼–è¾‘è·ç¦»(ä¸€)_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘ (nowcoder.com) æ€è·¯ä¸»è¦éš¾ç‚¹æ˜¯å¦‚ä½•å»ºç«‹dpæ•°ç»„ï¼Œæˆ‘å½“æ—¶æƒ³çš„æ˜¯ï¼ˆiï¼Œjï¼‰è¡¨ç¤ºçš„æ˜¯iå’Œjçš„åŒºé—´å·²ç»å®Œæˆæ“ä½œï¼Œä½†æ˜¯é€’æ¨æ–¹ç¨‹éœ€è¦å·¦è¾¹å’Œå³è¾¹éƒ½æœ‰ï¼Œæ‰€ä»¥ä¸è¡Œåç»­çš„jè¡¨ç¤ºé•¿åº¦çš„è¯ä¹Ÿä¸è¡Œã€‚å¿˜å¾—å¤ªå¿«äº†ã€‚ã€‚ã€‚ã€‚ é¢˜è§£ | #ç¼–è¾‘è·ç¦»(ä¸€)#_ç‰›å®¢åšå®¢ (nowcoder.net) æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å˜æˆç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªå°†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²æœ€å°‘æ“ä½œä¸‹å˜æˆç¬¬äºŒä¸ªå­—ç¬¦ä¸²ï¼Œè¿™å°±æ¶‰åŠäº†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å¢åŠ é•¿åº¦ï¼ŒçŠ¶æ€è½¬ç§»ï¼Œé‚£å¯ä»¥è€ƒè™‘åŠ¨æ€è§„åˆ’ã€‚ç”¨dp[i][j]è¡¨ç¤ºä»ä¸¤ä¸ªå­—ç¬¦ä¸²é¦–éƒ¨å„è‡ªåˆ°str1[i]å’Œstr2[j]ä¸ºæ­¢çš„å­ä¸²éœ€è¦çš„ç¼–è¾‘è·ç¦»ï¼Œé‚£å¾ˆæ˜æ˜¾dp[str1.length][str2.length]å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ç¼–è¾‘è·ç¦»ã€‚ï¼ˆä¸‹æ ‡ä»1å¼€å§‹ï¼‰ å…·ä½“åšæ³•ï¼š step 1ï¼šåˆå§‹æ¡ä»¶ï¼š å‡è®¾ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé‚£å¾ˆæ˜æ˜¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å­ä¸²æ¯å¢åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œç¼–è¾‘è·ç¦»å°±åŠ 1ï¼Œè¿™æ­¥æ“ä½œæ˜¯åˆ é™¤ï¼›åŒç†ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé‚£ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ¯å¢åŠ ä¸€ä¸ªå­—ç¬¦ï¼Œç¼–è¾‘è·ç¦»å°±åŠ 1ï¼Œè¿™æ­¥æ“ä½œæ˜¯æ·»åŠ ã€‚ step 2ï¼šçŠ¶æ€è½¬ç§»ï¼š çŠ¶æ€è½¬ç§»è‚¯å®šæ˜¯å°†dpçŸ©é˜µå¡«æ»¡ï¼Œé‚£å°±éå†ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªé•¿åº¦ï¼Œå¯¹åº”ç¬¬äºŒä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸ªé•¿åº¦ã€‚å¦‚æœéå†åˆ°str1[i]å’Œ str2[j]çš„ä½ç½®ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦ç›¸åŒï¼Œè¿™å¤šå‡ºæ¥çš„å­—ç¬¦å°±ä¸ç”¨æ“ä½œï¼Œæ“ä½œæ¬¡æ•°ä¸ä¸¤ä¸ªå­ä¸²çš„å‰ä¸€ä¸ªç›¸åŒï¼Œå› æ­¤æœ‰dp[i][j]=dp[i-1][j-1]ï¼›å¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—ç¬¦éœ€è¦ç¼–è¾‘ï¼Œä½†æ˜¯æ­¤æ—¶çš„æœ€çŸ­çš„è·ç¦»ä¸ä¸€å®šæ˜¯ä¿®æ”¹è¿™æœ€åä¸€ä½ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åˆ é™¤æŸä¸ªå­—ç¬¦æˆ–è€…å¢åŠ æŸä¸ªå­—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬é€‰å–è¿™ä¸‰ç§æƒ…å†µçš„æœ€å°å€¼å¢åŠ ä¸€ä¸ªç¼–è¾‘è·ç¦»ï¼Œå³dp[i][j]=min(dp[i-1][j-1],dp[i][j-1],dp[i][j])+1ã€‚ 123456789101112131415161718192021222324public int editDistance(String str1, String str2) { // write code here int len1 = str1.length(); int len2 = str2.length(); int[][] dp = new int[len1 + 5][len2 + 5]; for (int i = 0; i &lt;= len1; i++) { dp[i][0] = i; } for (int i = 0; i &lt;= len2; i++) { dp[0][i] = i; } for (int i = 1; i &lt;= len1; i++) { for (int j = 1; j &lt;= len2; j++) { if (str1.charAt(i - 1) == str2.charAt(j - 1)) { dp[i][j] = dp[i - 1][j - 1]; } else { dp[i][j] = dp[i - 1][j - 1] + 1; dp[i][j] = Math.min(dp[i - 1][j] + 1, dp[i][j]); dp[i][j] = Math.min(dp[i][j - 1] + 1, dp[i][j]); } } } return dp[len1][len2]; } ç®—æ³•å…¨éƒ¨ä»£ç å‚è€ƒleonyan18/AlgorithmCodeInJava (github.com)","link":"/2023/01/06/BM75/"},{"title":"Javaé—®é¢˜æ”¶é›†","text":"ç†è§£åŸç ã€åç ã€è¡¥ç ã€ç§»ç  ç¬¦å·ä½ï¼š0ä½æ­£æ•°ï¼Œ1ä¸ºè´Ÿæ•° åŸç ä¸èƒ½è¿›è¡Œè¿ç®— æ­£æ•°çš„åŸç å’Œåç ä¸€æ ·ï¼Œè´Ÿæ•°çš„åç æ˜¯åœ¨åŸç çš„åŸºç¡€ä¸Šï¼Œç¬¦å·ä½ä¸å˜ï¼Œå…¶ä½™å–å æ­£æ•°çš„è¡¥ç å’Œåç ä¸€æ ·ï¼Œè´Ÿæ•°çš„è¡¥ç æ˜¯åœ¨åç çš„åŸºç¡€ä¸Šè¿›è¡Œï¼‹1æ“ä½œ ç§»ç æ˜¯åœ¨è¡¥ç çš„åŸºç¡€ä¸Šï¼ŒæŠŠç¬¦å·ä½å–å 1 -1 1+ï¼ˆ-1ï¼‰ ç»“æœ åŸç  0000 0001 1000 0001 1000 0010 -2 åç  0000 0001 1111 1110 1111 1111 -0 è¡¥ç  0000 0001 1111 1111 0000 0000 +0 ç§»ç  1000 0001 0111 1111 1000 0000 0 å–å€¼èŒƒå›´ æ•´æ•° n=8 åŸç  -(2^(n-1)-1)~2^(n-1)-1 -127~127 åç  -(2^(n-1)-1)~2^(n-1)-1 -127~127 è¡¥ç  -2^(n-1)~2^(n-1)-1 -128~127 StringJava 9 ä¸ºä½•è¦å°† String çš„åº•å±‚å®ç°ç”± char[] æ”¹æˆäº† byte[] ?JEP 254ï¼š ç´§å‡‘å­—ç¬¦ä¸² (openjdk.org) æˆ‘ä»¬å»ºè®®æ›´æ”¹ç±»çš„å†…éƒ¨è¡¨ç¤º ä» UTF-16 æ•°ç»„åˆ°æ•°ç»„åŠ ä¸Šç¼–ç æ ‡å¿—å­—æ®µã€‚ æ–°ç±»å°†å­˜å‚¨ç¼–ç ä¸º ISO-8859-1/Latin-1ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œæˆ– UTF-16ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚ï¼‰ å­—ç¬¦ï¼‰ å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?å¯ä»¥ä»å­—èŠ‚ç é‡Œçœ‹å‡º å­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ StringBuilder è°ƒç”¨ append() æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ toString() å¾—åˆ°ä¸€ä¸ª String å¯¹è±¡ ã€‚ ä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼šç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª StringBuilder ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„ StringBuilder å¯¹è±¡ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/java-basic-questions-02.html Javaä»£ç†åå°„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ ï¼š å¯ä»¥è®©å’±ä»¬çš„ä»£ç æ›´åŠ çµæ´»ã€ä¸ºå„ç§æ¡†æ¶æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½æä¾›äº†ä¾¿åˆ© ç¼ºç‚¹ ï¼šè®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶æœ‰äº†åˆ†ææ“ä½œç±»çš„èƒ½åŠ›ï¼Œè¿™åŒæ ·ä¹Ÿå¢åŠ äº†å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚å¯ä»¥æ— è§†æ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥ï¼ˆæ³›å‹å‚æ•°çš„å®‰å…¨æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼‰ã€‚å¦å¤–ï¼Œåå°„çš„æ€§èƒ½ä¹Ÿè¦ç¨å·®ç‚¹ï¼Œä¸è¿‡ï¼Œå¯¹äºæ¡†æ¶æ¥è¯´å®é™…æ˜¯å½±å“ä¸å¤§çš„ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/reflection.html åå°„ä¸ºä»€ä¹ˆæ…¢Reflection is slow for a few obvious reasons: JITæ— æ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå› ä¸ºä»–ä¸çŸ¥é“ä½ è¦å¹²ä»€ä¹ˆ æ‰€æœ‰çš„åˆ›å»ºå’Œinvokeæ“ä½œéœ€è¦å»æœç´¢ Arguments need to be dressed up via boxing/unboxing, packing into arrays, Exceptions wrapped in InvocationTargetExceptions and re-thrown etc. å‚æ•°éœ€è¦é€šè¿‡å¼€ç®±/è£…ç®±æ‰“åŒ…åˆ°æ•°ç»„å½“ä¸­ï¼Œå¼‚å¸¸éœ€è¦é€šè¿‡InvocationTargetExceptionåŒ…è£…å¼‚å¸¸ è¿˜éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œï¼ˆå¦‚åˆ¤æ–­å˜é‡å’Œå‡½æ•°è®¿é—®æ€§ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ— å‚æ„é€ å‡½æ•°ç­‰ï¼‰ performance - Java Reflection: Why is it so slow? - Stack Overflow é™æ€ä»£ç†JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å¯¹æ¯” JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚ å¦å¤–ï¼Œ CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä»£ç†å£°æ˜ä¸º final ç±»å‹çš„ç±»å’Œæ–¹æ³•ã€‚ å°±äºŒè€…çš„æ•ˆç‡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ JDK åŠ¨æ€ä»£ç†æ›´ä¼˜ç§€ï¼Œéšç€ JDK ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™ä¸ªä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/proxy.html é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯” çµæ´»æ€§ ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼ JVM å±‚é¢ ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/proxy.html BigDecimalæµ®ç‚¹æ•°ä¹‹é—´çš„ç­‰å€¼åˆ¤æ–­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸èƒ½ç”¨ == æ¥æ¯”è¾ƒï¼ŒåŒ…è£…æ•°æ®ç±»å‹ä¸èƒ½ç”¨ equals æ¥åˆ¤æ–­ï¼Œç»™å®šè¯¯å·®èŒƒå›´ æˆ‘ä»¬åœ¨ä½¿ç”¨ BigDecimal æ—¶ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦ä¸¢å¤±ï¼Œæ¨èä½¿ç”¨å®ƒçš„BigDecimal(String val)æ„é€ æ–¹æ³•æˆ–è€… BigDecimal.valueOf(double val) é™æ€æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ å¤§å°æ¯”è¾ƒä½¿ç”¨ a.compareTo(b)ï¼Œ equals() æ–¹æ³•ä¸ä»…ä»…ä¼šæ¯”è¾ƒå€¼çš„å¤§å°ï¼ˆvalueï¼‰è¿˜ä¼šæ¯”è¾ƒç²¾åº¦ï¼ˆscaleï¼‰ï¼Œè€Œ compareTo() æ–¹æ³•æ¯”è¾ƒçš„æ—¶å€™ä¼šå¿½ç•¥ç²¾åº¦ã€‚ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/bigdecimal.html equalså’Œhashcodeequals==true è¯´æ˜ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚ hashcodeç›¸ç­‰ï¼Œè¯´æ˜ä¸¤ä¸ªå¯¹è±¡å“ˆå¸Œç ç›¸ç­‰ï¼Œå¹¶ä¸ä»£è¡¨å¯¹è±¡ç›¸ç­‰ï¼Œhashcodeç”¨äºç¡®å®šåœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ã€‚ å¦‚æœhashcodeç›¸ç­‰equalsä¸ç›¸ç­‰ï¼Œè¯´æ˜ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ã€‚ å¦‚æœequalsç›¸ç­‰ï¼Œhashcodeä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆåœ¨hashMapä¸­å¦‚æœä¸¤ä¸ªå¯¹è±¡è¢«åˆ†åœ¨ä¸¤ä¸ªä¸åŒçš„å“ˆå¸Œæ¡¶ä¸­ï¼Œé‚£ä¹ˆhashMapå°±æ— æ³•è¿›è¡Œæ–°å€¼è¦†ç›–ï¼ŒHashsetå°±æ— æ³•è¿›è¡Œå»é‡ã€‚ æ‰€ä»¥é‡å†™çš„hashcode()åœ¨equalsç›¸ç­‰çš„æ—¶å€™å¿…é¡»ç›¸ç­‰ã€‚","link":"/2023/02/20/JavaProblem/"},{"title":"Javaé›†åˆ","text":"å‚è€ƒhttps://javaguide.cn/ ArrayListæ„é€ å‡½æ•° æ ¡éªŒåˆå§‹å®¹é‡ å¦‚æœæ˜¯æ— å‚æ„é€ ï¼Œé‚£ä¹ˆè¿˜æ˜¯èµ‹å€¼ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œä½†æ˜¯æ’å…¥çš„æ—¶å€™ä¼šè¾¨åˆ«;åä¹‹åˆ™æ„é€ ä¸€ä¸ªç©ºçš„æ•°ç»„DEFAULTCAPACITY_EMPTY_ELEMENTDATAï¼Œä½†æ˜¯ä¸‹æ¬¡æ‰©å®¹ä¼šå–æœ€å°æ‰©å®¹é‡ä¸é»˜è®¤åˆå§‹åŒ–é•¿åº¦ï¼ˆä¸€èˆ¬ä¸º10ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚ æ‰©å®¹è¿‡ç¨‹addå‡½æ•°æ ¡éªŒå¤§å°è·å–æœ€å°‘éœ€è¦é•¿åº¦é€šå¸¸æ˜¯æ’å…¥æ•°é‡+å½“å‰é•¿åº¦ï¼Œ growå‡½æ•°å¦‚æœä¸å¤Ÿå°±è¿›è¡Œæ‰©å®¹ï¼Œå¹¶ç¡®å®šæ‰©å®¹å¤§å°ï¼Œæ¯æ¬¡æ‰©å®¹å˜æˆåŸæ¥çš„1.5å€ï¼Œ0.5å€ç”±æ— ç¬¦å·å³ç§»ä¸€ä½å¾—åˆ°ï¼Œæ–°é•¿åº¦æœ‰æœ€å°‘éœ€è¦é•¿åº¦ä¸åŸæ¥é•¿åº¦çš„1.5å€çš„æœ€å¤§å€¼å¾—åˆ°ï¼Œä½†æ˜¯ä¸è¶…è¿‡SOFT_MAX_ARRAY_LENGTHï¼Œè¯¥å€¼ä¸ºIntçš„æœ€å¤§å€¼-8ï¼Œæ˜¯ç”±äºéƒ¨åˆ†javaè™šæ‹Ÿæœºéœ€è¦å­˜æ”¾object headerä¼šå¯¼è‡´å †æ ˆæº¢å‡ºï¼ŒJavaä¸­çš„å¯¹è±¡å¤´ä¿¡æ¯ï¼ˆæ•°ç»„é•¿åº¦ï¼‰éœ€è¦å ç”¨8ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œæ‰€ä»¥é€‰æ‹©äº†ä¸ªç•¥å°äºæœ€å¤§å€¼çš„å€¼ã€‚ Arrays.copyOf(elementData, newCapacity);å°†å…ƒç´ èµ‹å€¼åˆ°æ–°åœ°æ–¹ HashMapTableSizeFor()é€šè¿‡-1æ— ç¬¦å·å³ç§»ç»™å®šå®¹é‡çš„å‰å¯¼é›¶é•¿åº¦+1å¾—åˆ°æœ€æ¥è¿‘çš„2å¹‚æ¬¡-1ï¼ŒåŒæ—¶ä¸æœ€å¤§å®¹é‡è¿›è¡Œæ¯”è¾ƒ 12int n = -1 &gt;&gt;&gt; Integer.numberOfLeadingZeros(cap - 1);return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; æ„é€ å‡½æ•°ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚ å‚æ•°å¸¦å®¹é‡æˆ–è€…è´Ÿè½½å› å­é‚£å°±éœ€è¦TableSizeFor()å‡½æ•°ç¡®å®štableå¤§å° å“ˆå¸Œæ–¹æ³•12345//JDK1.7h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);//JDK1.8return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); å®šä½æ–¹æ³•(n - 1) &amp; hash nä¸ºå“ˆå¸Œè¡¨é•¿åº¦ put æ–¹æ³•é¦–å…ˆåˆ¤æ–­æ•°ç»„æ˜¯å¦ç»è¿‡åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦è¿›è¡Œåˆå§‹åŒ– å®šä½æ•°ç»„ä½ç½®ï¼Œå¦‚æœæ— èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥æ’å…¥,å¹¶æ£€éªŒå®¹é‡æ˜¯å¦è¾¾åˆ°ä¸Šé™ å¦‚æœå­˜åœ¨ç›¸åŒçš„keyï¼Œåˆ™ç›´æ¥è¦†ç›–å¹¶è¿”å›ï¼Œå› ä¸ºæ²¡æœ‰èŠ‚ç‚¹å¢åŠ  å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥ å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯æ™®é€šé“¾è¡¨èŠ‚ç‚¹ï¼Œæ’å…¥èŠ‚ç‚¹å…ˆåˆ¤æ–­æ’å…¥åï¼ˆé“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰å¹¶ä¸” HashMap æ•°ç»„é•¿åº¦è¶…è¿‡ 64 çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘çš„æ“ä½œï¼Œå¦åˆ™å°±åªæ˜¯å¯¹æ•°ç»„æ‰©å®¹ï¼‰ resize()æ–¹æ³•å®¹é‡å‚æ•°è®¾ç½®é¦–å…ˆåˆ¤æ–­åŸæ¥çš„tableæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰æŒ‡å®šloadFactorå’Œthresholdåˆ™ä½¿ç”¨é»˜è®¤çš„ï¼Œ å¦‚æœä¸ä¸ºç©ºï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„ä¸¤å€ã€‚ åŒæ—¶æ›´æ–°thresholdå‚æ•°ï¼Œå¹¶å¼€è¾Ÿæ–°çš„nodeæ•°ç»„ç©ºé—´ è¿›è¡Œè¿ç§»å¦‚æœtableä¸ºç©ºï¼Œç›´æ¥è·³è¿‡ã€‚ éå†nodeæ•°ç»„{ â€‹ å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™newTab[e.hash &amp; (newCap - 1)] = e; â€‹ å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œä¼šéå†çº¢é»‘æ ‘ï¼Œæ ¹æ®e.hash &amp; oldCapçš„å€¼åŒºåˆ†ä¸åŒçš„ä½ç½®(åœ¨åŸæ¥ä½ç½®jï¼Œè¿˜æ˜¯j+oldcap)ï¼Œä¸”å½“æ‹†åˆ†å¼€çš„çº¢é»‘æ ‘çš„èŠ‚ç‚¹æ•°å°äº6çš„æ—¶å€™ä¼šå˜æˆé“¾è¡¨æ’å…¥åˆ°nodeæ•°ç»„ä¸­ â€‹ é“¾è¡¨åŒç†ï¼Œéå†é“¾è¡¨æ ¹æ®e.hash &amp; oldCapçš„å€¼åŒºåˆ†ä¸åŒçš„ä½ç½®(åœ¨åŸæ¥ä½ç½®jï¼Œè¿˜æ˜¯j+oldcap) } ConcurrentHashMapç¿»äº†ConcurrentHashMap1.7 å’Œ1.8çš„æºç ï¼Œæˆ‘æ€»ç»“äº†å®ƒä»¬çš„ä¸»è¦åŒºåˆ«ã€‚ - æ˜é‡‘ (juejin.cn) çº¿ç¨‹å®‰å…¨å®ç° ä½¿ç”¨volatileä¿è¯å½“Nodeä¸­çš„å€¼å˜åŒ–æ—¶å¯¹äºå…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ ä½¿ç”¨tableæ•°ç»„çš„å¤´ç»“ç‚¹ä½œä¸ºsynchronizedçš„é”æ¥ä¿è¯å†™æ“ä½œçš„å®‰å…¨ å½“å¤´ç»“ç‚¹ä¸ºnullæ—¶ï¼Œä½¿ç”¨CASæ“ä½œæ¥ä¿è¯æ•°æ®èƒ½æ­£ç¡®çš„å†™å…¥ã€‚ 1.7 segment+hashentry +é“¾è¡¨çš„å½¢å¼ ConcurrnetHashMap ç”±å¾ˆå¤šä¸ª Segment ç»„åˆï¼Œè€Œæ¯ä¸€ä¸ª Segment æ˜¯ä¸€ä¸ªç±»ä¼¼äº HashMap çš„ç»“æ„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª HashMap çš„å†…éƒ¨å¯ä»¥è¿›è¡Œæ‰©å®¹ã€‚ä½†æ˜¯ Segment çš„ä¸ªæ•°ä¸€æ—¦åˆå§‹åŒ–å°±ä¸èƒ½æ”¹å˜ï¼Œé»˜è®¤ Segment çš„ä¸ªæ•°æ˜¯ 16 ä¸ªï¼Œä½ ä¹Ÿå¯ä»¥è®¤ä¸º ConcurrentHashMap é»˜è®¤æ”¯æŒæœ€å¤š 16 ä¸ªçº¿ç¨‹å¹¶å‘ é»˜è®¤åˆå§‹åŒ–å®¹é‡16;é»˜è®¤è´Ÿè½½å› å­ 0.75f;é»˜è®¤å¹¶å‘çº§åˆ«16; 1.8(38æ¡æ¶ˆæ¯) ConcurrentHashMapåº•å±‚è¯¦è§£(å›¾è§£æ‰©å®¹)ï¼ˆJDK1.8ï¼‰_concurrenthashmapæ‰©å®¹_ç¼–ç¨‹èŠå£«çš„åšå®¢-CSDNåšå®¢ 1234static final int MOVED = -1; // hash for forwarding nodesstatic final int TREEBIN = -2; // hash for roots of treesstatic final int RESERVED = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hash å˜é‡sizeCtl -1 è¯´æ˜æ­£åœ¨åˆå§‹åŒ–ï¼Œå¦‚æœå‘ç°æ­£åœ¨åˆå§‹åŒ–Thread.yield(); -N è¯´æ˜æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹ 0 è¡¨ç¤º table åˆå§‹åŒ–å¤§å°ï¼Œå¦‚æœ table æ²¡æœ‰åˆå§‹åŒ– &gt;0 è¡¨ç¤º table æ‰©å®¹çš„é˜ˆå€¼ï¼Œå¦‚æœ table å·²ç»åˆå§‹åŒ–ã€‚ åˆå§‹åŒ–è¡¨1234567891011121314151617181920212223242526private final Node&lt;K,V&gt;[] initTable() { Node&lt;K,V&gt;[] tab; int sc; // ç±»ä¼¼CASæ–¹æ³• å¾ªç¯åˆå§‹åŒ–è¡¨ while ((tab = table) == null || tab.length == 0) { if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin // CAS else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) { try { // æ£€æŸ¥è¡¨æ˜¯å¦åˆå§‹åŒ– if ((tab = table) == null || tab.length == 0) { int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; // 0.75 sc = n - (n &gt;&gt;&gt; 2); } } finally { sizeCtl = sc; } break; } } return tab;} put()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768final V putVal(K key, V value, boolean onlyIfAbsent) { if (key == null || value == null) throw new NullPointerException(); int hash = spread(key.hashCode()); int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) { Node&lt;K,V&gt; f; int n, i, fh; K fk; V fv; if (tab == null || (n = tab.length) == 0) tab = initTable(); else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value))) break; // no lock when adding to empty bin } else if ((fh = f.hash) == MOVED) tab = helpTransfer(tab, f); else if (onlyIfAbsent // check first node without acquiring lock &amp;&amp; fh == hash &amp;&amp; ((fk = f.key) == key || (fk != null &amp;&amp; key.equals(fk))) &amp;&amp; (fv = f.val) != null) return fv; else { V oldVal = null; synchronized (f) { if (tabAt(tab, i) == f) { if (fh &gt;= 0) { binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) { K ek; if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) { oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; } Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) { pred.next = new Node&lt;K,V&gt;(hash, key, value); break; } } } else if (f instanceof TreeBin) { Node&lt;K,V&gt; p; binCount = 2; if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) { oldVal = p.val; if (!onlyIfAbsent) p.val = value; } } else if (f instanceof ReservationNode) throw new IllegalStateException(&quot;Recursive update&quot;); } } if (binCount != 0) { if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; } } } addCount(1L, binCount); return null;} æ ¹æ® key è®¡ç®—å‡º hashcodeï¼Œkeyå’Œvalueå‡ä¸èƒ½ä¸ºnull ã€‚ åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ– å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚ å¦‚æœå½“å‰ä½ç½®çš„ hashcode == MOVED == -1,åˆ™å¸®åŠ©æ‰©å®¹ã€‚ å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”ä½è¿™ä¸ªæ¡¶,æ‰¾åˆ°å¯¹åº”keyæ›¿æ¢å€¼ï¼Œæˆ–è€…æ’å…¥åˆ°æœ«å°¾ å¦‚æœæ•°é‡å¤§äº TREEIFY_THRESHOLD åˆ™è¦æ‰§è¡Œæ ‘åŒ–æ–¹æ³•ï¼Œåœ¨ treeifyBin ä¸­ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰æ•°ç»„é•¿åº¦â‰¥64æ—¶æ‰ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä¸é“¾è¡¨ä¸åŒçš„æ˜¯è¿™ä¸ªæ—¶å€™å“ˆå¸Œæ¡¶é‡Œé¢å­˜æ”¾çš„æ˜¯TreeBinç±»ï¼Œè¯¥ç±»ä¸­æœ‰å„ç§çº¢é»‘æ ‘çš„æ–¹æ³• get()12345678910111213141516171819public V get(Object key) { Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) { if ((eh = e.hash) == h) { if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; } else if (eh &lt; 0) return (p = e.find(h, key)) != null ? p.val : null; while ((e = e.next) != null) { if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; } } return null;} æ ¹æ® hash å€¼è®¡ç®—ä½ç½®ã€‚ æŸ¥æ‰¾åˆ°æŒ‡å®šä½ç½®ï¼Œå¦‚æœå¤´èŠ‚ç‚¹å°±æ˜¯è¦æ‰¾çš„ï¼Œç›´æ¥è¿”å›å®ƒçš„ value. å¦‚æœå¤´èŠ‚ç‚¹ hash å€¼å°äº 0 ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹æˆ–è€…æ˜¯çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾ä¹‹ã€‚ 123static final int MOVED = -1; // hash for forwarding nodesstatic final int TREEBIN = -2; // hash for roots of treesstatic final int RESERVED = -3; // hash for transient reservations å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†æŸ¥æ‰¾ä¹‹ã€‚ addCount()1234567891011121314151617181920212223242526272829303132333435private final void addCount(long x, int check) { CounterCell[] cs; long b, s; if ((cs = counterCells) != null || !U.compareAndSetLong(this, BASECOUNT, b = baseCount, s = b + x)) { CounterCell c; long v; int m; boolean uncontended = true; if (cs == null || (m = cs.length - 1) &lt; 0 || (c = cs[ThreadLocalRandom.getProbe() &amp; m]) == null || !(uncontended = U.compareAndSetLong(c, CELLVALUE, v = c.value, v + x))) { fullAddCount(x, uncontended); return; } if (check &lt;= 1) return; s = sumCount(); } if (check &gt;= 0) { Node&lt;K,V&gt;[] tab, nt; int n, sc; while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) { int rs = resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT; if (sc &lt; 0) { if (sc == rs + MAX_RESIZERS || sc == rs + 1 || (nt = nextTable) == null || transferIndex &lt;= 0) break; if (U.compareAndSetInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); } else if (U.compareAndSetInt(this, SIZECTL, sc, rs + 2)) transfer(tab, null); s = sumCount(); } }} ä½¿ç”¨äº†countercellæ•°ç»„çš„æ–¹æ³•æ¥è®¡æ•°ï¼Œå•ä¸ªæˆå‘˜å˜é‡è¿›è¡Œä¿®æ”¹çš„æ—¶å€™å†²çªè¾ƒå¤§ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†ç‰‡çš„æ–¹æ³•è¿›è¡Œè®¡æ•°ï¼Œæ–¹æ³•ç±»ä¼¼äºLongAdderè®¡æ•° å¦‚æœcountercellsæ•°ç»„ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥casè®¾ç½®baseCountå˜é‡ï¼Œå¤±è´¥äº†æ‰è¿›å…¥ifé‡Œé¢ï¼Œåˆå§‹åŒ–counterCellsï¼Œä½¿ç”¨fullCountåˆå§‹åŒ–å’Œé‡æ–°è®¡æ•°counterCellsï¼Œä½¿ç”¨sumCountæ–¹æ³•éå†counterCells è·å–æœ€åå®¹é‡ å¦‚æœcheckå¤§äº0ï¼Œå¦‚æœæ£€æŸ¥æ·»åŠ çš„å…ƒç´ é‡æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚å¦‚æœå½“å‰éœ€è¦æ‰©å®¹ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰©å®¹æœ‰å°±æ›´æ–°sizeCTL+1ï¼ˆçº¿ç¨‹æ•°+1ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å°±æ›´æ–°sizeCTl rs+2ï¼ˆå¦‚æœæ²¡æœ‰å› ä¸º-1ä¸ºåˆå§‹åŒ–ï¼‰é‡æ–°è®¡æ•°ï¼Œå¹¶ä¸”ä¹Ÿè¦å°äºæœ€å¤§æ‰©å®¹çº¿ç¨‹æ•° Transfer()123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) { int n = tab.length, stride; if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range if (nextTab == null) { // initiating try { @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; } catch (Throwable ex) { // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; } nextTable = nextTab; transferIndex = n; } int nextn = nextTab.length; ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); boolean advance = true; boolean finishing = false; // to ensure sweep before committing nextTab for (int i = 0, bound = 0;;) { Node&lt;K,V&gt; f; int fh; while (advance) { int nextIndex, nextBound; if (--i &gt;= bound || finishing) advance = false; else if ((nextIndex = transferIndex) &lt;= 0) { i = -1; advance = false; } else if (U.compareAndSetInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) { bound = nextBound; i = nextIndex - 1; advance = false; } } if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) { int sc; if (finishing) { nextTable = null; table = nextTab; sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; } if (U.compareAndSetInt(this, SIZECTL, sc = sizeCtl, sc - 1)) { if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; finishing = advance = true; i = n; // recheck before commit } } else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); else if ((fh = f.hash) == MOVED) advance = true; // already processed else { synchronized (f) { if (tabAt(tab, i) == f) { Node&lt;K,V&gt; ln, hn; if (fh &gt;= 0) { int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) { int b = p.hash &amp; n; if (b != runBit) { runBit = b; lastRun = p; } } if (runBit == 0) { ln = lastRun; hn = null; } else { hn = lastRun; ln = null; } for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) { int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); } setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; } else if (f instanceof TreeBin) { TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) { int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) { if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; } else { if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; } } ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; } else if (f instanceof ReservationNode) throw new IllegalStateException(&quot;Recursive update&quot;); } } } }} é¦–å…ˆå…ˆåˆ’åˆ†æ¯ä¸ªçº¿ç¨‹çš„æ­¥é•¿ ä¸º(n &gt;&gt;&gt; 3) / NCPUï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªcpué‚£ä¹ˆæ­¥é•¿ä¸ºæ•´ä¸ªè¡¨ï¼ŒåŒæ—¶è¿˜ä¼šåœ¨æ ¡éªŒä¸€æ¬¡æ­¥é•¿ï¼Œå°äº16åˆ™è®¾ç½®ä¸º16 å¦‚æœnextTabä¸ºç©ºåˆ™ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç”³è¯·åŸæœ‰æ•°é‡ä¸¤å€çš„æ•°ç»„ï¼Œå¦‚æœoomäº†åˆ™sizeCtlè®¾ä¸ºintæœ€å¤§å€¼ ç„¶åå°±å¼€å§‹åˆ’åˆ†æ•°ç»„ï¼Œå¦‚æœnodeæ•°ç»„ä½ç½®ä¸ºç©ºåˆ™ç›´æ¥è®¾ç½®fwdèŠ‚ç‚¹è¡¨ç¤ºå·²ç»å®Œæˆï¼Œmovedæ ‡å¿—è¡¨ç¤ºè¯¥ä½ç½®å·²ç»å®Œæˆè¿ç§»æ— éœ€æ“ä½œï¼Œå¦åˆ™æ‰ä¼šè¿›å…¥åˆ°é“¾è¡¨å’Œçº¢é»‘æ ‘çš„è¿ç§»è¿‡ç¨‹ï¼Œç±»ä¼¼äºHashMapå°±ä¸åœ¨èµ˜è¿°ï¼Œæœ€åä¸€æ­¥åŒæ ·ä¹Ÿä¼šè®¾ç½®fwdèŠ‚ç‚¹è¡¨ç¤ºå·²ç»å®Œæˆ å®Œæˆç‰¹å®šæ­¥é•¿åï¼ŒsizeCtl-1è®¾ç½®ç»“æŸæ ‡å¿—é€€å‡ºï¼Œå½“æœ€åä¸€ä¸ªçº¿ç¨‹å®Œæˆåï¼Œä»–è¿˜ä¼šå¯¹å…¨éƒ¨æ•°ç»„è¿›è¡Œä¸ªéå†ç¡®è®¤æ˜¯å¦æœ‰é—æ¼ã€‚","link":"/2023/03/30/JavaCollection/"},{"title":"java å¹¶å‘","text":"å‚è€ƒé“¾æ¥ï¼šhttps://javaguide.cn/java/concurrent/java-concurrent-questions-02.html å‚è€ƒä¹¦ç±ï¼šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆ Java å¯¹è±¡å¤´ Mark Word æŒ‡å‘ç±»çš„æŒ‡é’ˆ æ•°ç»„é•¿åº¦ï¼ˆåªæœ‰æ•°ç»„å¯¹è±¡æ‰æœ‰ï¼‰ 32ä½å¤§å°å‡ä¸º4ä¸ªå­—èŠ‚ javaå¯¹è±¡é‡‡å–8å­—èŠ‚å¯¹é½ é«˜ç«¯é¢è¯•å¿…å¤‡ï¼šä¸€ä¸ªJavaå¯¹è±¡å ç”¨å¤šå¤§å†…å­˜ - rickiyang - åšå®¢å›­ (cnblogs.com) synchronizedä¸»è¦è§£å†³çš„æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥æ€§ï¼Œå¯ä»¥ä¿è¯è¢«å®ƒä¿®é¥°çš„æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ å†ç¨‹åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œsynchronized å±äº é‡é‡çº§é”ï¼Œæ•ˆç‡ä½ä¸‹ã€‚è¿™æ˜¯å› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚ åœ¨ Java 6 ä¹‹åï¼Œ synchronized å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–å¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚ ä½¿ç”¨æ–¹æ³•synchronized å…³é”®å­—åŠ åˆ° static é™æ€æ–¹æ³•å’Œ synchronized(class) ä»£ç å—ä¸Šéƒ½æ˜¯æ˜¯ç»™ Class ç±»ä¸Šé”ï¼› synchronized å…³é”®å­—åŠ åˆ°å®ä¾‹æ–¹æ³•ä¸Šæ˜¯ç»™å¯¹è±¡å®ä¾‹ä¸Šé”ï¼› å°½é‡ä¸è¦ä½¿ç”¨ synchronized(String a) å› ä¸º JVM ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å…·æœ‰ç¼“å­˜åŠŸèƒ½ã€‚ synchronized åŒæ­¥è¯­å¥å—çš„å®ç°ä½¿ç”¨çš„æ˜¯ monitorenter å’Œ monitorexit æŒ‡ä»¤ï¼Œå…¶ä¸­ monitorenter æŒ‡ä»¤æŒ‡å‘åŒæ­¥ä»£ç å—çš„å¼€å§‹ä½ç½®ï¼Œmonitorexit æŒ‡ä»¤åˆ™æŒ‡æ˜åŒæ­¥ä»£ç å—çš„ç»“æŸä½ç½®ã€‚ synchronized ä¿®é¥°çš„æ–¹æ³•æ˜¯ ACC_SYNCHRONIZED æ ‡è¯†ï¼Œè¯¥æ ‡è¯†æŒ‡æ˜äº†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ã€‚JVM é€šè¿‡è¯¥ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ¥è¾¨åˆ«ä¸€ä¸ªæ–¹æ³•æ˜¯å¦å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„åŒæ­¥è°ƒç”¨ã€‚å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å®ä¾‹å¯¹è±¡çš„é”ã€‚å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼ŒJVM ä¼šå°è¯•è·å–å½“å‰ class çš„é”ã€‚ é”åˆ†ç±»çº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼š æ— é”çŠ¶æ€ åå‘é”çŠ¶æ€ è½»é‡çº§é”çŠ¶æ€ é‡é‡çº§é”çŠ¶æ€ é”å¯ä»¥å‡çº§ï¼Œä½†ä¸èƒ½é™çº§ã€‚å³ï¼šæ— é” -&gt; åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”æ˜¯å•å‘çš„ã€‚ é”çš„å‡çº§å‚è€ƒ æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºçä¼˜åŒ–éƒ¨åˆ† è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹åœ¨JDK 6ä¸­å¯¹è‡ªæ—‹é”çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†æ˜¯å›ºå®šçš„äº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚ å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ï¼Œæ¯”å¦‚æŒç»­100æ¬¡å¿™å¾ªç¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡é”ï¼Œé‚£åœ¨ä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†æœ‰å¯èƒ½ç›´æ¥çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ é”æ¶ˆé™¤é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯ã€‚ å½“ç¼–è¯‘å™¨ç¡®å®šä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œå®ƒä¾¿ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚ å‡½æ•°é‡Œå¤šä¸ªåŒæ­¥æ–¹æ³•ï¼Œä¸”æ‰€æœ‰å¼•ç”¨æ²¡æ³•é€ƒé€¸å‡ºå‡½æ•°çš„ä½¿ç”¨èŒƒå›´ï¼Œå°±å¯ä»¥å»é™¤åŒæ­¥æ–¹æ³•ã€‚ é¢å¤–æ ‡é‡æ›¿æ¢ é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼ŒåŸºç¡€ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨å¯ä»¥ç†è§£ä¸ºæ ‡é‡ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡ã€‚ å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åšæ ‡é‡æ›¿æ¢ã€‚ è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚ æ ‡é‡æ›¿æ¢åœ¨ JDK1.8 ä¸­ä¹Ÿæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿè¦å»ºç«‹åœ¨å·²å¼€å¯é€ƒé€¸åˆ†æçš„åŸºç¡€ä¹‹ä¸Šã€‚ æ ˆå†…å­˜åˆ†é… æ ˆå†…å­˜åˆ†é…å¾ˆå¥½ç†è§£ï¼Œåœ¨ä¸Šæ–‡ä¸­æè¿‡ï¼Œå°±æ˜¯å°†åŸæœ¬åˆ†é…åœ¨å †å†…å­˜ä¸Šçš„å¯¹è±¡è½¬è€Œåˆ†é…åœ¨æ ˆå†…å­˜ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å †å†…å­˜çš„å ç”¨ï¼Œä»è€Œå‡å°‘ GC çš„é¢‘æ¬¡ã€‚ é”ç²—åŒ–å¦‚æœè™šæ‹Ÿæœºæ¢æµ‹åˆ°æœ‰è¿™æ ·ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ è½»é‡çº§é”åŠ é”è¿‡ç¨‹ï¼Œä¼šå…ˆåœ¨æ ˆå¸§å¼€è¾Ÿä¸€ä¸ªé”è®°å½•çš„ç©ºé—´ï¼Œè®°å½•åŸæ¥markwordä¸­çš„å€¼ï¼Œ è™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•æŠŠå¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆ è§£é”è¿‡ç¨‹ä¹ŸåŒæ ·æ˜¯é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œå¦‚æœå¯¹è±¡çš„Mark Wordä»ç„¶æŒ‡å‘çº¿ç¨‹çš„é”è®°å½•ï¼Œé‚£å°±ç”¨CASæ“ä½œæŠŠå¯¹è±¡å½“å‰çš„Mark Wordå’Œçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordæ›¿æ¢å›æ¥ã€‚å‡å¦‚èƒ½å¤ŸæˆåŠŸæ›¿æ¢ï¼Œé‚£æ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±é¡ºåˆ©å®Œæˆäº†ï¼›å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼Œå°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ åå‘é”Java6åŠä»¥ä¸Šç‰ˆæœ¬å¯¹synchronizedçš„ä¼˜åŒ– - èœ—ç‰›å¤§å¸ˆ - åšå®¢å›­ (cnblogs.com) å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å–çš„æ—¶å€™ï¼Œè™šæ‹Ÿæœºå°†ä¼šæŠŠå¯¹è±¡å¤´ä¸­çš„æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ01â€ã€æŠŠåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºè¿›å…¥åå‘æ¨¡å¼ã€‚åŒæ—¶ä½¿ç”¨CASæ“ä½œæŠŠè·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹çš„IDè®°å½•åœ¨å¯¹è±¡çš„Mark Wordä¹‹ä¸­ã€‚å¦‚æœCASæ“ä½œæˆåŠŸï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹ä»¥åæ¯æ¬¡è¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½å¯ä»¥ä¸å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼ˆä¾‹å¦‚åŠ é”ã€è§£é”åŠå¯¹Mark Wordçš„æ›´æ–°æ“ä½œç­‰ï¼‰ã€‚ ä¸€æ—¦å‡ºç°å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”çš„æƒ…å†µï¼Œåå‘æ¨¡å¼å°±é©¬ä¸Šå®£å‘Šç»“æŸã€‚æ ¹æ®é”å¯¹è±¡ç›®å‰æ˜¯å¦å¤„äºè¢«é”å®šçš„çŠ¶æ€å†³å®šæ˜¯å¦æ’¤é”€åå‘ï¼ˆåå‘æ¨¡å¼è®¾ç½®ä¸ºâ€œ0â€ï¼‰ï¼Œæ’¤é”€åæ ‡å¿—ä½æ¢å¤åˆ°æœªé”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”å®šï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ï¼Œåç»­çš„åŒæ­¥æ“ä½œå°±æŒ‰ç…§ä¸Šé¢ä»‹ç»çš„è½»é‡çº§é”é‚£æ ·å»æ‰§è¡Œã€‚åå‘é”ã€è½»é‡çº§é”çš„çŠ¶æ€è½¬åŒ–åŠå¯¹è±¡Mark Wordçš„å…³ç³»å¦‚å›¾æ‰€ç¤ºã€‚ å½“ä¸€ä¸ªå¯¹è±¡å·²ç»è®¡ç®—è¿‡ä¸€è‡´æ€§å“ˆå¸Œç åï¼Œå®ƒå°±å†ä¹Ÿæ— æ³•è¿›å…¥åå‘é”çŠ¶æ€äº†ï¼›è€Œå½“ä¸€ä¸ªå¯¹è±¡å½“å‰æ­£å¤„äºåå‘é”çŠ¶æ€ï¼Œåˆæ”¶åˆ°éœ€è¦è®¡ç®—å…¶ä¸€è‡´æ€§å“ˆå¸Œç è¯·æ±‚[1]æ—¶ï¼Œå®ƒçš„åå‘çŠ¶æ€ä¼šè¢«ç«‹å³æ’¤é”€ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚(è¿™é‡Œè¯´çš„è®¡ç®—è¯·æ±‚åº”æ¥è‡ªäºå¯¹Object::hashCode()æˆ–è€…System::identityHashCode(Object)æ–¹æ³•çš„è°ƒç”¨ï¼Œå¦‚æœé‡å†™äº†å¯¹è±¡çš„hashCode()æ–¹æ³•ï¼Œè®¡ç®—å“ˆå¸Œç æ—¶å¹¶ä¸ä¼šäº§ç”Ÿè¿™é‡Œæ‰€è¯´çš„è¯·æ±‚) Javaå†…å­˜æ¨¡å‹ è¿™é‡Œæ‰€è®²çš„ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸ç¬¬2ç« æ‰€è®²çš„Javaå†…å­˜åŒºåŸŸä¸­çš„Javaå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å¹¶ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å¯¹å†…å­˜çš„åˆ’åˆ†ï¼Œè¿™ä¸¤è€…åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚å¦‚æœä¸¤è€…ä¸€å®šè¦å‹‰å¼ºå¯¹åº”èµ·æ¥ï¼Œé‚£ä¹ˆä»å˜é‡ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜çš„å®šä¹‰æ¥çœ‹ï¼Œä¸»å†…å­˜ä¸»è¦å¯¹åº”äºJavaå †ä¸­çš„å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†[4]ï¼Œè€Œå·¥ä½œå†…å­˜åˆ™å¯¹åº”äºè™šæ‹Ÿæœºæ ˆä¸­çš„éƒ¨åˆ†åŒºåŸŸã€‚ UnsafeUnsafe æ˜¯ä½äº sun.misc åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ï¼Œè¿™äº›æ–¹æ³•åœ¨æå‡ Java è¿è¡Œæ•ˆç‡ã€å¢å¼º Java è¯­è¨€åº•å±‚èµ„æºæ“ä½œèƒ½åŠ›æ–¹é¢èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ ä¸»è¦åŠŸèƒ½åˆ†ç±» å†…å­˜æ“ä½œ å†…å­˜å±éšœ 123456//å†…å­˜å±éšœï¼Œç¦æ­¢loadæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„loadæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰public native void loadFence();//å†…å­˜å±éšœï¼Œç¦æ­¢storeæ“ä½œé‡æ’åºã€‚å±éšœå‰çš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœåï¼Œå±éšœåçš„storeæ“ä½œä¸èƒ½è¢«é‡æ’åºåˆ°å±éšœå‰public native void storeFence();//å†…å­˜å±éšœï¼Œç¦æ­¢loadã€storeæ“ä½œé‡æ’åºpublic native void fullFence(); å¯¹è±¡æ“ä½œ æ•°æ®æ“ä½œ CAS æ“ä½œ çº¿ç¨‹è°ƒåº¦ Class æ“ä½œ ç³»ç»Ÿä¿¡æ¯ è‘—ä½œæƒå½’æ‰€æœ‰ åŸæ–‡é“¾æ¥ï¼šhttps://javaguide.cn/java/basis/unsafe.html ä¸ºå•¥è¦ä½¿ç”¨å †å¤–å†…å­˜ã€‚é€šå¸¸å› ä¸ºï¼š åœ¨è¿›ç¨‹é—´å¯ä»¥å…±äº«ï¼Œå‡å°‘è™šæ‹Ÿæœºé—´çš„å¤åˆ¶ å¯¹åƒåœ¾å›æ”¶åœé¡¿çš„æ”¹å–„ï¼šå¦‚æœåº”ç”¨æŸäº›é•¿æœŸå­˜æ´»å¹¶å¤§é‡å­˜åœ¨çš„å¯¹è±¡ï¼Œç»å¸¸ä¼šå‡ºå‘YGCæˆ–è€…FullGCï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™äº›å¯¹è±¡æ”¾åˆ°å †å¤–ã€‚è¿‡å¤§çš„å †ä¼šå½±å“Javaåº”ç”¨çš„æ€§èƒ½ã€‚å¦‚æœä½¿ç”¨å †å¤–å†…å­˜çš„è¯ï¼Œå †å¤–å†…å­˜æ˜¯ç›´æ¥å—æ“ä½œç³»ç»Ÿç®¡ç†( è€Œä¸æ˜¯è™šæ‹Ÿæœº )ã€‚è¿™æ ·åšçš„ç»“æœå°±æ˜¯èƒ½ä¿æŒä¸€ä¸ªè¾ƒå°çš„å †å†…å†…å­˜ï¼Œä»¥å‡å°‘åƒåœ¾æ”¶é›†å¯¹åº”ç”¨çš„å½±å“ã€‚ åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥æå‡ç¨‹åºI/Oæ“çºµçš„æ€§èƒ½ã€‚å°‘å»äº†å°†æ•°æ®ä»å †å†…å†…å­˜æ‹·è´åˆ°å †å¤–å†…å­˜çš„æ­¥éª¤ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹Java çº¿ç¨‹çŠ¶æ€å˜è¿å›¾ çº¿ç¨‹åˆå§‹çŠ¶æ€ï¼šNEW çº¿ç¨‹è¿è¡ŒçŠ¶æ€ï¼šRUNNABLE çº¿ç¨‹é˜»å¡çŠ¶æ€ï¼šBLOCKED çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼šWAITING è¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼šTIMED_WAITING çº¿ç¨‹ç»ˆæ­¢çŠ¶æ€ï¼šTERMINATED volatile å…³é”®å­—æ¯æ¬¡éƒ½è¦å¼ºåˆ¶ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ï¼Œå¦‚åŒç›´æ¥åœ¨ä¸»å†…å­˜ä¸­è¯»å†™è®¿é—® 123456789101112131415161718192021public class Singleton { private volatile static Singleton uniqueInstance; private Singleton() { } public static Singleton getUniqueInstance() { //å…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹è¿‡ï¼Œæ²¡æœ‰å®ä¾‹åŒ–è¿‡æ‰è¿›å…¥åŠ é”ä»£ç  if (uniqueInstance == null) { //ç±»å¯¹è±¡åŠ é” synchronized (Singleton.class) { if (uniqueInstance == null) { uniqueInstance = new Singleton(); } } } return uniqueInstance; }} uniqueInstance é‡‡ç”¨ volatile å…³é”®å­—ä¿®é¥°ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œ uniqueInstance = new Singleton(); è¿™æ®µä»£ç å…¶å®æ˜¯åˆ†ä¸ºä¸‰æ­¥æ‰§è¡Œï¼š ä¸º uniqueInstance åˆ†é…å†…å­˜ç©ºé—´ åˆå§‹åŒ– uniqueInstance å°† uniqueInstance æŒ‡å‘åˆ†é…çš„å†…å­˜åœ°å€ ä½†æ˜¯ç”±äº JVM å…·æœ‰æŒ‡ä»¤é‡æ’çš„ç‰¹æ€§ï¼Œæ‰§è¡Œé¡ºåºæœ‰å¯èƒ½å˜æˆ 1-&gt;3-&gt;2ã€‚æŒ‡ä»¤é‡æ’åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªçº¿ç¨‹è·å¾—è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ T1 æ‰§è¡Œäº† 1 å’Œ 3ï¼Œæ­¤æ—¶ T2 è°ƒç”¨ getUniqueInstance() åå‘ç° uniqueInstance ä¸ä¸ºç©ºï¼Œå› æ­¤è¿”å› uniqueInstanceï¼Œä½†æ­¤æ—¶ uniqueInstance è¿˜æœªè¢«åˆå§‹åŒ–ã€‚ å…·ä½“å®ç°Â·lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚ Â·unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚ Â·readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ã€‚ Â·loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚ Â·useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ Â·assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ Â·storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨ã€‚ Â·writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ åé¢æœ€æ–°çš„JSR-133æ–‡æ¡£ä¸­ï¼Œå·²ç»æ”¾å¼ƒäº†é‡‡ç”¨è¿™8ç§æ“ä½œå»å®šä¹‰Javaå†…å­˜æ¨¡å‹çš„è®¿é—®åè®®ï¼Œç¼©å‡ä¸º4ç§readã€writeã€lockå’Œunlock å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜æ‹·è´åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦æŒ‰é¡ºåºæ‰§è¡Œreadå’Œloadæ“ä½œï¼Œå¦‚æœè¦æŠŠå˜é‡ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ï¼Œå°±è¦æŒ‰é¡ºåºæ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚æ³¨æ„ï¼ŒJavaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°ä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œä½†ä¸è¦æ±‚æ˜¯è¿ç»­æ‰§è¡Œï¼Œä¸­é—´å¯ä»¥æ’å…¥å…¶ä»–æ“ä½œã€‚ volatile ä½œç”¨æ˜¯åœ¨ useä¹‹å‰å¿…é¡»æ˜¯loadã€loadä¹‹å‰å¿…é¡»use ä¿è¯äº†æ¯æ¬¡ä½¿ç”¨éƒ½æ˜¯æœ€æ–°å€¼ï¼Œassignå’Œstoreä¹Ÿä¸€æ ·ï¼Œä¿è¯äº†æ¯æ¬¡èµ‹å€¼éƒ½ä¼šå†™å›åˆ°ä¸»å†…å­˜ ReentrantLockReentrantLock å®ç°äº† Lock æ¥å£ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥ä¸”ç‹¬å å¼çš„é”ï¼Œå’Œ synchronized å…³é”®å­—ç±»ä¼¼ã€‚ä¸è¿‡ï¼ŒReentrantLock æ›´çµæ´»ã€æ›´å¼ºå¤§ï¼Œå¢åŠ äº†è½®è¯¢ã€è¶…æ—¶ã€ä¸­æ–­ã€å…¬å¹³é”å’Œéå…¬å¹³é”ç­‰é«˜çº§åŠŸèƒ½ã€‚ ThreadLocalThreadLocal æœ‰ä»€ä¹ˆç”¨ï¼Ÿæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸“å±æœ¬åœ°å˜é‡ï¼Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ThreadLocal åŸç†ThreadLocal å¯ä»¥ç†è§£ä¸ºåªæ˜¯ThreadLocalMapçš„å°è£…ï¼Œä¼ é€’äº†å˜é‡å€¼ã€‚å…¶å®å¯ä»¥çœ‹æˆä¸€ä¸ªmapï¼ŒThreadLocalMapçš„ key å°±æ˜¯ ThreadLocalå¯¹è±¡ï¼Œvalue å°±æ˜¯ ThreadLocal å¯¹è±¡è°ƒç”¨setæ–¹æ³•è®¾ç½®çš„å€¼ã€‚ ThreadLocal å†…å­˜æ³„éœ²é—®é¢˜æ˜¯æ€ä¹ˆå¯¼è‡´çš„ï¼ŸThreadLocalMap ä¸­ä½¿ç”¨çš„ key ä¸º ThreadLocal çš„å¼±å¼•ç”¨ï¼Œè€Œ value æ˜¯å¼ºå¼•ç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœ ThreadLocal æ²¡æœ‰è¢«å¤–éƒ¨å¼ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œkey ä¼šè¢«æ¸…ç†æ‰ï¼Œè€Œ value ä¸ä¼šè¢«æ¸…ç†æ‰ã€‚ è¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMap ä¸­å°±ä¼šå‡ºç° key ä¸º null çš„ Entryã€‚å‡å¦‚æˆ‘ä»¬ä¸åšä»»ä½•æªæ–½çš„è¯ï¼Œvalue æ°¸è¿œæ— æ³•è¢« GC å›æ”¶ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚ThreadLocalMap å®ç°ä¸­å·²ç»è€ƒè™‘äº†è¿™ç§æƒ…å†µï¼Œåœ¨è°ƒç”¨ set()ã€get()ã€remove() æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ¸…ç†æ‰ key ä¸º null çš„è®°å½•ã€‚ä½¿ç”¨å®Œ ThreadLocalæ–¹æ³•åæœ€å¥½æ‰‹åŠ¨è°ƒç”¨remove()æ–¹æ³• çº¿ç¨‹æ± ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å†…ç½®çº¿ç¨‹ä¸»è¦è¿˜æ˜¯é˜Ÿåˆ—é•¿åº¦æ²¡é™åˆ¶ **FixedThreadPool å’Œ SingleThreadExecutor**ï¼šä½¿ç”¨çš„æ˜¯æ— ç•Œçš„ LinkedBlockingQueueï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º Integer.MAX_VALUE,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ **CachedThreadPool**ï¼šä½¿ç”¨çš„æ˜¯åŒæ­¥é˜Ÿåˆ— SynchronousQueue, å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUE ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ ScheduledThreadPool å’Œ SingleThreadScheduledExecutor : ä½¿ç”¨çš„æ— ç•Œçš„å»¶è¿Ÿé˜»å¡é˜Ÿåˆ—DelayedWorkQueueï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º Integer.MAX_VALUE,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚ é˜»å¡é˜Ÿåˆ— LinkedBlockingQueueï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰ï¼šç”±äºé˜Ÿåˆ—æ°¸è¿œä¸ä¼šè¢«æ”¾æ»¡ï¼Œå› æ­¤FixedThreadPoolæœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ã€‚ SynchronousQueueï¼ˆåŒæ­¥é˜Ÿåˆ—ï¼‰ï¼š æ²¡æœ‰å®¹é‡ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œç›®çš„æ˜¯ä¿è¯å¯¹äºæäº¤çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼›å¦åˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ DelayedWorkQueueï¼ˆå»¶è¿Ÿé˜»å¡é˜Ÿåˆ—ï¼‰ï¼šDelayedWorkQueue çš„å†…éƒ¨å…ƒç´ å¹¶ä¸æ˜¯æŒ‰ç…§æ”¾å…¥çš„æ—¶é—´æ’åºï¼Œè€Œæ˜¯ä¼šæŒ‰ç…§å»¶è¿Ÿçš„æ—¶é—´é•¿çŸ­å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œå†…éƒ¨é‡‡ç”¨çš„æ˜¯â€œå †â€çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„ã€‚DelayedWorkQueue æ·»åŠ å…ƒç´ æ»¡äº†ä¹‹åä¼šè‡ªåŠ¨æ‰©å®¹åŸæ¥å®¹é‡çš„ 1/2ï¼Œå³æ°¸è¿œä¸ä¼šé˜»å¡ï¼Œæœ€å¤§æ‰©å®¹å¯è¾¾ Integer.MAX_VALUEï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°çš„çº¿ç¨‹ã€‚","link":"/2023/04/18/javaConcurrent/"},{"title":"è®¡ç®—æœºç½‘ç»œ","text":"https://xiaolincoding.com/network/3_tcp/tcp_interview.html TCPä¸‰æ¬¡æ¡æ‰‹ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é˜»æ­¢é‡å¤å†å²è¿æ¥çš„åˆå§‹åŒ–ï¼ˆä¸»è¦åŸå› ï¼‰ä¸»è¦æ˜¯å› ä¸ºåœ¨ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰ä¸­é—´çŠ¶æ€ç»™å®¢æˆ·ç«¯æ¥é˜»æ­¢å†å²è¿æ¥ï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯èƒ½å»ºç«‹ä¸€ä¸ªå†å²è¿æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åŒæ­¥åŒæ–¹çš„åˆå§‹åºåˆ—å·ï¼Œä¸¤æ¬¡æ¡æ‰‹æ— æ³•çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°è‡ªå·±çš„åˆå§‹åºåˆ—å· ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é¿å…èµ„æºæµªè´¹ï¼Œä¸¤æ¬¡æ¡æ‰‹æœåŠ¡ç«¯æ¯æ¬¡æ¥å—åˆ°synæŠ¥æ–‡å°±ä¼šå»ºç«‹ä¸€ä¸ªè¿æ¥ å››æ¬¡æŒ¥æ‰‹ TCPä¸UDP TCP UDP æ˜¯å¦é¢å‘è¿æ¥ æ˜¯ å¦ æ˜¯å¦å¯é  æ˜¯ å¦ æ˜¯å¦æœ‰çŠ¶æ€ æ˜¯ å¦ ä¼ è¾“æ•ˆç‡ è¾ƒæ…¢ è¾ƒå¿« ä¼ è¾“å½¢å¼ å­—èŠ‚æµ æ•°æ®æŠ¥æ–‡æ®µ é¦–éƒ¨å¼€é”€ 20 ï½ 60 bytes 8 bytes æ˜¯å¦æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ å¦ æ˜¯ QUICè¿æ¥1-RTTæ¨¡å¼ 0-RTTæ¨¡å¼ å¯¹æ¯” ä¿æŒè¿æ¥id å¤šè·¯å¤ç”¨ æ‹¥å¡æ§åˆ¶","link":"/2023/05/27/network/"},{"title":"æ•°æ®åº“","text":"æ•°æ®åº“èŒƒå¼ç¬¬ä¸€èŒƒå¼ç¡®ä¿æ¯åˆ—ä¿æŒåŸå­æ€§ ç¬¬äºŒèŒƒå¼ç¡®ä¿è¡¨ä¸­çš„æ¯åˆ—éƒ½å’Œä¸»é”®ç›¸å…³ ç¬¬ä¸‰èŒƒå¼éœ€è¦ç¡®ä¿æ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸èƒ½é—´æ¥ç›¸å…³ã€‚ Mysqlè¡Œè®°å½•å­˜å‚¨äº‹åŠ¡äº‹åŠ¡ç‰¹æ€§ACID åŸå­æ€§æ˜¯é€šè¿‡undologå®ç°çš„ æŒä¹…æ€§æ˜¯é€šè¿‡redologå®ç°çš„ éš”ç¦»æ€§æ˜¯é€šè¿‡MVCCå’Œé”å®ç° ä¸€è‡´æ€§æ˜¯é€šè¿‡ åŸå­æ€§ éš”ç¦»æ€§ æŒä¹…æ€§ äº‹åŠ¡çš„éš”ç¦»çº§åˆ« åºåˆ—åŒ–(SERIALIZABLE) æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ« å¯é‡å¤è¯»(REPEATABLE READ) å¹»è¯» æäº¤è¯»(READ COMMITTED) ä¸å¯é‡å¤è¯»é—®é¢˜ è¯»æœªæäº¤(READ UNCOMMITTED) è„è¯» å¯é‡å¤è¯»æ˜¯å¦‚ä½•å·¥ä½œçš„å¯é‡å¤è¯»æ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºReadViewï¼Œå¹¶ä¸”ä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨ä½¿ç”¨è¿™ä¸ªReadView ReadViewReadViewä¸­æœ‰å››ä¸ªå­—æ®µ åˆ›å»ºæ—¶çš„äº‹åŠ¡id åˆ›å»ºæ—¶æ´»è·ƒä½†æœªæäº¤äº‹åŠ¡äº‹åŠ¡id ä»¥åŠå…¶ä¸­çš„æœ€å¤§äº‹åŠ¡idå’Œæœ€å°äº‹åŠ¡id ä¸ºä»€ä¹ˆæ˜¯å¾ˆå¤§ç¨‹åº¦é¿å…å¹»è¯»Mysqlå­˜å‚¨å¼•æ“ ç´¢å¼• æŒ‰ã€Œæ•°æ®ç»“æ„ã€åˆ†ç±»ï¼šB+treeç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•ã€‚ æŒ‰ã€Œç‰©ç†å­˜å‚¨ã€åˆ†ç±»ï¼šèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ã€äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•æˆ–éèšç°‡ç´¢å¼•ï¼‰ã€‚ æŒ‰ã€Œå­—æ®µç‰¹æ€§ã€åˆ†ç±»ï¼šä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€‚ æŒ‰ã€Œå­—æ®µä¸ªæ•°ã€åˆ†ç±»ï¼šå•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•ã€‚ ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ å¯¹ç´¢å¼•ä½¿ç”¨å‡½æ•°ä» MySQL 8.0 å¼€å§‹ï¼Œç´¢å¼•ç‰¹æ€§å¢åŠ äº†å‡½æ•°ç´¢å¼•ï¼Œå³å¯ä»¥é’ˆå¯¹å‡½æ•°è®¡ç®—åçš„å€¼å»ºç«‹ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥ç´¢å¼•çš„å€¼æ˜¯å‡½æ•°è®¡ç®—åçš„å€¼ï¼Œæ‰€ä»¥å°±å¯ä»¥é€šè¿‡æ‰«æç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®ã€‚ å¯¹ç´¢å¼•éšå¼ç±»å‹è½¬æ¢â€˜10000â€™ å˜æˆ 10000 è¿‡ select â€œ10â€ &gt; 9 çš„ç»“æœæ¥çŸ¥é“MySQL çš„æ•°æ®ç±»å‹è½¬æ¢è§„åˆ™æ˜¯ä»€ä¹ˆï¼š å¦‚æœè§„åˆ™æ˜¯ MySQL ä¼šå°†è‡ªåŠ¨ã€Œå­—ç¬¦ä¸²ã€è½¬æ¢æˆã€Œæ•°å­—ã€ï¼Œå°±ç›¸å½“äº select 10 &gt; 9ï¼Œè¿™ä¸ªå°±æ˜¯æ•°å­—æ¯”è¾ƒï¼Œæ‰€ä»¥ç»“æœåº”è¯¥æ˜¯ 1ï¼› å¦‚æœè§„åˆ™æ˜¯ MySQL ä¼šå°†è‡ªåŠ¨ã€Œæ•°å­—ã€è½¬æ¢æˆã€Œå­—ç¬¦ä¸²ã€ï¼Œå°±ç›¸å½“äº select â€œ10â€ &gt; â€œ9â€ï¼Œè¿™ä¸ªæ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒå¤§å°æ˜¯é€ä½ä»é«˜ä½åˆ°ä½ä½é€ä¸ªæ¯”è¾ƒï¼ˆæŒ‰asciiç ï¼‰ ï¼Œé‚£ä¹ˆâ€10â€å­—ç¬¦ä¸²ç›¸å½“äº â€œ1â€å’Œâ€œ0â€å­—ç¬¦çš„ç»„åˆï¼Œæ‰€ä»¥å…ˆæ˜¯æ‹¿ â€œ1â€ å­—ç¬¦å’Œ â€œ9â€ å­—ç¬¦æ¯”è¾ƒï¼Œå› ä¸º â€œ1â€ å­—ç¬¦æ¯” â€œ9â€ å­—ç¬¦å°ï¼Œæ‰€ä»¥ç»“æœåº”è¯¥æ˜¯ 0ã€‚ å¦‚æœåœ¨æŸ¥è¯¢å­—æ®µä¸Šå‘ç”Ÿè‡ªåŠ¨è½¬æ¢é‚£ä¹ˆä¹…èµ°ä¸äº†ç´¢å¼• è”åˆç´¢å¼•éæœ€å·¦åŒ¹é…é¡ºåºä¸é‡è¦ï¼Œå› ä¸ºæœ‰æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´é¡ºåº ç´¢å¼•ï¼ˆa,b,cï¼‰ b b c ä¸èµ°ç´¢å¼• a c æˆªæ–­ç´¢å¼• ç´¢å¼•ä¸‹æ¨åŠŸèƒ½ WHERE å­å¥ä¸­çš„ ORåœ¨ WHERE å­å¥ä¸­ï¼Œå¦‚æœåœ¨ OR å‰çš„æ¡ä»¶åˆ—æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œåœ¨ OR åçš„æ¡ä»¶åˆ—ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆç´¢å¼•ä¼šå¤±æ•ˆã€‚ explainInnoDBæœ‰å“ªäº›é” å…¨å±€é”å…¨å±€é”ä¸»è¦åº”ç”¨äºåšå…¨åº“é€»è¾‘å¤‡ä»½ï¼Œè¿™æ ·åœ¨å¤‡ä»½æ•°æ®åº“æœŸé—´ï¼Œä¸ä¼šå› ä¸ºæ•°æ®æˆ–è¡¨ç»“æ„çš„æ›´æ–°ï¼Œè€Œå‡ºç°å¤‡ä»½æ–‡ä»¶çš„æ•°æ®ä¸é¢„æœŸçš„ä¸ä¸€æ ·ã€‚ ä¾‹å­ï¼šå¤‡ä»½è¿‡ç¨‹ä¸­è´­ä¹°å•†å“åï¼Œä½™é¢å·²ç»å¤‡ä»½è¿‡äº† å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ ï¼ˆå¦‚æœæ•°æ®åº“çš„å¼•æ“æ”¯æŒçš„äº‹åŠ¡æ”¯æŒå¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ï¼Œä¼šå…ˆåˆ›å»º Read Viewï¼Œç„¶åæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½åœ¨ç”¨è¿™ä¸ª Read Viewï¼Œè€Œä¸”ç”±äº MVCC çš„æ”¯æŒï¼Œå¤‡ä»½æœŸé—´ä¸šåŠ¡ä¾ç„¶å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œã€‚ å¤‡ä»½æ•°æ®åº“çš„å·¥å…·æ˜¯ mysqldumpï¼Œåœ¨ä½¿ç”¨ mysqldump æ—¶åŠ ä¸Š â€“single-transaction å‚æ•°çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å¤‡ä»½æ•°æ®åº“ä¹‹å‰å…ˆå¼€å¯äº‹åŠ¡ã€‚è¿™ç§æ–¹æ³•åªé€‚ç”¨äºæ”¯æŒã€Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ã€çš„å­˜å‚¨å¼•æ“ã€‚ï¼‰ è¡¨çº§é”è¡¨é”è¯»é”å’Œå†™é” å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰ å¯¹ä¸€å¼ è¡¨è¿›è¡Œ CRUD æ“ä½œæ—¶ï¼ŒåŠ çš„æ˜¯ MDL è¯»é”ï¼› å¯¹ä¸€å¼ è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ çš„æ˜¯ MDL å†™é”ï¼› æ„å‘é”å½“æ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å…ˆå¯¹è¡¨åŠ ä¸Šã€Œæ„å‘ç‹¬å é”ã€ï¼Œç„¶åå¯¹è¯¥è®°å½•åŠ ç‹¬å é”ã€‚ æ„å‘é”çš„ç›®çš„æ˜¯ä¸ºäº†å¿«é€Ÿåˆ¤æ–­è¡¨é‡Œæ˜¯å¦æœ‰è®°å½•è¢«åŠ é”ã€‚ AUTO-INC é”AUTO-INC é”æ˜¯ç‰¹æ®Šçš„è¡¨é”æœºåˆ¶ï¼Œé”ä¸æ˜¯å†ä¸€ä¸ªäº‹åŠ¡æäº¤åæ‰é‡Šæ”¾ï¼Œè€Œæ˜¯å†æ‰§è¡Œå®Œæ’å…¥è¯­å¥åå°±ä¼šç«‹å³é‡Šæ”¾ã€‚ InnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸ª innodb_autoinc_lock_mode çš„ç³»ç»Ÿå˜é‡ï¼Œæ˜¯ç”¨æ¥æ§åˆ¶é€‰æ‹©ç”¨ AUTO-INC é”ï¼Œè¿˜æ˜¯è½»é‡çº§çš„é”ã€‚ å½“ innodb_autoinc_lock_mode = 0ï¼Œå°±é‡‡ç”¨ AUTO-INC é”ï¼Œè¯­å¥æ‰§è¡Œç»“æŸåæ‰é‡Šæ”¾é”ï¼› å½“ innodb_autoinc_lock_mode = 2ï¼Œå°±é‡‡ç”¨è½»é‡çº§é”ï¼Œç”³è¯·è‡ªå¢ä¸»é”®åå°±é‡Šæ”¾é”ï¼Œå¹¶ä¸éœ€è¦ç­‰è¯­å¥æ‰§è¡Œåæ‰é‡Šæ”¾ã€‚ å½“ innodb_autoinc_lock_mode = 1ï¼š æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼› ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼› å½“ innodb_autoinc_lock_mode = 2 æ—¶ï¼Œå¹¶ä¸” binlog_format = rowï¼Œæ—¢èƒ½æå‡å¹¶å‘æ€§ï¼Œåˆä¸ä¼šå‡ºç°æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ è¡Œçº§é”è¡Œçº§é”çš„ç±»å‹ä¸»è¦æœ‰ä¸‰ç±»ï¼š Record Lockï¼Œè®°å½•é”ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ä¸Šï¼› Gap Lockï¼Œé—´éš™é”ï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä½†æ˜¯ä¸åŒ…å«è®°å½•æœ¬èº«ï¼› Next-Key Lockï¼šRecord Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚ Record Lockè®°å½•é”æ˜¯æœ‰ S é”å’Œ X é”ä¹‹åˆ†çš„ï¼š Gap LockGap Lock ç§°ä¸ºé—´éš™é”ï¼Œåªå­˜åœ¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¹»è¯»çš„ç°è±¡ã€‚ é—´éš™é”è™½ç„¶å­˜åœ¨ X å‹é—´éš™é”å’Œ S å‹é—´éš™é”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œé—´éš™é”ä¹‹é—´æ˜¯å…¼å®¹çš„ï¼Œå³ä¸¤ä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶æŒæœ‰åŒ…å«å…±åŒé—´éš™èŒƒå›´çš„é—´éš™é”ï¼Œå¹¶ä¸å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œå› ä¸ºé—´éš™é”çš„ç›®çš„æ˜¯é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚ï¼ˆæ— æ‰€è°“åªæ˜¯ä¸è®©åœ¨æŒ‡å®šèŒƒå›´æ’å…¥ï¼Œå¤šä¸ªèŒƒå›´ä¹Ÿæ˜¯ä¸€æ ·ä¸èƒ½æ’å…¥ï¼Œä½†æ˜¯éƒ½å¯ä»¥ä¿®æ”¹ï¼‰ Next-Key LockNext-Key Lock ç§°ä¸ºä¸´é”®é”ï¼Œæ˜¯ Record Lock + Gap Lock çš„ç»„åˆï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”é”å®šè®°å½•æœ¬èº«ã€‚ æ’å…¥æ„å‘é”åœ¨æ’å…¥åŒºé—´æ‹¥æœ‰é—´éš™é”æˆ–è€…Next-Key Lockçš„æ—¶å€™ï¼Œè¡¨æ˜æ’å…¥æ„å‘ï¼Œç”Ÿæˆæ’å…¥æ„å‘é”ï¼Œç­‰å¾…é”ä½åŒºé—´çš„äº‹åŠ¡æäº¤åå³å¯è¿›è¡Œæ’å…¥ï¼Œå’Œé—´éš™é”äº’æ–¥","link":"/2023/06/12/database/"},{"title":"JVM","text":"Java è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ ç¨‹åºè®¡æ•°å™¨å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„å†…å­˜åŒºåŸŸ è™šæ‹Ÿæœºæ ˆè°ƒç”¨é™¤æœ¬åœ°æ–¹æ³•å¤–æ‰€æœ‰javaæ–¹æ³•éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ ˆå¸§ï¼Œé‡Œé¢å­˜æ”¾å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ å½“ä¸€ä¸ªæ–¹æ³•è¦è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œéœ€è¦å°†å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºå…¶åœ¨å†…å­˜åœ°å€ä¸­çš„ç›´æ¥å¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ æœ¬åœ°æ–¹æ³•æ ˆè°ƒç”¨æœ¬åœ°æ–¹æ³•çš„æ ˆå¸§ï¼Œå­˜æ”¾ä¿¡æ¯ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œæ–¹æ³•è¿”å›åœ°å€å˜æˆå‡ºå£ä¿¡æ¯ å †1.7 ä¹‹å‰ æ–°ç”Ÿä»£å†…å­˜(Young Generation) è€ç”Ÿä»£(Old Generation) æ°¸ä¹…ä»£(Permanent Generation) 1.8 ä¹‹åæ°¸ä¹…ä»£å˜æˆæ°¸ä¹…ä»£ å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾ç½®ã€‚ ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢? æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®çš„å›ºå®šå¤§å°ä¸Šé™ï¼Œæ— æ³•è¿›è¡Œè°ƒæ•´ï¼Œè€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼Œå—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶ï¼Œè™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡ºï¼Œä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°ã€‚ä½ å¯ä»¥ä½¿ç”¨ -XXï¼šMaxMetaspaceSize æ ‡å¿—è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼Œé»˜è®¤å€¼ä¸º unlimitedã€‚èƒ½å­˜å‚¨çš„ä¿¡æ¯æ›´åŠ å¤š æ–¹æ³•åŒºæ–¹æ³•åŒºä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚ ç›´æ¥å†…å­˜Java NIO ä¸­ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨Nativeæ–¹æ³•åˆ†é…å †å¤–å†…å­˜ï¼ŒDirectByteBuffer å¯ä»¥ç›´æ¥å¼•ç”¨è¿™å—å†…å­˜ å¯¹è±¡çš„åˆ›å»ºæµç¨‹ ç±»åŠ è½½æ£€æŸ¥ï¼Œå…ˆå»å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œåˆ¤æ–­æ˜¯å¦åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ï¼Œå¦‚æœæ²¡æœ‰å°±è¿›è¡Œç±»åŠ è½½è¿‡ç¨‹ åˆ†é…å†…å­˜ï¼ŒæŒ‡é’ˆç¢°æ’å–å†³äºå†…å­˜æ˜¯å¦è§„æ•´ï¼Œä¸è§„æ•´å°±ä½¿ç”¨ç©ºé—²åˆ—è¡¨æ–¹æ³• åˆå§‹åŒ–é›¶å€¼ï¼Œåˆ†é…çš„å†…å­˜è¿›è¡Œé›¶å€¼å¡«å……ã€‚ åŠ è½½å¯¹è±¡å¤´ï¼Œè®¾ç½®gcå¹´é¾„ã€å“ˆå¸Œç ã€åˆ†ä»£ä¿¡æ¯ï¼ŒæŒ‡å‘ç±»çš„æŒ‡é’ˆ æ‰§è¡Œinitæ–¹æ³•. ä»€ä¹ˆæ˜¯TLAB ? ä»å†…å­˜æ¨¡å‹è€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„è§’åº¦ï¼Œå¯¹EdenåŒºåŸŸç»§ç»­è¿›è¡Œåˆ’åˆ†ï¼ŒJVMä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸï¼Œå®ƒåŒ…å«åœ¨Edenç©ºé—´å†…ã€‚ å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨TLABå¯ä»¥é¿å…ä¸€ç³»åˆ—çš„éçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸ºå¿«é€Ÿåˆ†é…ç­–ç•¥ã€‚ å†…å­˜åˆ†é…ç­–ç•¥ å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºåˆ†é… å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ï¼ˆæ²¡ç»è¿‡ä¸€æ¬¡minorGCå¹´é¾„å°±å¢åŠ ä¸€å²ï¼Œç¬¬ä¸€æ¬¡ä¼šä»EdenåŒºè¿›å…¥SurvivoråŒºï¼Œå²æ•°ä¸º1ï¼Œé»˜è®¤åäº”å²è¿›å…¥è€å¹´ä»£ï¼‰ ç©ºé—´åˆ†é…æ‹…ä¿åœ¨è¿›è¡ŒminorGCä¹‹å‰ï¼Œå…ˆç¡®è®¤è€å¹´ä»£æ˜¯å¦å¯ä»¥å®¹çº³æ‰€æœ‰æ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œå¯ä»¥å®¹çº³å°±å¯ä»¥è¿›è¡Œï¼Œå¦åˆ™ä¼šæ£€æŸ¥ç¨‹åºå‘˜æ˜¯å¦è®¾ç½®å‚æ•°å…è®¸æ‹…ä¿å¤±è´¥ GCåˆ†ç±»éƒ¨åˆ†GC minorGCï¼Œ youngGC MajorGC, OldGC MixedGCï¼ˆæ–°ç”Ÿä»£çš„å…¨éƒ¨å’Œéƒ¨åˆ†è€å¹´ä»£ï¼‰ fullGC æ­»äº¡å¯¹è±¡åˆ†ææ³•å¼•ç”¨è®¡æ•°æ³•ï¼ˆäº’ç›¸å¼•ç”¨çš„é—®é¢˜ï¼‰ å¯è¾¾æ€§åˆ†æï¼ˆGCRoots å‡ºå‘ï¼Œå¯ä»¥æ˜¯è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸­çš„å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­é™æ€å˜é‡æˆ–å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡ï¼‰å®£å‘Šå¯¹è±¡çš„æ­»äº¡è‡³å°‘è¦ç»è¿‡ä¸¤æ¬¡æ ‡è®° å¼•ç”¨æ€»ç»“å¼ºå¼•ç”¨å¹³æ—¶ä½¿ç”¨çš„åŸºæœ¬éƒ½æ˜¯å¼ºå¼•ç”¨ï¼ŒæŠ›å‡ºå†…å­˜ä¸è¶³çš„å¼‚å¸¸ä¹Ÿä¸ä¼šæŠ¥é”™ è½¯å¼•ç”¨å¯æœ‰å¯æ— ï¼Œå¦‚æœç©ºé—´ä¸å¤Ÿäº†å°±è¿›è¡Œå›æ”¶ å¼±å¼•ç”¨ä¸€æ—¦å‘ç°äº†å¼±å¼•ç”¨å°±ä¼šè¿›è¡Œå›æ”¶ ä¸è¿‡åƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œä¸ä¼šå¾ˆå¿«å‘ç°è¿™äº›å¼±å¼•ç”¨ è™šå¼•ç”¨å¦‚æœæŒæœ‰è™šå¼•ç”¨é‚£ä¹ˆä»»ä½•æ—¶å€™éƒ½ä¼šè¢«å›æ”¶ è™šå¼•ç”¨å’Œè½¯å¼•ç”¨çš„åŒºåˆ«è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨è™šå¼•ç”¨è¢«å›æ”¶çš„æ—¶å€™é€šçŸ¥ä¸€ä¸‹ï¼Œ å®˜æ–¹è¯´æ³•æ˜¯ç¨‹åºå‘ç°å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰è™šå¼•ç”¨çš„æ—¶å€™ï¼Œèƒ½åœ¨å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™é‡‡å–å¿…è¦çš„åŠ¨ä½œ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„å˜é‡è¯¥å˜é‡æ²¡æœ‰è¢«ä»»ä½•å¼•ç”¨ å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„ç±» è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½è¢«å›æ”¶ è¯¥ç±»çš„classloaderè¢«å›æ”¶ æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼ŒåŒ…æ‹¬åå°„è®¿é—®å…¶ç±»çš„æ–¹æ³•æˆ–è€…å˜é‡ åƒåœ¾å›æ”¶åƒåœ¾æ”¶é›†ç®—æ³•æ ‡è®°-æ•´ç† ï¼ˆé€‚åˆè€å¹´ä»£è¿™ç§æ•´ç†æƒ…å†µæ¯”è¾ƒå°‘çš„ï¼‰ æ ‡è®°-æ¸…é™¤ï¼ˆä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼‰ å¤åˆ¶ï¼ˆéœ€è¦ç›¸åŒçš„ä¸€å—å†…å­˜ï¼Œä¼šå¯¼è‡´å†…å­˜å‡åŠï¼‰ åˆ†ä»£æ”¶é›†ï¼ˆå„ä¸ªåˆ†ä»£ç‰¹ç‚¹ä¸åŒï¼Œæ–°ç”Ÿä»£äº§ç”Ÿå’Œæ¶ˆäº¡å¿«ï¼Œè€å¹´ä»£æ¯”è¾ƒç¨³å®šï¼‰ é»˜è®¤åƒåœ¾æ”¶é›†å™¨JDK é»˜è®¤åƒåœ¾æ”¶é›†å™¨ï¼ˆä½¿ç”¨ java -XX:+PrintCommandLineFlags -version å‘½ä»¤æŸ¥çœ‹ï¼‰ï¼š JDK 8ï¼šParallel Scavengeï¼ˆæ–°ç”Ÿä»£ï¼‰+ Parallel Oldï¼ˆè€å¹´ä»£ï¼‰ JDK 9 ~ JDK20: G1 åƒåœ¾æ”¶é›†å™¨æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•ã€è€å¹´ä»£ä½¿ç”¨æ ‡è®°æ•´ç†ç®—æ³• Serialæ”¶é›†å™¨å•çº¿ç¨‹ åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™ä¼šæš‚åœæ‰€æœ‰å…¶ä»–çº¿ç¨‹ã€ç®€å•é«˜æ•ˆ ParNewæ”¶é›†å™¨æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³• stwçš„ç°è±¡ä»ç„¶å­˜åœ¨ Parallel Scavengeæ”¶é›†å™¨ä¸»è¦å…³æ³¨ç‚¹åœ¨ååé‡ Parallel oldæ”¶é›†å™¨å¤šçº¿ç¨‹è€å¹´ä»£æ”¶é›†å™¨å¯ä»¥å’ŒParallel Scavenge Serial old æ”¶é›†å™¨ä¸»è¦ä½œç”¨1.5å’Œä»¥å‰å’Œä¸Parallel Scavengeã€å’Œcmsæ”¶é›†å™¨é…åˆ CMSæ”¶é›†å™¨ä»¥æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ åˆå§‹æ ‡è®°ï¼ˆæ ‡è®°æ‰€æœ‰å’ŒRootè¿æ¥çš„å¯¹è±¡ã€STWï¼‰ å¹¶å‘æ ‡è®°ï¼ˆè®°å½•ç”¨æˆ·çº¿ç¨‹æ›´æ–°çš„å¼•ç”¨ï¼‰ é‡æ–°æ ‡è®°ï¼ˆstwé‡æ–°è¿›è¡Œæ ‡è®°ï¼‰ å¹¶å‘æ¸…ç† cpuèµ„æºæ•æ„Ÿï¼Œéœ€è¦å¤šä¸ªçº¿ç¨‹è¿›è¡Œæ ‡è®°æ¸…ç†å¹¶ä¸”æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶è¡Œ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•ä¼šæœ‰å¤§é‡ä¸è¿ç»­å†…å­˜ç©ºé—´äº§ç”Ÿï¼ˆç©ºé—´ç¢ç‰‡ï¼‰ G1æ”¶é›†å™¨ å¹¶è¡Œä¸å¹¶å‘ï¼šé€‚åˆå¤šcpuåœºæ™¯ åˆ†ä»£æ”¶é›†ï¼šå¯ä»¥éƒ½ç”¨g1æ”¶é›†å™¨ï¼Œä¹Ÿå¯ä»¥åˆ†ä»£æ”¶é›† ç©ºé—´æ•´åˆï¼šå®è§‚ä¸Šæ ‡è®°-æ•´ç†ï¼Œå¾®è§‚ä¸Šæ˜¯åŸºäºå¤åˆ¶ç®—æ³• å¯é¢„æµ‹çš„åœé¡¿ï¼šå»ºç«‹å¯åœé¡¿çš„é¢„æµ‹æ—¶é—´æ¨¡å‹ï¼Œ æµç¨‹ åˆå§‹æ ‡è®°ï¼ˆstwï¼‰ å¹¶å‘æ ‡è®°ï¼ˆstwï¼‰ æœ€ç»ˆæ ‡è®°ï¼ˆstwï¼‰ ç­›é€‰å›æ”¶ï¼ˆä¼šç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ ¹æ®æ¯æ¬¡å…è®¸çš„æ—¶é—´ï¼Œé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„regionï¼‰ ç±»åŠ è½½æœºåˆ¶æ•´ä½“åˆ†ä¸ºåŠ è½½ è¿æ¥ åˆå§‹åŒ– ä½¿ç”¨ å¸è½½ åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†åŠ¨ä½œ(å¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œ)æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªç»“æŸï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å°±å·²ç»å¼€å§‹äº†ã€‚ ç»†åˆ†åˆå¯åˆ†ä¸ºåŠ è½½é€šè¿‡å…¨ç±»åè·å–æ­¤ç±»çš„äºŒè¿›åˆ¶æ•°æ®æµã€å°†é™æ€å­˜å‚¨åŒºåŸŸæ•°æ®é›†è½¬åŒ–ä¸ºæ–¹æ³•åŒºè¿è¡Œæ—¶æ•°æ®ç»“æ„ã€å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªclasså¯¹è±¡ä½œä¸ºè®¿é—®è¿™äº›æ•°æ®çš„å…¥å£ éªŒè¯æ£€æŸ¥æ˜¯å¦ç¬¦åˆjavaè™šæ‹Ÿæœºè§„èŒƒ classæ–‡ä»¶æ ¼å¼æ£€æŸ¥ å…ƒæ•°æ®æ£€æŸ¥ï¼ˆæ˜¯å¦ç»§æ‰¿çˆ¶ç±»ã€æ˜¯å¦ç»§æ‰¿äº†ä¸èƒ½ç»§æ‰¿çš„çˆ¶ç±»ï¼‰ å­—èŠ‚ç æ£€æŸ¥ï¼ˆé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æç¨‹åºè¯­ä¹‰ï¼Œå¯¹è±¡ç±»å‹è½¬åŒ–æ˜¯å¦åˆç†ã€å‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯å¦æ­£ç¡®ï¼‰ ç¬¦å·å¼•ç”¨æ£€æŸ¥ï¼ˆæ˜¯å¦å¼•ç”¨äº†å…¶ä»–çš„ç±»ã€æ–¹æ³•ã€å­—æ®µæ˜¯å¦å­˜åœ¨æˆ–è€…æ‹¥æœ‰æ­£ç¡®çš„è®¿é—®æƒé™ï¼‰ å‡†å¤‡ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®åˆå§‹åŒ–å€¼ è§£æå°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼ˆè½¬åŒ–ä¸ºå†…å­˜ä¸­åç§»é‡ï¼‰ ï¼ˆå­—æ®µã€ç±»æ–¹æ³•ã€ç±»ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„ã€è°ƒç”¨é™å®šç¬¦ï¼‰ åˆå§‹åŒ–æ‰§è¡Œclinitæ–¹æ³• ç±»åœ¨ä»¥ä¸‹æƒ…å†µä¼šä¸»åŠ¨åˆå§‹åŒ– newä¸€ä¸ªç±»çš„æ—¶å€™ã€è·å–æˆ–è®¾ç½®é™æ€å­—æ®µå€¼çš„æ—¶å€™ã€è°ƒç”¨é™æ€æ–¹æ³•çš„æ—¶å€™ åå°„ åˆå§‹åŒ–ç±»çš„æ—¶å€™çˆ¶ç±»æ²¡æœ‰åˆå§‹åŒ– mainä¸»ç±» MethodHandlerå’ŒVarHandle åå°„è°ƒç”¨æœºåˆ¶ defaultä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼Œå®ç°è¯¥æ¥å£çš„ç±»åˆå§‹åŒ–äº†è¿™ä¸ªç±»ä¹Ÿéœ€è¦è¿›è¡Œåˆå§‹åŒ– ä½¿ç”¨å¸è½½å¸è½½ä¸€ä¸ªç±»3ä¸ªå‰æ æ‰€æœ‰å®ä¾‹éƒ½è¢«gc æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ è¯¥ç±»çš„æ‰€æœ‰ç±»åŠ è½½éƒ½è¢«å›æ”¶ ç±»åŠ è½½å™¨ç±»åŠ è½½å™¨çš„ä¸»è¦ç›®çš„åŠ è½½javaå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰åˆ°jvmä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªclasså¯¹è±¡ï¼‰ åŒäº²å§”æ´¾æ¨¡å‹ ä¸ä»…è¦çœ‹ç±»åï¼Œè¿˜è¦çœ‹æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ · ä¼˜ç‚¹ä¿è¯ç±»ä¸ä¼šè¢«é‡å¤åŠ è½½ ä¿è¯javaæ ¸å¿ƒapiç¨³å®šæ€§ï¼ˆå¦‚æœé‡å†™äº†java.lang.objectçš„è¯ï¼Œç”±äºæ˜¯è‡ªé¡¶å‘ä¸‹åŠ è½½ç±»ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ä¸€å¼€å§‹å°±åŠ è½½è¿‡äº†ï¼Œåˆ°ä¸äº†è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼‰ ç ´ååŒäº²å§”æ´¾æ¨¡å‹é‡å†™loadclass()æ–¹æ³•","link":"/2023/06/14/jvm/"},{"title":"","text":"çº¿ç¨‹æ¨¡å‹Redis æ˜¯å•çº¿ç¨‹å—ï¼ŸRediså•çº¿ç¨‹æŒ‡çš„æ˜¯ã€æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚-&gt;è§£æè¯·æ±‚-&gt;å¯¹æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œ-&gt;å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€‘è¿™ä¸ªè¿‡ç¨‹ç”±ä¸»çº¿ç¨‹å®Œæˆçš„ åœ¨2.6ç‰ˆæœ¬ä¼šå¯åŠ¨å¤„ç†å…³é—­æ–‡ä»¶å’ŒAOFåˆ·ç›˜ä»»åŠ¡ 4.0ç‰ˆæœ¬ä¼šå¢åŠ lazyFreeçº¿ç¨‹é‡Šæ”¾å†…å­˜ï¼Œä¾‹å¦‚unlink key ã€flushdb asyncã€ flushall async ä¼šæŠŠåˆ é™¤å‘½ä»¤æäº¤ç»™åå°çº¿ç¨‹æ“ä½œï¼Œè¿™æ ·ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œdelä¼šåœ¨ä¸»çº¿ç¨‹åˆ é™¤ï¼Œå¯¹äºå¤§keyæœ€å¥½è¿˜æ˜¯ä½¿ç”¨unlink è¿™äº›éƒ½æ˜¯è€—æ—¶æ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ä¸‰ç§ä»»åŠ¡éƒ½æœ‰å„è‡ªçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¼šå»æ¶ˆè´¹è¿™äº›ä»»åŠ¡ 6.0ä¹‹å‰çº¿ç¨‹æ¨¡å‹åˆ›å»ºsocket å’Œepoll_create() å¯¹è±¡ bind()ç»‘å®šç«¯å£ listenç›‘å¬ç«¯å£ epoll_ctlæŠŠlisten socketåŠ å…¥åˆ°epollï¼Œæ³¨å†Œè¿æ¥äº‹ä»¶å¤„ç†å‡½æ•° è°ƒç”¨epoll_wait() å¾ªç¯ï¼š å†™æ£€æŸ¥å‘é€é˜Ÿåˆ—ä¸­æœ‰æ— å‘é€ä»»åŠ¡ï¼Œæœ‰å°±è°ƒç”¨write()å‡½æ•°å°†å®¢æˆ·ç«¯ç¼“å†²åŒºçš„æ•°æ®å‘é€å‡ºå»ï¼Œæ²¡æœ‰å‘å®Œå°±ä¼šæ³¨å†Œä¸€ä¸ªå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰åˆ°ä¸‹ä¸€ä¸ªepoll_wait() å‡½æ•°ä¼šç»§ç»­å¤„ç† è¿æ¥äº‹ä»¶ï¼Œè°ƒç”¨è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°ä¸»è¦æ˜¯è°ƒç”¨accept()å‡½æ•°è·å–è¿æ¥çš„socket å°†è¿æ¥çš„socketåŠ å…¥åˆ°epollä¸­ æ³¨å†Œè¯»äº‹ä»¶ è¯»äº‹ä»¶ï¼Œè°ƒç”¨è¯»äº‹ä»¶å¤„ç†å‡½æ•°ä¸»è¦æ˜¯è°ƒç”¨readå‡½æ•° è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ® è§£ææ•°æ® æ‰§è¡Œå‘½ä»¤ å°†å®¢æˆ·ç«¯æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— å°†å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®å†™åˆ°ç¼“å†²åŒº å†™äº‹ä»¶ï¼Œè°ƒç”¨å†™äº‹ä»¶å¤„ç†å‡½æ•°ä¸»è¦æ˜¯è°ƒç”¨write()å‡½æ•°å°†ç¼“å†²åŒºçš„æ•°æ®å…¨éƒ¨å‘é€å‡ºå»ï¼Œå¦‚æœè¿˜æ²¡æœ‰å‘å®Œä¼šç»§ç»­æ³¨å†Œå†™äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç­‰åˆ°ä¸‹ä¸€ä¸ªepoll_wait() å‡½æ•°ä¼šç»§ç»­å¤„ç† 6.0ä¹‹åä¼šå¯¹ç½‘ç»œioè¯·æ±‚è¿›è¡Œå¤šçº¿ç¨‹å¤„ç†ï¼Œé»˜è®¤åªå¯¹å†™æ“ä½œè¿›è¡Œå¤šçº¿ç¨‹å¤„ç† 6.0ä¹‹åçš„çº¿ç¨‹æ•° ä¸»çº¿ç¨‹ å…³é—­æ–‡ä»¶çº¿ç¨‹ã€AOFåˆ·ç›˜çº¿ç¨‹ã€Lazzfreeçº¿ç¨‹ ioçº¿ç¨‹*3ï¼ˆé»˜è®¤å‚æ•°æ˜¯4 ä¸»çº¿ç¨‹ä¹Ÿç®—è¿›ioçº¿ç¨‹å½“ä¸­ï¼‰ æ•°æ®ç±»å‹Redis æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œå¸¸è§çš„æœ‰äº”ç§ï¼šStringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼ŒHashï¼ˆå“ˆå¸Œï¼‰ï¼ŒListï¼ˆåˆ—è¡¨ï¼‰ï¼ŒSetï¼ˆé›†åˆï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚ éšç€ Redis ç‰ˆæœ¬çš„æ›´æ–°ï¼Œåé¢åˆæ”¯æŒäº†å››ç§æ•°æ®ç±»å‹ï¼š BitMapï¼ˆ2.2 ç‰ˆæ–°å¢ï¼‰ã€HyperLogLogï¼ˆ2.8 ç‰ˆæ–°å¢ï¼‰ã€GEOï¼ˆ3.2 ç‰ˆæ–°å¢ï¼‰ã€Streamï¼ˆ5.0 ç‰ˆæ–°å¢ï¼‰ã€‚ StringString ç±»å‹çš„åº•å±‚çš„æ•°æ®ç»“æ„å®ç°ä¸»è¦æ˜¯ int å’Œ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚ SDS å’Œæˆ‘ä»¬è®¤è¯†çš„ C å­—ç¬¦ä¸²ä¸å¤ªä¸€æ ·ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ C è¯­è¨€çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå› ä¸º SDS ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼š SDS ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚ **SDS è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)**ã€‚SDS ç»“æ„é‡Œç”¨ len å±æ€§è®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦ Redis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²ä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚ä¼šè‡ªåŠ¨æ‰©å®¹ å†…éƒ¨ç¼–ç ï¼ˆencodingï¼‰æœ‰ 3 ç§ ï¼šintã€rawï¼ˆå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äº 32 å­—èŠ‚ï¼‰å’Œ embstrï¼ˆå­—ç¬¦ç”³çš„é•¿åº¦å°äºç­‰äº 32 å­—èŠ‚ï¼‰ã€‚ åº”ç”¨åˆ†å¸ƒå¼é” ç¼“å­˜è®¡æ•° å…±äº«session Listå¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº 64 å­—èŠ‚ï¼ŒRedis ä¼šä½¿ç”¨å‹ç¼©åˆ—è¡¨ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œåä¹‹Redis ä¼šä½¿ç”¨åŒå‘é“¾è¡¨ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼› ä½†æ˜¯åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± quicklist å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨ã€‚ åº”ç”¨åŸºäº List ç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼ˆæ¶ˆæ¯ä¿åºã€å¤„ç†é‡å¤çš„æ¶ˆæ¯å’Œä¿è¯æ¶ˆæ¯å¯é æ€§ï¼‰ã€‚ æ¶ˆæ¯ä¿åºï¼šä½¿ç”¨ LPUSH + RPOPï¼› é˜»å¡è¯»å–ï¼šä½¿ç”¨ BRPOPï¼› é‡å¤æ¶ˆæ¯å¤„ç†ï¼šç”Ÿäº§è€…è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼› æ¶ˆæ¯çš„å¯é æ€§ï¼šä½¿ç”¨ BRPOPLPUSH SetSet ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆå®ç°çš„ï¼š å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº 512 ä¸ªï¼ŒRedis ä¼šä½¿ç”¨æ•´æ•°é›†åˆä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œåä¹‹åˆ™ Redis ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚ é›†åˆçš„ä¸»è¦å‡ ä¸ªç‰¹æ€§ï¼Œæ— åºã€ä¸å¯é‡å¤ã€æ”¯æŒå¹¶äº¤å·®ç­‰æ“ä½œã€‚ Set çš„å·®é›†ã€å¹¶é›†å’Œäº¤é›†çš„è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè¿™äº›è®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡ã€‚ åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸ºäº†é¿å…ä¸»åº“å› ä¸º Set åšèšåˆè®¡ç®—ï¼ˆäº¤é›†ã€å·®é›†ã€å¹¶é›†ï¼‰æ—¶å¯¼è‡´ä¸»åº“è¢«é˜»å¡ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªä»åº“å®Œæˆèšåˆç»Ÿè®¡ï¼Œæˆ–è€…æŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç”±å®¢æˆ·ç«¯æ¥å®Œæˆèšåˆç»Ÿè®¡ã€‚ åº”ç”¨æŠ½å¥–æ´»åŠ¨ï¼ˆå»é‡ï¼‰ å…±åŒå…³æ³¨ï¼ˆäº¤å¹¶é›†ï¼‰ Zsetä½¿ç”¨å‹ç¼©åˆ—è¡¨æˆ–è€…è·³è¡¨å®ç° å½“å…ƒç´ ä¸ªæ•°å°äº512çš„ï¼Œä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶æ—¶å€™ï¼Œä½¿ç”¨å‹ç¼©åˆ—è¡¨å®ç°ï¼Œåä¹‹ä½¿ç”¨è·³è¡¨ åº”ç”¨æ’è¡Œæ¦œï¼ˆæœ‰åºåˆ—è¡¨ï¼Œä¸”å¯ä»¥å•ç‹¬å¢åŠ valueçš„å€¼ï¼Œå¹¶ä¸”èƒ½æŸ¥è¯¢åŒºé—´ï¼‰ BitMapBitmap æœ¬èº«æ˜¯ç”¨ String ç±»å‹ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å®ç°çš„ä¸€ç§ç»Ÿè®¡äºŒå€¼çŠ¶æ€çš„æ•°æ®ç±»å‹ã€‚ String ç±»å‹æ˜¯ä¼šä¿å­˜ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ 123456# BitMapé—´çš„è¿ç®—# operations ä½ç§»æ“ä½œç¬¦ï¼Œæšä¸¾å€¼ AND ä¸è¿ç®— &amp; OR æˆ–è¿ç®— | XOR å¼‚æˆ– ^ NOT å–å ~ åº”ç”¨ ç­¾åˆ°ç»Ÿè®¡ åˆ¤æ–­ç”¨æˆ·ç™»é™†æ€ è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°ï¼ˆä¸æ“ä½œï¼‰ HyperLogLogHyperLogLog æ˜¯ç»Ÿè®¡è§„åˆ™æ˜¯åŸºäºæ¦‚ç‡å®Œæˆçš„ï¼Œä¸æ˜¯éå¸¸å‡†ç¡®ï¼Œæ ‡å‡†è¯¯ç®—ç‡æ˜¯ 0.81%ã€‚æä¾›ä¸ç²¾ç¡®çš„å»é‡è®¡æ•°ã€‚ åº”ç”¨ç»Ÿè®¡ç½‘é¡µè®¿é—®è€… GEOç›´æ¥ä½¿ç”¨äº† Sorted Set é›†åˆç±»å‹ã€‚ åº”ç”¨æŸ¥æ‰¾ä»¥è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒçš„ 5 å…¬é‡Œå†…çš„è½¦è¾†ä¿¡æ¯ StreamRedis Stream æ˜¯ Redis 5.0 ç‰ˆæœ¬æ–°å¢åŠ  åœ¨ Redis 5.0 Stream æ²¡å‡ºæ¥ä¹‹å‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼éƒ½æœ‰ç€å„è‡ªçš„ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸èƒ½æŒä¹…åŒ–ä¹Ÿå°±æ— æ³•å¯é çš„ä¿å­˜æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯¹äºç¦»çº¿é‡è¿çš„å®¢æˆ·ç«¯ä¸èƒ½è¯»å–å†å²æ¶ˆæ¯çš„ç¼ºé™·ï¼› List å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¸èƒ½é‡å¤æ¶ˆè´¹ï¼Œä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹å®Œå°±ä¼šè¢«åˆ é™¤ï¼Œè€Œä¸”ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDã€‚ åŸºäº Stream å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯ä¿åºï¼šXADD/XREAD é˜»å¡è¯»å–ï¼šXREAD block é‡å¤æ¶ˆæ¯å¤„ç†ï¼šStream åœ¨ä½¿ç”¨ XADD å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼› æ¶ˆæ¯å¯é æ€§ï¼šå†…éƒ¨ä½¿ç”¨ PENDING List è‡ªåŠ¨ä¿å­˜æ¶ˆæ¯ï¼Œä½¿ç”¨ XPENDING å‘½ä»¤æŸ¥çœ‹æ¶ˆè´¹ç»„å·²ç»è¯»å–ä½†æ˜¯æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨ XACK ç¡®è®¤æ¶ˆæ¯ï¼› æ”¯æŒæ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ® ä½†æ˜¯ä¸ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”ï¼Œä¼šå­˜åœ¨ä¸¢æ¶ˆæ¯çš„æƒ…å†µå› ä¸ºaofå‘½ä»¤å¹¶ä¸æ˜¯å…ˆå†™åˆ°ç¡¬ç›˜æ‰å†™å…¥åˆ°å†…å­˜å½“ä¸­çš„ æ•°æ®ç»“æ„SDScè¯­è¨€å­—ç¬¦ä¸²ç¼ºé™·ï¼šè·å–é•¿åº¦O(n):ç¼“å†²åŒºæº¢å‡º;ä¸èƒ½ä¿å­˜äºŒè¿›åˆ¶ï¼› SDSæ•°æ®ç»“æ„ ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† SDS å­˜æ”¾åœ¨ buf[] é‡Œçš„æ•°æ® å½“å‘ç°ç¼“å†²åŒºä¸å¤Ÿçš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹ï¼Œæ‰€éœ€ç©ºé—´è¶…è¿‡1MBï¼Œæ–°é•¿åº¦ä¸ºæ‰€éœ€ç©ºé—´+1MBï¼Œåä¹‹æ–°é•¿åº¦ä¸ºæ‰€éœ€ç©ºé—´çš„ä¸¤å€ flagsæ ‡å¿—äº†ä¸åŒé•¿åº¦å’Œç©ºé—´å ç”¨çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å‡å°‘å¤´éƒ¨é•¿åº¦ ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œå¯ä»¥å–æ¶ˆå­—èŠ‚å¯¹é½ é“¾è¡¨åŒå‘é“¾è¡¨ï¼Œå°è£…äº†ä¸€å±‚ï¼Œå¢åŠ äº†é•¿åº¦å’Œå…¶ä»–èŠ‚ç‚¹æ¯”è¾ƒå‡½æ•°ã€å¤åˆ¶ã€é‡Šæ”¾ ç¼ºé™·ï¼šé“¾è¡¨é€šç—… æ— æ³•åˆ©ç”¨cpuç¼“å­˜ èŠ‚ç‚¹ç»“æ„å¤´å¼€é”€ æŒä¹…åŒ–AOF æ—¥å¿— redis é‡Œçš„ AOF(Append Only File) æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ³¨æ„åªä¼šè®°å½•å†™æ“ä½œå‘½ä»¤ï¼Œè¯»æ“ä½œå‘½ä»¤æ˜¯ä¸ä¼šè¢«è®°å½•çš„ï¼Œ å…ˆå†™å‘½ä»¤çš„å¥½å¤„ é¿å…é¢å¤–æ£€æŸ¥å¼€é”€ï¼ˆè®°å½•åˆ°ç¡¬ç›˜ä¹‹å‰ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªè¯­æ³•ï¼‰ é¿å…é˜»å¡å†™å‘½ä»¤ åå¤„ å‡ºç°åœç”µæ“ä½œçš„æ—¶å€™ï¼Œéƒ¨åˆ†æ•°æ®ä¼šä¸¢å¤±ï¼ˆå’Œå›å†™ç­–ç•¥æœ‰å…³ï¼‰ ç”±äºå‘½ä»¤éƒ½æ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œè¿˜æ˜¯å¯èƒ½ä¼šé˜»å¡ä¸‹ä¸€ä¸ªå†™å‘½ä»¤ å›å†™ç­–ç•¥Always æ¯æ¬¡å†™å…¥ AOF æ–‡ä»¶æ•°æ®åï¼Œå°±æ‰§è¡Œ fsync() å‡½æ•° Everysec åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ¥æ‰§è¡Œ fsync() å‡½æ•° No æ°¸ä¸æ‰§è¡Œ fsync() å‡½æ•° é‡å†™æœºåˆ¶åœ¨ä½¿ç”¨é‡å†™æœºåˆ¶åï¼Œå°±ä¼šè¯»å– name æœ€æ–°çš„ valueï¼ˆé”®å€¼å¯¹ï¼‰ é‡å†™è¿‡ç¨‹ç”±åå°å­è¿›ç¨‹è¿›è¡Œæ“ä½œï¼Œå› ä¸ºæ¯”è¾ƒè€—æ—¶é¿å…é˜»å¡ä¸»è¿›ç¨‹ï¼Œ å¹¶ä¸”å¦‚æœä½¿ç”¨çº¿ç¨‹çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå¯¹å…±äº«å†…å­˜è¿›è¡Œè¯»å†™çš„æ—¶å€™éœ€è¦è¿›è¡ŒåŠ é”ï¼Œè€Œçˆ¶å­è¿›ç¨‹ï¼Œåœ¨åˆ›å»ºæ—¶æ˜¯å…±äº«æ•°æ®çš„ï¼Œä½†åœ¨ä¿®æ”¹çš„æ—¶å€™ä¼šç”Ÿæˆè‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œå†™æ—¶å¤åˆ¶ å…·ä½“è¿‡ç¨‹ï¼ˆè™šæ‹Ÿç©ºé—´ä¸åŒï¼Œç‰©ç†ç©ºé—´ç›¸åŒï¼Œæ ‡è®°è¯¥ç‰©ç†å†…å­˜çš„æƒé™ä¸ºåªè¯»ã€‚ï¼‰ ä¸»è¿›ç¨‹åœ¨å­è¿›ç¨‹æ‰§è¡Œ AOF é‡å†™æœŸé—´ï¼Œä¸»è¿›ç¨‹éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªå·¥ä½œ: æ‰§è¡Œå®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼› å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF ç¼“å†²åŒºã€ï¼› å°†æ‰§è¡Œåçš„å†™å‘½ä»¤è¿½åŠ åˆ° ã€ŒAOF é‡å†™ç¼“å†²åŒºã€ï¼› åœ¨å®Œæˆé‡å†™ä¹‹åï¼Œä¸»è¿›ç¨‹ä¼šæ”¶åˆ°ä¿¡å·ï¼Œ å°† AOF é‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹è¿½åŠ åˆ°æ–°çš„ AOF çš„æ–‡ä»¶ä¸­ï¼Œä½¿å¾—æ–°æ—§ä¸¤ä¸ª AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“çŠ¶æ€ä¸€è‡´ï¼› å°†æ–°çš„aofé‡å‘½åï¼Œå¹¶å°†åé¢æ‰€æœ‰çš„å†™å‘½ä»¤è®°å½•åˆ°æ–°çš„aofæ–‡ä»¶ä¸­ RDBæ–‡ä»¶save(ä¸»çº¿ç¨‹)å’Œ bgsave(åå°çº¿ç¨‹) å¯ä»¥å®šæ—¶ä¿å­˜RDBæ–‡ä»¶ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ–¹æ³•é¢‘ç‡å¾—é€‚å½“ ä¿å­˜å¿«ç…§çš„æ—¶å€™ï¼Œæ•°æ®è¢«ä¿®æ”¹å¯ä»¥è¢«ä¿®æ”¹ï¼Œå½“ä¸»çº¿ç¨‹ä¿®æ”¹äº†æŸä¸€å—çš„æ•°æ®å°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œæç«¯æƒ…å†µä¼šå‘ç”Ÿå†…å­˜ä¼šç¿»å€ï¼Œå†™æ“ä½œå¤šçš„æ—¶å€™éœ€è¦ç•™æ„å†…å­˜å˜åŒ– æ··åˆæŒä¹…åŒ–ä¿å­˜RDBå¹¶ä¸”åœ¨ä¿å­˜è¿‡ç¨‹ä¸­çš„å‘½ä»¤ä¹Ÿä¼šè¢«å†™åˆ°é‡å†™ç¼“å†²åŒºä¸­æœ€åä»¥AOFçš„æ–¹å¼æ·»åŠ åˆ°æœ«å°¾ å¯¹è¿‡æœŸkeyçš„å¤„ç†AOFå†™å…¥é˜¶æ®µï¼šåˆ›å»ºçš„æ—¶å€™ ç›´æ¥å¢åŠ key è¿‡æœŸåˆ é™¤çš„æ—¶å€™æ˜¾ç¤ºåˆ é™¤ del é‡å†™é˜¶æ®µï¼šä¼šæ ¡éªŒkeyçš„è¿‡æœŸæ—¶é—´ç¡®ä¿è¿‡æœŸçš„keyä¸ä¼šè¢«å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶å½“ä¸­ RDBå†™å…¥é˜¶æ®µï¼šä¼šå¯¹keyè¿›è¡Œæ ¡éªŒ åŠ è½½é˜¶æ®µï¼š ä¸ä¸»ä»æœåŠ¡å™¨æœ‰å…³ï¼Œå¦‚æœæ˜¯ä¸»æœåŠ¡å™¨åˆ™ä¸ä¼šåŠ è½½ï¼Œä»æœåŠ¡å™¨æ— è®ºæ˜¯å¦è¿‡æœŸéƒ½ä¼šåŠ è½½ï¼Œä½†æ˜¯åœ¨ä¸»ä»åŒæ­¥é˜¶æ®µå°±ä¼šè¢«æ¸…ç©ºæ•°æ® ç¼“å­˜å¼‚å¸¸ç¼“å­˜é›ªå´©ç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡çš„åº”ç”¨è¯·æ±‚æ— æ³•åœ¨Redisç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œä»è€Œä½¿å¾—å¤§é‡è¯·æ±‚å‘é€åˆ°æ•°æ®åº“å±‚ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³å®•æœºã€‚ åŒä¸€æ—¶é—´ç¼“å­˜ä¸­çš„æ•°æ®å¤§é¢ç§¯è¿‡æœŸï¼ˆå¢åŠ éšæœºæ—¶é—´ï¼Œè®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸï¼ŒæœåŠ¡é™çº§(éæ ¸å¿ƒæ•°æ®å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯)ï¼‰ Redis ç¼“å­˜å®ä¾‹å‘ç”Ÿæ•…éšœå®•æœºï¼ˆå‰ç«¯é™æµï¼Œé¢„é˜²å¯éƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤ï¼‰ ç¼“å­˜å‡»ç©¿ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡æŸä¸ªè®¿é—®éå¸¸é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚é›†ä¸­åœ¨è¿™ä¸€ä¸ªç‚¹è®¿é—®ï¼Œåœ¨è¿™ä¸ªKeyå¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ æå‰é¢„çƒ­ï¼Œè®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ è¯·æ±‚æ•°æ®åº“å†™æ•°æ®åˆ°ç¼“å­˜ä¹‹å‰ï¼Œå…ˆè·å–äº’æ–¥é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œå‡å°‘æ•°æ®åº“çš„å‹åŠ›ã€‚ ç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€æŒ‡ç”¨æˆ·è¦è®¿é—®çš„æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ï¼Œå¯¼è‡´ç”¨æˆ·æ¯æ¬¡è¯·æ±‚è¯¥æ•°æ®æ—¶éƒ½è¦å»æ•°æ®åº“æŸ¥ä¸€éï¼Œç„¶åè¿”å›ç©ºã€‚ æ¥å£æ£€éªŒï¼ˆç”¨æˆ·é‰´æƒï¼Œåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼‰ ç¼“å­˜ç©ºå€¼æˆ–è€…ç¼ºçœå€¼ï¼ˆç¼“å­˜ç©ºå€¼å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰ å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ï¼‰ è¿‡æœŸåˆ é™¤ç­–ç•¥æ·»åŠ å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„keyçš„æ—¶å€™ï¼Œä¼šæŠŠå…¶keyå’Œè¿‡æœŸæ—¶é—´åŠ å…¥åˆ°è¿‡æœŸå­—å…¸å½“ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦åœ¨è¿‡æœŸå­—å…¸å½“ä¸­ åˆ é™¤ç­–ç•¥å®šæ—¶åˆ é™¤ï¼ˆè®¾ç½®keyçš„æ—¶å€™ï¼Œå¢åŠ å®šæ—¶äº‹ä»¶ï¼Œå®šæ—¶åˆ é™¤ï¼›ä¼˜ç‚¹ï¼šå†…å­˜å‹å¥½ï¼›ç¼ºç‚¹ï¼šè¿‡æœŸè¾ƒå¤šçš„æ—¶å€™ä¼šå ç”¨è¾ƒå¤šcpuæ—¶é—´ï¼‰ æƒ°æ€§åˆ é™¤ï¼ˆä¸ä¸»åŠ¨åˆ é™¤keyï¼Œè®¿é—®keyæ—¶æŸ¥è¯¢æ˜¯å¦è¿‡æœŸï¼Œç„¶åå†åˆ é™¤ï¼›ä¼˜ç‚¹ï¼šå ç”¨cpuèµ„æºå°‘ï¼›ç¼ºç‚¹ï¼šå†…å­˜ä¸å‹å¥½) å®šæœŸåˆ é™¤ï¼ˆæ¯éš”ä¸€æ®µæ—¶é—´ æ¸…ç†ä¸€æ¬¡è¿‡æœŸkeyï¼‰ Redisé€‰æ‹©æƒ°æ€§+å®šæœŸ å®šæœŸåˆ é™¤æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡ï¼ˆ20ï¼‰çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkey,å¦‚æœè¿‡æœŸkeyè¶…è¿‡25%ï¼Œä¼šç»§ç»­è¿›è¡Œæ–°ä¸€è½®çš„å®šæœŸåˆ é™¤ï¼Œå¦‚æœæ‰§è¡Œæ—¶é—´è¶…è¿‡25mså°±ä¸ä¼šæ‰§è¡Œæ–°çš„ä¸€è½®ã€‚ redisé»˜è®¤1sè¿›è¡Œ10æ¬¡keyè¿‡æœŸæ£€æŸ¥ å†…å­˜æ·˜æ±°ç­–ç•¥ä¸æ·˜æ±° è¿‡æœŸkeyé‡Œ éšæœº æœ€æ—©è¿‡æœŸæ·˜æ±° lru lfu æ‰€æœ‰key éšæœº lru lfu","link":"/2023/06/19/redis/"},{"title":"framework","text":"MybatisMyBatisçš„$å’Œ#çš„åŒºåˆ«1select * from user where name = #{name}; è§£æä¸ºï¼š 1select * from user where name = ?; è€Œ${ } ä»…ä»…ä¸ºä¸€ä¸ªçº¯ç¢çš„ string æ›¿æ¢ï¼Œåœ¨åŠ¨æ€ SQL è§£æé˜¶æ®µå°†ä¼šè¿›è¡Œå˜é‡æ›¿æ¢ sqlæ³¨å…¥user; delete user; ï¼Œé‚£ä¹ˆå°±ä¼šåˆ é™¤æ•´å¼ è¡¨ Spring@Bean å’Œ @Componentçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ @Component æ³¨è§£ä½œç”¨äºç±»ï¼Œè€Œ@Beanæ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚ @Bean æ³¨è§£æ¯” @Component æ³¨è§£çš„è‡ªå®šä¹‰æ€§æ›´å¼º @Autowired å’Œ @Resource çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ@Autowired æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œ@Resource æ˜¯ JDK æä¾›çš„æ³¨è§£ã€‚ @autowired byTypeï¼Œ@Qualifierï¼ˆæŒ‡å®šåç§°ï¼‰ @Resource byNameï¼ˆé»˜è®¤ï¼‰ Beançš„ä½œç”¨åŸŸå•ä¾‹ï¼Œprototypeï¼ˆæ¯æ¬¡ä¸€ä¸ªï¼‰ï¼Œrequestï¼ˆæ¯ä¸ªè¯·æ±‚ä¸€ä¸ªï¼‰ï¼Œæ¯ä¸ªsessionä¸€ä¸ªï¼Œglobalï¼ˆä¸€ä¸ªwebåº”ç”¨ä¸€ä¸ªï¼‰ï¼Œä¸€ä¸ªwebsocketä¸€ä¸ª å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜å¤šä¸ªçº¿ç¨‹æ“ä½œçš„æ˜¯ä¸€ä¸ªbeanï¼Œé¿å…å¯å˜çš„æˆå‘˜å˜é‡ï¼Œéœ€è¦çš„æ—¶å€™ä½¿ç”¨threadlocal Beançš„ç”Ÿå‘½å‘¨æœŸ åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè°ƒç”¨æ„é€ æ–¹æ³• å¡«å……å±æ€§ è®¾ç½®beanNameã€beanFactoryã€ApplicationContext å‰ç½®å¤„ç† æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¯åˆå§‹åŒ–beanæ¥å†³å®šè°ƒç”¨afterPropertiesSet() initæ–¹æ³• åç½®å¤„ç† ä½¿ç”¨bean æ‰§è¡ŒdisposableBeanæ–¹æ³• destroy() IOCå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ å®šä½èµ„æºè·¯å¾„ æ„å»ºiocå®¹å™¨ è§£æxmlæ–‡ä»¶ è¿™ä¸€æ­¥æ˜¯å°†documentå¯¹è±¡è§£ææˆspringå†…éƒ¨çš„beanç»“æ„ï¼Œå®é™…ä¸Šæ˜¯AbstractBeanDefinitionå¯¹è±¡ã€‚ æ³¨å†ŒBeanDefitionï¼Œå®é™…ä¸Šæ˜¯æ”¾åˆ°ä¸€ä¸ªConcurrentMapé‡Œ å¾ªç¯ä¾èµ–beanåˆ›å»ºåŸºæœ¬è¿‡ç¨‹ å®ä¾‹åŒ– createInstanceï¼Œå®Œæˆä¹‹åä¼šåŠ å…¥ä¸‰çº§ç¼“å­˜ å±æ€§æ³¨å…¥ populateBean å¦‚æœä¾èµ–äº†å…¶ä»–çš„beanä¼šä»å„çº§ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœåœ¨ä¸‰çº§ç¼“å­˜ä¸­æ‰¾åˆ°äº†ï¼Œä¼šå°†å…¶æ”¾å…¥äºŒçº§ç¼“å­˜ åˆå§‹åŒ– initializeBean ä¼šå°†beanåŠ å…¥åˆ°ä¸€çº§ç¼“å­˜ï¼Œæ¸…é™¤å„çº§ç¼“å­˜ ä¸€çº§ç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯å·²ç»å®Œå…¨åˆ›å»ºå¥½äº†çš„å•ä¾‹Bean AOPAOP(Aspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹)èƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ å¦‚æœå®ç°äº†æŸä¸ªæ¥å£å°±ä¼šä½¿ç”¨jdkä»£ç†ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šä½¿ç”¨cglibç”Ÿæˆå­ç±»ä»£ç†ã€‚ Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ æ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ SpringMvcå¤„ç†æµç¨‹ httpè¯·æ±‚åˆ°DispatchServlet æŸ¥çœ‹é…ç½®çš„handlerMappingï¼ŒæŸ¥æ‰¾å¯¹åº”å¤„ç†å™¨ è°ƒç”¨é€‚é…å¤„ç†å™¨Adapterï¼Œé€‚é…å¤„ç†å™¨è°ƒç”¨çœŸæ­£çš„handler handlerè¿”å›modelAndView è°ƒç”¨è§†å›¾å¤„ç†å™¨viewResolver æ ¹æ®modelæ¸²æŸ“è§†å›¾ è¿”å›ç»“æœ","link":"/2023/06/15/framework/"},{"title":"æ¶ˆæ¯é˜Ÿåˆ—","text":"æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨é€šè¿‡å¼‚æ­¥å¤„ç†æé«˜ç³»ç»Ÿæ€§èƒ½,å‡å°‘å“åº”æ—¶é—´ å‰Šå³°å¡«è°·ï¼Œç¼“è§£ç¬æ—¶ç³»ç»Ÿå‹åŠ›ã€æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ é™ä½ç³»ç»Ÿè€¦åˆæ€§ æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥çš„é—®é¢˜ç³»ç»Ÿå¤æ‚åº¦æå‡ï¼ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±ã€é‡å¤æ¶ˆè´¹é—®é¢˜ï¼‰ ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼ˆéœ€è¦è€ƒè™‘æ¶ˆæ¯ä¸¢å¤±ï¼ŒMQæŒ‚æ‰ç­‰é—®é¢˜) ä¸€è‡´æ€§é—®é¢˜(å¼‚æ­¥å¤„ç†é—®é¢˜) RocketMQæ¨¡å¼é˜Ÿåˆ—ã€ä¸»é¢˜ã€æ¶ˆæ¯ ä¸€ä¸ª Topic åˆ†å¸ƒåœ¨å¤šä¸ª Brokerä¸Šï¼Œä¸€ä¸ª Broker å¯ä»¥é…ç½®å¤šä¸ª Topic ï¼Œå®ƒä»¬æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ ä¸€ä¸ªä¸»é¢˜æœ‰å¤šä¸ªMessage Queue ä¸€ä¸ªMessage Queueåªèƒ½å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€… è§’è‰² NameServerï¼šé‚®å±€ï¼ŒBroker ç®¡ç† å’Œ è·¯ç”±ä¿¡æ¯ç®¡ç†ï¼Œæ¯åç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œæ—¶é—´æˆ³è¶…è¿‡ä¸¤åˆ†é’Ÿåˆ™è®¤ä¸ºbrokerå¤±æ•ˆï¼ˆzookeeperåŠŸèƒ½å¤ªå¤æ‚äº†ï¼Œnameserveræ— éœ€é€‰ä¸¾ã€å»ä¸­å¿ƒåŒ–è®¾è®¡ã€æ›´åŠ è½»é‡çº§ï¼‰ Brokerï¼šæš‚å­˜è€…ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯åˆ° Broker ï¼Œæ¶ˆè´¹è€…ä» Broker æ‹‰å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚ Consumerï¼šæ”¶ä¿¡è€… Producerï¼šå‘ä¿¡è€… broker åšäº†é›†ç¾¤å’Œä¸»ä»ï¼Œslaveå®šæ—¶ä»masteråŒæ­¥æ•°æ®ï¼Œä»èŠ‚ç‚¹åªè¯»ä¸å†™å…¥æ¶ˆæ¯ NameServerå»ä¸­å¿ƒåŒ–ï¼Œåœ¨ RocketMQ ä¸­æ˜¯é€šè¿‡ å•ä¸ª Broker å’Œæ‰€æœ‰ NameServer ä¿æŒé•¿è¿æ¥ ï¼Œå¹¶ä¸”åœ¨æ¯éš” 30 ç§’ Broker ä¼šå‘æ‰€æœ‰ Nameserver å‘é€å¿ƒè·³ ç”Ÿäº§è€…ä»nameserverè·å–Brokerä¿¡æ¯ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼ç”Ÿäº§æ•°æ® å‘Brokerå‘é€pullæ¥è·å–æ•°æ®ã€‚å¯ä»¥ç”¨ä¸¤ç§æ¨¡å¼å¯åŠ¨ å¹¿æ’­ï¼ˆå…¨éƒ¨éƒ½å‘ï¼‰å’Œé›†ç¾¤ï¼ˆå…¶ä¸­ä¸€ä¸ªï¼‰ é¡ºåºæ¶ˆè´¹ç”Ÿäº§è€…ï¼š ä¿è¯æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­å°±å¯ä»¥ã€‚ å¦‚æœè¦æ±‚å…¨å±€é¡ºåºæ¶ˆæ¯ï¼Œé‚£ä¹ˆåªèƒ½è®¾ç½®ä¸€ä¸ªè¯»å†™é˜Ÿåˆ— æ¶ˆè´¹è€…ï¼š é˜²æ­¢å¹¶å‘æ¶ˆè´¹ï¼ŒMessageListenerOrderly ï¼Œä¼šä¸ºæ¯ä¸ªconsumerqueueåŠ é” é‡å¤æ¶ˆè´¹å®ç°å¹‚ç­‰ï¼Œä½¿ç”¨redisæˆ–è€…æ•°æ®åº“å”¯ä¸€é”®æ¥ä¿è¯ä¸ä¼šé‡å¤ã€‚ æ¶ˆæ¯å †ç§¯åˆ¤æ–­æ˜¯ä¸æ˜¯ç”Ÿäº§çš„å¤ªå¿«ï¼Œé™æµé™çº§ï¼Œå¢åŠ æ¶ˆè´¹è€…æˆ–è€…å¢åŠ æ¶ˆè´¹é€Ÿåº¦ åˆ¤æ–­æ˜¯ä¸æ˜¯æ¶ˆè´¹çš„å¤ªæ…¢ï¼Œå¯èƒ½æ˜¯æ¶ˆè´¹é”™è¯¯ï¼Œæ’æŸ¥ä¸‹æ—¥å¿— åˆ†å¸ƒå¼äº‹åŠ¡ å‘é€halfæ¶ˆæ¯ è¿”å›ç¡®è®¤æ¶ˆæ¯ ç³»ç»Ÿæ‰§è¡Œäº‹åŠ¡ å‘é€commitæˆ–è€…Rollbackæ¶ˆæ¯ å¦‚æœå› ä¸ºç½‘ç»œåŸå› æœªæ”¶åˆ°ï¼Œåˆ™ä¼šå‘é€äº‹åŠ¡åæŸ¥ æ£€æŸ¥äº‹åŠ¡çŠ¶æ€ å‘é€commitæˆ–è€…Rollbackæ¶ˆæ¯ åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ ä¸åŒç‚¹ï¼šåŒæ­¥åˆ·ç›˜éœ€è¦ç­‰å¾…åˆ·ç›˜å®Œæˆç„¶åæ‰èƒ½å‘é€æˆåŠŸçŠ¶æ€ï¼Œå¼‚æ­¥åˆ·ç›˜éœ€è¦å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹å»åˆ·ç›˜ï¼Œå†™çº¿ç¨‹å¯ä»¥ç›´æ¥è¿”å›ï¼Œæé«˜ååé‡ï¼Œå¯ä»¥ç§¯ç´¯ä¸€å®šé‡çš„æ¶ˆæ¯ç»Ÿä¸€è§¦å‘å†™ç£ç›˜ä»»åŠ¡ã€‚å¼‚æ­¥åˆ·ç›˜ä¼šåœ¨brokeræ„å¤–å®•æœºçš„æ—¶å€™æ‰ä¼šä¸¢å¤±éƒ¨åˆ†æ•°æ®ã€‚ å†…å­˜ä¸€èˆ¬æŒ‡çš„æ˜¯é¡µç¼“å­˜ å½“ç”¨æˆ·åœ¨è¯»å†™æ•°æ®çš„æ—¶å€™ï¼Œå†…æ ¸ä¼šç”³è¯·ä¸€ä¸ªå†…å­˜é¡µä¸æ–‡ä»¶ä¸­çš„æ•°æ®å—è¿›è¡Œç»‘å®š ç”¨æˆ·å¯¹æ–‡ä»¶çš„è¯»å†™å®é™…ä¸Šæ˜¯å¯¹é¡µç¼“å­˜çš„è¯»å†™ï¼Œå¦‚æœè¯»çš„æ•°æ®å·²ç»å­˜åœ¨é¡µç¼“å­˜å½“ä¸­ï¼Œå°±ä¸ç”¨åœ¨è¿›è¡Œè¯»å–ï¼Œå¦åˆ™å°±ä¼šç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜é¡µï¼Œè¿›è¡Œè¯»å–æ•°æ®ç„¶åå¤åˆ¶ç»™ç”¨æˆ·ï¼›å†™æ“ä½œä¹Ÿç›¸åŒã€‚ åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶Borker ä¸»ä»æ¨¡å¼ åŒæ­¥å¤åˆ¶æ˜¯ç­‰ Master å’Œ Slave å‡å†™æˆåŠŸåæ‰åé¦ˆç»™å®¢æˆ·ç«¯å†™æˆåŠŸçŠ¶æ€ï¼› å¼‚æ­¥å¤åˆ¶æ˜¯åªè¦ Master å†™æˆåŠŸå³å¯åé¦ˆç»™å®¢æˆ·ç«¯å†™æˆåŠŸçŠ¶æ€ ã€‚ å¼‚æ­¥å¤åˆ¶å¹¶ä¸ä¼šå½±å“æ¶ˆæ¯çš„å¯é æ€§ï¼Œä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹åªæ˜¯ä¼šç¼ºå°‘éƒ¨åˆ†æ¶ˆæ¯ï¼Œåœ¨ä¸»èŠ‚ç‚¹ä¸‹æ¬¡é‡å¯çš„æ—¶å€™æ¶ˆæ¯å°±ä¼šé‡æ–°å‘é€è¿‡æ¥ã€‚ MQå­˜å‚¨æœºåˆ¶commitLogï¼šæ¶ˆæ¯ä¸»ä½“ä»¥åŠå…ƒæ•°æ®ä¿å­˜ä¸»ä½“ ConsumeQueueï¼šæ¶ˆè´¹é˜Ÿåˆ—ï¼Œä¸»è¦æ˜¯ä¸ºäº†æé«˜æ¶ˆè´¹æ€§èƒ½ï¼Œä¿å­˜äº†æŒ‡å®štopicä¸‹çš„offsetã€sizeã€tagçš„å“ˆå¸Œå€¼ï¼Œå­˜å‚¨è·¯å¾„$HOME/store/consumequeue/{topic}/{queueId}/{fileName} IndexFileï¼šç´¢å¼•æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ key æˆ–æ—¶é—´åŒºé—´æ¥æŸ¥è¯¢æ¶ˆæ¯ å…ˆå°†æ¶ˆæ¯å‘åˆ°å…¨éƒ¨å‘é€åˆ°CommitLogï¼Œå¹¶é€šè¿‡topicå’ŒqueueIdå°†commitLogä¸­çš„offsetã€æ¶ˆæ¯å¤§å°å’Œtagçš„hashcodeä¸€èµ·å‘é€åˆ°consumerQueueä¸­ï¼Œæ¶ˆè´¹è€…åªéœ€è¦è·å–consumerOffsetè·å–å¯¹åº”ä½ç½®çš„commitLogOffsetå³å¯è·å–åˆ°åŸå§‹ä¿¡æ¯ã€‚","link":"/2023/06/26/MQ/"}],"tags":[{"name":"Algorithm","slug":"Algorithm","link":"/tags/Algorithm/"},{"name":"HashMap","slug":"HashMap","link":"/tags/HashMap/"},{"name":"Blog","slug":"Blog","link":"/tags/Blog/"},{"name":"Greedy","slug":"Greedy","link":"/tags/Greedy/"},{"name":"MergeSort","slug":"MergeSort","link":"/tags/MergeSort/"},{"name":"DynamicProgramming","slug":"DynamicProgramming","link":"/tags/DynamicProgramming/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"javaï¼Œconcurrent","slug":"javaï¼Œconcurrent","link":"/tags/java%EF%BC%8Cconcurrent/"},{"name":"network","slug":"network","link":"/tags/network/"},{"name":"Mysql","slug":"Mysql","link":"/tags/Mysql/"},{"name":"jvm","slug":"jvm","link":"/tags/jvm/"},{"name":"spring","slug":"spring","link":"/tags/spring/"},{"name":"redis","slug":"redis","link":"/tags/redis/"},{"name":"mybatis","slug":"mybatis","link":"/tags/mybatis/"},{"name":"MQ","slug":"MQ","link":"/tags/MQ/"}],"categories":[{"name":"Algorithm","slug":"Algorithm","link":"/categories/Algorithm/"},{"name":"Blog","slug":"Blog","link":"/categories/Blog/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"concurrent","slug":"concurrent","link":"/categories/concurrent/"},{"name":"network","slug":"network","link":"/categories/network/"},{"name":"Mysql","slug":"Mysql","link":"/categories/Mysql/"},{"name":"jvm","slug":"jvm","link":"/categories/jvm/"},{"name":"spring","slug":"spring","link":"/categories/spring/"},{"name":"redis","slug":"redis","link":"/categories/redis/"},{"name":"mybatis","slug":"spring/mybatis","link":"/categories/spring/mybatis/"},{"name":"MQ","slug":"MQ","link":"/categories/MQ/"}],"pages":[]}